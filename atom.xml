<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>LittleYe233&#39;s Blog</title>
  
  
  <link href="https://blog.tamako.work/atom.xml" rel="self"/>
  
  <link href="https://blog.tamako.work/"/>
  <updated>2023-01-04T16:28:51.000Z</updated>
  <id>https://blog.tamako.work/</id>
  
  <author>
    <name>LittleYe233</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>个人近况 (2022.12.19-2023.1.5), 一些必须面对的事情, 以及「赛博遗言」</title>
    <link href="https://blog.tamako.work/myself/recent/2022-dec-19-2023-jan-5/"/>
    <id>https://blog.tamako.work/myself/recent/2022-dec-19-2023-jan-5/</id>
    <published>2023-01-04T16:28:51.000Z</published>
    <updated>2023-01-04T16:28:51.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>离别是为了更好地再见。</p></blockquote><span id="more"></span><p>大家好。现在耳机里正在放的歌曲是 Alpin 的「Let’s Go Far Away」。</p><p>我一向不怎么想说重复的话，所以刚刚在私有频道里<em>告别</em>的话，我也不怎么想在这里重复了。</p><p>没错，就在几十分钟前（相对于目前的 2023 年 1 月 5 日 0:35），我终于觉得，大概是处理好了所有必要的「赛博后事」了，然后果断地卸载了 Telegram 和 Twitter。于我而言，这是一种未曾有过的果断的告别。之所以需要这么做，简单来说——就是因为<a href="https://twitter.com/LittleYe233/status/1610491487711825922">相当可笑的原因「爆柜」</a>，然后被家长连着谈了两次话，最后希望挽回摇摇欲坠的家庭关系，被迫选择「熔断」我目前最主要的国外社交渠道，并且暂停 HRT。</p><p>闹到这一步，我是有点没想到的。我是曾经听说一只「进度」比较快的 xyn 的母亲经常半夜失眠。我在昨天（2023 年 1 月 4 日）晚上的谈话中再次亲眼目睹我的妈妈一边抹眼泪一边哭诉的样子，紧接着我也崩溃了——当然我强忍着没有哭出来，只是心里相当难受。我最终「翻车」的时候，有人笑称我是「家长党」，有段时间我一直将其视作逃避的「挡箭牌」，但是我其实心里也清楚，容忍终究是有极限的。我的父母即便再开明，也无法放任我——他们认为如此——不加筛选地加入各种跨性别相关的小团体，乃至动辄胡乱买药进行 HRT。在他们列举出的大量几个月前和现在我的精神状态和行为举止的对比面前，我退缩了，因为我永远都不是能面不改色心不跳地说谎的人。漫长的沉默之下，与我生活了将近 20 年的他们大概也意识到他们最不希望出现的事情发生了。即便之后的对话中他们还是表现出不知道我有没有服药的事实，不过这可能也只是避免我情绪更加崩溃的话术吧。</p><p>我最大的失败，莫过于在好不容易的「家族谈话」的气氛中，没有坦白一切吧。客厅的电视传来综艺节目主持人的笑声。我试图将注意力转移到电视节目上，但一切都是徒劳。我爸如连珠炮般的话语不断攻击我的精神力。我甚至忘记了前几分钟的对话是什么样子，双手都在颤抖，说不出任何话来。可能我仍然沉浸在听到从他口中蹦出来的「药娘」等词的震惊中无法自拔，但更大的可能是——我<em>真的</em>做了，我认识的人中真的有好几位跨性别者，我也加入了相关的群组，我也进行了几个月的 HRT，我几乎不再尝试质疑我是不是真正的 MtF。</p><p>其实说出来大概也没什么羞耻的，也不必担心接下来迎接我的是家暴或扭转机构一类，但是，在我父母的目光之下，我一瞬间产生了记忆中最深刻的对我的性身份的怀疑。我试图苦苦隐藏的秘密，我内心中最不愿意被他们接触的部分，正在遭到他们的侵入。我感到呼吸困难。我一瞬间真的想就此失去意识，一睡不醒。我乞求能逃避——忘掉性激素早已紊乱的身体，忘掉补佳乐，忘掉康宁，忘掉跨性别，忘掉所有的一切，哪怕彻底毁掉抹去这半年——从正式的女装开始算起就是一年半——的所有记忆也无妨。</p><p>要命的是，我爸还在不断地试图给我灌输重复来重复去的东西，还试图继续从我嘴里挖出什么话来。但是我真的说不出来啊！真的，连「我现在不想说」「拒绝回答」都说不出来，连一个音节都憋不出来。声带仿佛被怪力狠狠攥住了一样。我没有任何说话的欲望，也说不出任何话来……突然，我在想，这是不是上天对我的惩罚——对我这半年间作为「郭楠」踏入「跨圈」的惩罚：「Ta 们」有「Ta 们」的生存空间，你就别掺合进去了吧！</p><p>嗯，我明白啊。昨天我还在某个我以前活跃的群组里说这个群组是「解压神器」呢。做一个性取向和性身份认同一切正常的男性，是多么朴素，但又多么自然的事情呐，那样即便被一些人骂作「下体生物」之类，恐怕我都能心安理得地接受吧。但是，尚且不论我是不是受一些团体的「蛊惑」，我现在的头脑中，真的产生了一种对自我的另一种看法啊……我可以自嘲我是「不该翻车的翻车了」，但我没法否认我此时此刻仍然在进行的从未有过的思想斗争啊……</p><p>好的，其实这牵扯到了另一系列比较严重的心理问题。可能很久以前，自卑的情结就植根于我的心中——这本身在人类社会是相当正常的事情——然后这种情绪逐渐地发展壮大，等待我经历了小学、初中、高中的应试教育的试炼，最终步入大学，见识了很多各方面有突出能力的年龄相仿的人，外加上 Twitter 上相当数量的「进度」惊人又很 pass 的跨性别者之后，终于爆发了。我知道我没什么天赋，在我自我满足的计算机技术的天地中屡屡见到各路神仙，技能树远远比不上别人，说实在话，我也称不上那些大佬那番刻苦。最后，我持续了很长一段时间的自我怀疑，觉得自己什么都做不好，甚至做不了。这种想法最终还是蔓延到了思想层面。我的人生中从来没有人评价我「细腻」，我也不觉得我是这种人，所以我自始至终都给自己贴上了「心理不敏感」的标签。结果，到了迷惘于我的性身份的关头，我竟然开始直接怀疑我的想法是否真实——我所想的，真的是我的头脑中实际所想的吗？我感受到的，真的是我的大脑实际感受到的吗？我连我的直觉都开始否认了，无法相信自己的判断，到了这种严重的地步。在网络上看到大量的跨性别者从相当小的年纪就意识到了自己的异常，甚至未成年就拉着父母到跨性别门诊，而我则是安分守己地做了十九年的「郭楠」，到了最近才「翻车」。所以——「你的所谓『错乱』恐怕是一种错觉吧」，终于还是冒出了这种念头。</p><p>…………</p><p>抱歉，我暂时不想再顺着这个话题说下去了。一方面确实已经很晚了（接近凌晨 2 点），另一方面，我的心理状态又变得有些糟糕。不过我大致的状态，从上面的文字中大概也能管中窥豹了。</p><p>我写这篇短文，最想做的，大概也是一种「展望」。正如我在第 93 条 <a href="https://twitter.com/LittleYe233/status/1610629580976697344">tweet</a> 中所言，我希望能「向前看」「向前走」。我明白一味地闷头吃药，逃避家长的路已经走不通了。另外，不论如何 HRT 终究还是有一定的风险的，而且即便是跨性别者，似乎也有不进行 HRT 和 SRS 的可能性……？最重要的是，正如我父母所说，我现在没有任何收入，学历还是高中，为了追求性身份上的认同不惜抛弃过去的生活和兴趣爱好种种事物也是不可取的，况且我现在的精神状态相当之差，到了难以融入家庭和社会的地步。所以，我最终决定，在寒假暂停 HRT 的进程（当然没跟他们说，我在那种环境不可能暴露我正在服药的事情），然后努力调整我的心理状态……嗯，如果 summarized 的话大概就是这么简短的一句话吧。</p><p>之所以选择「熔断」交流渠道，也是考虑到这些渠道上的很多信息源确实可能对我真实的想法有些动摇……承认这件事可能显得我很无能，因为这似乎表明我很容易受人操纵，不过在目前的情况下，我也希望能相对冷静地处理这些事情，所以……最后我就做出了这样的事情。</p><p>其实呢，还有一个原因。</p><p>哎呀，又要对各位「私密马赛」（对不起）了……此时此刻，我突然想起来「某人」曾经对我说「流的眼泪太多就不值钱了」，可能我天天「对不起」也会不值钱吧……但是，我真的实在是写不动了，我直接把我在某个频道里的「赛博遗言」截取一段出来吧：</p><blockquote><p>想来，我最近——可能很久以来——似乎都很依赖在网络空间获得一份「认同」，所以我曾经表示过一条评论或者是一个单纯的 like 都能让我激动许久。久而久之，可能我会试图主动地给别人发送我的频率的电波，但是其中的内容质量实在不足，别人也不愿意看，但我还会继续「骚扰」下去。我相信肯定有人对我的行径感到厌烦。那个时候，我控制不住。我很抱歉。我的希望——或者说是墙外网络空间的部分「遗言」：请忘记我。我不值得被记住。</p></blockquote><p>差不多，就是这样吧。所谓的「短文」不知不觉也变得挺长的了。</p><p>熟悉我的人也知道，虽说我只是掐断了部分交流的渠道，而且这个博客也不会暂停更新，但是 QQ、微信之类，我是几乎不碰的；现在这个年头，也没几个人发短信吧；邮件也是一样，而且不适合作为即时聊天工具；虽说有少数人有我的手机号，但是不到万不得已的时候大概也不会打吧。所以，我这一去，真的可能是再也不回了，除非在线下跟我「真人快打」吧。</p><p>我真的很舍不得这些联系。不管曾经交流得有多深入，这些大大小小的联系都曾在我的记忆中闪耀过，共同组成了远比线下更为多彩的人际关系。没有这些关系，我大概还是孤身一人吧，大概早就抑郁了吧。这也是我曾经几次试图「戒断」都失败的原因。不过，为了我个人的自私的原因，我<em>必须</em>要让这一次成功。</p><p>还有很多话，我想跟很多人说，我想跟一些人说，我想跟「他」说，我想跟「Ta」说。不过在这种公开的场合，也不方便提这些。就让它们暂且藏在我的心里吧。</p><p>再次，非常抱歉。</p><p>非常感谢大家。</p><p>特别感谢最后接受了我的一个小小请求的「她」。</p><p>以及，<strong>再见了</strong>。</p><hr><p><a href="https://mtf.wiki/zh-cn/docs/">希望我、「我们」，或者「Ta 们」，终有一天能自由地生存着。</a></p><p><strong>【完】</strong></p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;离别是为了更好地再见。&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Essay" scheme="https://blog.tamako.work/categories/Essay/"/>
    
    <category term="Report" scheme="https://blog.tamako.work/categories/Essay/Report/"/>
    
    
    <category term="Self Analysis" scheme="https://blog.tamako.work/tags/Self-Analysis/"/>
    
    <category term="Transgender" scheme="https://blog.tamako.work/tags/Transgender/"/>
    
    <category term="Recent Activities" scheme="https://blog.tamako.work/tags/Recent-Activities/"/>
    
  </entry>
  
  <entry>
    <title>再见, 2022</title>
    <link href="https://blog.tamako.work/myself/goodbye-2022/"/>
    <id>https://blog.tamako.work/myself/goodbye-2022/</id>
    <published>2022-12-30T00:43:12.000Z</published>
    <updated>2022-12-30T00:43:12.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="一些絮絮叨叨的没用的前言"><a href="#一些絮絮叨叨的没用的前言" class="headerlink" title="一些絮絮叨叨的没用的前言"></a>一些絮絮叨叨的没用的前言</h2><p>又到了惯例的写总结的时候了. 今年 2022 年, 是完整地度过大学生活的第一年 - 当然是大一春季学期和大二秋季学期两个学年的一半合二为一而成. 本来没打算今天写, 甚至没打算在这个假期写, 不过想来这个 2022 大家过得似乎都不怎么太平, 还是随便写写吧.</p><p>当然, 既然是要写, 我肯定不想局限于 “随便”, 但最近不论是身体还是精神状态似乎又被打回了低谷, 现在胸口仍然隐隐作痛. 既然是总结, 那肯定不能拖到明年吧, 所以我距离 deadline 也就一天多一点了, 还是有点紧迫的. 如果情况不太妙, 我也可能 push 一个半拉子版本上去, 那最后呈现出来可能就比较 “随便” 了. 如果这篇杂文还有人愿意看的话, 提前跟各位道一个歉, 希望原谅我可能的 “雷声大雨点小” 的 “无耻” 行为, 并理解这也是我的无奈之举.</p><p>这篇文章可能会融合一些未来的 “<a href="/about">About page</a>“, 或者是这两篇会同时发布.</p><p>我现在, 这个瞬间 (<code>2022-12-30T11:58:37Z+0800</code>), 正趴在自己房间的床上. 身上自然是没有女装的, 甚是可悲. 下午含的<a href="https://mtf.wiki/zh-cn/docs/medicine/estrogen/estradiol-valerate/">补佳乐</a>的余韵 (?) 也早已散去. 虽说洗完了澡, 身上挺干净的, 但我也知道我现在比起在学校的常服状态还是更 “男” 了点. 一边触发各种 gender dysphoria, 一边思考 “我为何还活着” 已经成了一段时间脑内的通常活动. 我也说不清楚为什么会开始思考生死的问题, 而且碍于现在读书少见识少, 也思考不出什么有价值的事情. 不过这一点在一些人看来可能已经是值得关注的状态. 希望别哪一天真死了, 我还没写完遗书呢.</p><p>现在的感觉实在是太畅快了. 今天 - 不对, 昨天, 因为很快就跨日了 - 飞快地使用应试教育十余载习得的快速处理作业的手段合并 <a href="https://chat.openai.com/">ChatGPT</a> 写完了两章模拟电子技术基础的作业之后, 从后台拖下来全班的作业拧巴拧巴, 给助教道个歉, 确实身体不好, 然后就忍着呕吐感在自己的博客想写什么就写什么 - 自由的感觉实在是太爽啦! 现在 Visual Studio Code 的光标位置指示已经到了第 27 行的第 233, 234 - 哦, 我的老天, 它一直在上涨… 废话! - 总之就是这么多字符的列. 随便拖一下字符数就已经上了 1k. 高中写语文作文怎么没这么爽快过? 唉, 不过高中那作文吧, 你说是又红又专的假大空, 但好歹有不少书面语, 现在回头看看我的博客不一堆乱七八糟的口语的堆砌? 我中学语文烂得很, 写作文的时候啥修辞都不会, 就这样写出来的还比现在的规整呢!</p><p>在一些人看来我现在大概是有点毛病, 嗯, <a href="#%E4%BD%A0%E6%9C%89%E7%B2%BE%E7%A5%9E%E7%96%BE%E7%97%85%E5%90%97">精神问题</a> - 这些东西在过去离我好远, 现在仿佛啥都能安在自己头上看看, 说起来真是有点好笑. 我之前发了个<a href="https://twitter.com/LittleYe233/status/1607681621876178944?s=20">推</a>表示我自己的生活环境压根不会导致我出现各种各样奇奇怪怪的问题. 但是我现在确实不怎么正常, 那怎么解释呢? 感觉想出来一个解释也没什么意义. 我是试图拿我现在的精神状态做筹码吗? “赌局”在哪里, “庄家”是谁, 我的 “赌资” 呢?</p><p><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /></p><p>… 我在写什么? 这不是年度总结吗? 我在写什么???</p><p>我也不知道.</p><p><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /></p><p><strong>让我们开始吧.</strong></p><h2 id="学生的主业还得是学习"><a href="#学生的主业还得是学习" class="headerlink" title="学生的主业还得是学习"></a>学生的主业还得是学习</h2><p>我<em>在</em>学习吗? 我在学<em>什么</em>?</p><p>我现在的状态是大二秋季学期结束, 还有几门考试课没有进行期末考试. 在以前我是挺讨厌这样的状态, 因为我知道一个亘古不变的真理即是假期结束之后的考试我必很惨, 但是我也有点自知之明, 上学期没怎么认真 - 噢不, 很多课程压根没学, 所以 “延迟处刑” 还是挺重要的, 至少让我上路体面一点.</p><p>电子信息相关的专业, 到了这个时候, 差不多需要接触 “模电” “数电” 了. 我们这学期上的是模电, 把我上得头皮发麻 - 也不是说老师水平不行, 是… 这个模电桑啊, 实在是有点影响我捯饬捯饬计算机, 搞得我有点学业焦虑, 再加上课程本身难度也不小, 让我有点力不从心, 现在感觉跟听天书差不多. 挣扎着上完最后几节课, 有点如释重负的感觉.</p><p>那再上学期呢? 大一夏季学期咱们就不提了, 直接看看春季学期吧. 春季学期有什么呢? 有个 “电路”, 也是挺恼人的. 虽然说难度比模电要小, 但毕竟不算跟什么计算机直接相关的课程, 我捣鼓起来同样有点头疼, 最后也因为一些事情而耽搁了, 最后考得也是稀烂. 大学物理中规中矩, 高数又是个稀烂的课程. 所以大一的课程结束, 我整个绩点跟从头稀烂到尾也没什么差别, 尽管大一秋季学期的成绩还算不错.</p><p>大一的成绩出来, 一个非常可怕的事实摆在我面前 - 我没法保研了, 也没法转专业了, 双修都不行. 其实 70 多分的高数成绩一出来, 我整个人就跟掉到冰窟窿一样. 我知道在现在这么卷的环境, 你别说一个 70+ 了, 一个低于 90 分都几乎和保研无缘了, 当然门门 80+ 想冲冲辅修还是有点希望的, 不过我这几门 70+, 60+ 肯定是完犊子了. 本科折腾计算机是没有指望了, 除非退学重开.</p><p>大一的成绩搞得我之后都有些郁郁寡欢, 不过大二我又重新打起了一点精神. 结果呢? 结果就摊上模电了. 就别冰窟窿了, 直接把我冻成标本吧. 解冻复冻不累吗?</p><p>好, 咱就不谈保研了好吧. 你想出国吗? 啊, 你想过是吗. 那出国要什么, 需要语言考试吧. 甭管雅思还是托福, 你总得练习吧 blabla. 我估计你也没法无师自通所以你还是乖乖跟着老师上吧. 什么? 你啥都没开始? 你光看着某个群里一堆人去考雅思 - 人家都去<em>考</em>了! 你在干什么? 雅思的练习课本你翻过一次吗? 哦, 你是在返乡的时候才拆封的.</p><p>还有, 你是不是害怕口语考试? 啊对对对, 哑巴英语受害者合并社恐是这样的.</p><p>…</p><p>你总得学点啥吧!</p><p>哦, 对. 那我学了什么呢?</p><p>学了点前端? 学了点后端?</p><p>哦, 折腾了点 <a href="https://svelte.dev/">Svelte</a>.</p><p>…</p><p>你做起了啥项目吗?</p><p><a href="https://github.com/LittleYe233/FuckHomework">FuckHomework</a> 算吗?</p><p>…</p><p>就这?</p><p>… (泪汪汪)</p><p>好吧好吧. 然后呢?</p><p>… 没了.</p><p>没了??? (怒不可遏) <strong>那你学了个锤子!!!</strong></p><p>(别敲我!) 好吧, 又折腾了点 “磕盐”.</p><p>嗯, 磕盐狗是吧. 你跟着参加组会了吗?</p><p>嗯.</p><p>你学了啥? 在研究啥?</p><p>…</p><p>(重复片段省略)</p><p>好吧, 又折腾了点 <a href="https://pdos.csail.mit.edu/6.S081/2021/">MIT 6.S081</a>.</p><p>终于到正统计算机科学了. 你写了几个实验?</p><p>现在写了两个.</p><p>… 才两个? 好吧, 两个也算吧.</p><p>… (提前泪汪汪)</p><p><strong>没了?!!!</strong></p><p>… (抱头)</p><hr><p>所以说, 我究竟学了什么呢? 看上去我涉猎的范围比我刚进大学的时候广很多, 但实际上远远不够深入, 最后的效果也难以让人满意. 感觉整个一年, 消磨了好多好多的时间, 最后几乎颗粒无收.</p><p>不过所幸, 我最终决定还是去研究比较底层的东西 - 尽管它真的很难. 不管怎么说, 有了<em>决定</em>是一件好事.</p><p>现在比较头疼的是, 我缺少一定的继续学习的动力. 润算是一个动力, 计算机算是一个动力, 一些人的期许也是一个动力, 可能还有其他各种各样大大小小的动力, 但是在最近, 一旦将这些联系到具体的学习行为上, 这些动力就烟消云散了. 在一些人看来, 我的这些状态会被定义为 “假学习”. 我自然是很讨厌这些名词套在我头上的, 不过我在中学阶段也经常认同一些长辈将另一些不怎么学习的学生定义为 “假学习”, 现在无非是风水轮流转罢了. 可是, 我还是觉得我并不能真的被扣上这样一顶帽子, 不过在现在 - 也就是比如说按照最近一周的表现, 我上述的反驳也只能算是败犬的不甘.</p><p>以上这些内容, 有一些牵扯到我整个一年心理状态和精神状态的变化, 这些就放在后面的<a href="#%E4%BD%A0%E6%9C%89%E7%B2%BE%E7%A5%9E%E7%96%BE%E7%97%85%E5%90%97">章节</a>中慢慢说 - 如果我还有时间和精力继续写的话.</p><hr><p>不过学了点 $\LaTeX$ 的感觉还是不错的.</p><hr><p>讲个笑话: 某人曾经立志大学本科就去搞 Galgame 汉化, 然而现在还是 “五十音战士”.</p><p>再讲个笑话: 某人曾经立志绘画能力对标<a href="https://www.pixiv.net/users/705370">白玉</a>, 然而现在数位板最常用来补实验报告.</p><h2 id="你有精神疾病吗"><a href="#你有精神疾病吗" class="headerlink" title="你有精神疾病吗"></a>你有精神疾病吗</h2><p>我有精神疾病吗?</p><p>我<em>现在</em>还没有吧.</p><p>我现在还<em>没有</em>吧.</p><p>我现在的状态可能只能算是 “神神叨叨”, 还远没有在医院诊断为诸如抑郁, 焦虑等等的程度. 不过正如<a href="#%E4%B8%80%E4%BA%9B%E7%B5%AE%E7%B5%AE%E5%8F%A8%E5%8F%A8%E7%9A%84%E6%B2%A1%E7%94%A8%E7%9A%84%E5%89%8D%E8%A8%80">前言</a>所说,</p><blockquote><p>但是我现在确实不怎么正常</p></blockquote><p>嗯. 可能在真正的抑郁症患者来看, 我还是相当正常的. 我也不知道真正的抑郁症患者的一天会如何度过, 是如何思考的. 可能网络上会流传一些 “常见症状”. 本身搜索这些信息对于现代网民来说应该是一件相当容易的事情, 但是我竟然从来没有做过. 做这些事, 仿佛是<em>在考试的时候对答案</em>一般… 丑恶 - 好像也没什么丑恶的. 为什么我会用 “丑恶” 这个词呢? 你要是想要证明自己清白得没有试图装作教科书上精神病患的样子, 那你还借那本 &lt;<a href="https://en.wikipedia.org/wiki/Introduction_to_Psychoanalysis">精神分析引论</a>&gt; 干什么?</p><p>这种类似的行为矛盾和思想矛盾的情况已经发生一段时间了, 甚至可能远远超出了这一年的尺度. 不过, 我确实好奇过 - 就是, 单纯地想了解, 一群人的生存状态, 一些人的所见所感, 以及… <em>某个人的世界</em>?</p><p>所以, 看上去, 以我目前的阅读积累和之前的常识积累, 我不知道教科书上的抑郁症和焦虑症云云是什么样子的. 但是, 我现在的状态, 还是称不上是正常吧.</p><p>我在身体的<a href="#%E6%88%91%E9%98%B3%E6%80%A7%E4%BA%86">一些状态</a>稍稍好一些的时候, 也就是 12 月 27 日, 做了一下 399 题的 <a href="https://en.wikipedia.org/wiki/Minnesota_Multiphasic_Personality_Inventory">MMPI</a>. 这一次的量表的结果比几天前 (12 月 22 日, 尚处病重期) 的效力要高很多. 22 日的那一次, D 量表 (抑郁量表) 的结果达到了惊人的 94, 但其实 27 日这一次的结果也不怎么好看:</p><table><thead><tr><th align="center">量表</th><th align="center">结果 (标准分)</th></tr></thead><tbody><tr><td align="center">CNS</td><td align="center">44</td></tr><tr><td align="center">L</td><td align="center">32</td></tr><tr><td align="center">F</td><td align="center">70</td></tr><tr><td align="center">K</td><td align="center">35</td></tr><tr><td align="center">Hs</td><td align="center"><font color="orange">72</font></td></tr><tr><td align="center">D</td><td align="center"><font color="red">90</font></td></tr><tr><td align="center">Hy</td><td align="center">69</td></tr><tr><td align="center">Pd</td><td align="center">64</td></tr><tr><td align="center">Mf</td><td align="center"><font color="red">76</font></td></tr><tr><td align="center">Pa</td><td align="center">61</td></tr><tr><td align="center">Pt</td><td align="center"><font color="red">77</font></td></tr><tr><td align="center">Sc</td><td align="center"><font color="orange">71</font></td></tr><tr><td align="center">Ma</td><td align="center">48</td></tr><tr><td align="center">Si</td><td align="center"><font color="red">79</font></td></tr></tbody></table><p>上表中, 已经将大于或等于 75 分的结果标为<font color="red">红色</font>, 将介于 70-74 分 (包含两端) 的结果标为<font color="orange">橙色</font>.</p><p>量表的结果仅仅只能作为一个参考. 按照一些人 (例如我的父母) 的意见, 我自然有 “操纵” 量表的权利, 量表也未必能表征我未来的心理状态. 所以说, 大概还是要看一个比较长期的评估结果才能达到一个比较高的可参考性. 当然我保证上述的这次测量过程中, 我是如实回答了 399 个问题.</p><h3 id="The-dark-runner"><a href="#The-dark-runner" class="headerlink" title="The dark runner"></a>The dark runner</h3><p><img src="/myself/goodbye-2022/277c49b7c89702fe76803f181b1d7d53.jpg" alt="277c49b7c89702fe76803f181b1d7d53.jpg"></p><p>如果我没记错的话, 这应该是我尚在宿舍的某一夜拍摄的. 这就是我惯常的生活环境 - 被足以称为 “伸手不见五指” 的漆黑笼罩, 仅有膝前的笔记本电脑照亮胸前的裙子. 宿舍门是开着的, 这是为了保证房间外仍能搜索到一些网络信号. 这张图还并没有到达极限, 因为我还没有拉上窗帘. 出于一些未知原因, 我似乎丢失了很多照片, 拍摄我的生活空间的照片中只剩下这一张是尽显漫长的黑暗的. 事实上, 很多时候, 我在黑夜中都会拉下所有的窗帘, 甚至在白天也是如此, 即便身处一片黑暗中会唤醒我童年时期所看的各种恐怖影像的回忆.</p><p>不过这大概也不算是 “恐光症” - 我也不知道这是不是一种精神疾病. 如果是正常的必要的出行, 或者是惯例的散步, 出去吃饭之类, 我可以正常地沐浴在光线之下, 但是一旦回到了宿舍或者是家里的环境, 我就经常开始渴求黑暗. 除了拉下窗帘之类, 我还会尝试去关宿舍里的卫浴灯和排气扇, 当然一些人进去都会随手打开所有的灯和排气扇, 走的时候还不知道把它们都关上. 这种制造光线和增加噪音的行为困扰了我很久, 每次这个时候我都会露骨地跑过去关上. 这种行为, 少说已经做了上百次. 有的时候, 穿着裙摆很长的裙子坐在高脚凳上行动实在是不怎么方便: 我还需要确认双脚已经稳当地站在了地面上, 转身把膝上的笔记本电脑放在椅子上, 关了灯和排气扇之后还要拿着笔记本电脑轻轻一蹬坐上椅子, 确认身子的重心不会晃动, 然后再打开笔记本盖子继续刚刚的工作. 说实话, 我有的时候挺讨厌这种无意义的重复行为, 但是毕竟世上绝大多数人不会不论白天还是黑夜都去把房间搞得一团黑, 这导致有的时候我也不好意思去贴个什么告示让他们把灯啊之类的都关上, 所以我最后还是一个人默默地做这些事情.</p><p>我现在在哪呢? 我在家里, 坐在自己的床上. 现在我的周围, 最亮的光源就是笔记本电脑的屏幕, 右侧的窗户映着橘黄色的路灯, 左侧的房门底下的门缝透出客厅的光亮, 还能漏出家人模糊的声音. 仿佛周围的一切都与我无关. 有的时候我多么希望真的与我无关, 但我也知道无关的话我早就饿死了. 没有经济独立的小鬼是这样的.</p><p>关于这种状况, 之前某一次与父母的简短会面中, 对方提到我在过去 (应该是高中时期) 也出现过类似的情况.</p><h3 id="回到性身份认同的问题"><a href="#回到性身份认同的问题" class="headerlink" title="回到性身份认同的问题"></a>回到性身份认同的问题</h3><p>最近的一条<a href="https://twitter.com/LittleYe233/status/1608341014863024128?s=20">推文</a>中, 我第一次在公开场合提及我的 gender dysphoria 的问题 - 如果可以的话, 这个问题我想让它永远被埋葬, 但是但凡去医院的精神科, 医生都会去问一下性身份认同障碍的问题持续了多久. 我估摸着从小学乃至幼儿园持续的各种形式的对性身份的怀疑和烦躁对于获取一份 “易性症” 的诊断是有利的, 而我现在的比较尴尬的情况如果实话实说, 我能在研究生毕业开出来个诊断就是谢天谢地了. 不过我也确实没怎么去过医院 - 甚至因为现在的情况而有点自知之明, 有点害怕跑去医院得到一个 “你这一切正常” 的结论. 所以, 我也不知道医院到底会如何对一个自诉性身份认同问题的人进行相关的评估. 不过我觉得症状持续的时间应该是其中一个衡量标准.</p><p>根据我自己的一份记录, 我在 2021 年底已经了解了跨性别者这一群体的存在, 但是仔细地感受自己的心境则是在今年 (2022 年) 的七月底八月初. 因为某件事情 - 如果当事人看到这里, 应该不会猜不到吧 - 我试图将我当时的心理状态, 和从我入学开始持续了整整一年的 “系统性” 的女装行为, 以及中学阶段我的一些若有若无的反应联系起来. 最终得到了某一个结论 - “我不知道”. 但是还是补充了一点, “如果我最后吃了雌激素药物, 我大概会走到<em>最后</em>吧”. 如果从我现在的想法来看, 大概这个结论还没有被打破. 我<em>自</em>认为我现在的 “想法” 比几个月前要坚定很多, 不过在别人看来我就不怎么清楚了. 至少比较好的是, 我脱离了今年暑假那个阶段比较矛盾的 “我不知道” 的阶段, 从一个稳态到了另一个稳态.</p><p>顺便提一下, 我在开始 HRT 之后, 性欲就开始逐渐减退, 乃至逐渐向反方向的 “没有意义” “厌恶” 转变, 与 2022 年的上半年, 以及之前的心理状态都没有办法相比. 有人提到是我补佳乐吃得不够, 以及我现在进行 HRT 的时间并不长. 不知道未来的我的心境会怎么样呢? 不过我觉得, 即便未来性欲能够逐渐恢复, 大概也不会动下面那个东西吧.</p><p>(不过我知道我确实没储备多少补佳乐, 所以我也不会每天把自己弄到 “雌爆” 的地步.)</p><h3 id="亡命之徒"><a href="#亡命之徒" class="headerlink" title="亡命之徒"></a>亡命之徒</h3><p>并不是说我提着把菜刀上街砍人, 抑或是飙车撞死几个路人. “亡命”, 在这里更侧重强调的是风险控制. 这一年, 尤其是最后一两个月, 我明显感觉到我对风险控制的能力 “降低” 了 - 并不是说我无法认识到某件事背后的风险, 而是感觉到对很多事情都无所谓了, 或者是发生过某件事情, 就想着可以将其扩大化到极致. 关于后者的一个比较常见的例子是一些 privacy. 在一些群组中, 我通常一开始会隐藏自己的个人身份, 但如果因为一些原因我被迫或者是无意中暴露了自己的一些身份信息的话 (例如我在墙内的通用网名), 我可能就会不再在意这个隐私项目了, 而是将其看作是一个早已被公开的事实; 另外一个实例就是 <a href="https://github.com/komeiji-satori/Dress/">Dress</a> 项目 - 这是一个相当著名的托管于 GitHub 的女装项目, 我之前也在上面斗胆 <a href="https://github.com/LittleYe233/Dress/">PR</a> 了一些照片. 当然我知道我现在还相当不够 pass, 我也知道即便我比较 pass 我也没必要到处宣扬我的女装照片, 所以我几乎从来没有这么做过. 不过如果在某个与上述类似的群组中有人抛起这个话题, 我可能会在某个合适的时候提出 “我贡献过” 的事实, 即便这可能蕴含着一定的风险 - 例如被进一步开盒的风险, 或者是被作为某次威胁的筹码的风险, 不过考虑到我现在的知名度确实相当有限甚至可以说没有, 所以这些现在看来似乎也没有什么. 况且, 某种程度上, 我掌握着… 是否开自己盒的主动权? <del>我把自己的盒开完了, 别人就没得开了哇哈哈哈哈哈!</del></p><blockquote><p>你又不是 Linus, 谁关心你那几个身份啊.</p><p>- 某大佬</p></blockquote><p>包括我在进行 HRT 的事情, 我对同辈也几乎没有做什么隐瞒. 别人一进我宿舍就能看到桌子上摆了一堆补佳乐和雌二醇凝胶. 我也经常直接把吃了一半的补佳乐板子扔宿舍外面的桌子上. 所以我相信平时跟我物理距离比较近的人都知道我在吃相关的药物了. 要说女装行为本身就更不用提了. 龟缩在宿舍床上女装本身也 makes no sense, 甚至可以说不展示出来就是毫无价值.</p><p>当然, “亡命之徒” 当久了, 要说一点没有被麻痹也是不可能的. 有的时候我希望能找点刺激, 或者是真的受了什么刺激导致脑子出了什么 bug, 我希望别人发现我的一些秘密, 最后让我陷入比较大的风险之中. 这一点最显著的表现就是最近回家之后藏药的事情. 家里人自然是不知道我现在正在 HRT 的事实, 即便知道了恐怕也很难接受我开始服用雌性激素药物, 所以对于包里几盒补佳乐的事情我自然是要隐瞒的. 包括我之前发现我有几份激素检测报告还夹在教科书里, 上面的结果一看就知道肯定是对自己的内分泌做了什么手脚. 不过有的时候, 我竟然冒出, 想要不经意间让父母发现的想法. 这无疑会引发这个假期甚至人生以来最大的家庭矛盾, 不过我竟然真的觉得 - “好像也无妨” - 诸如此类的危险想法. 当然目前我还没有这么做 (如果真的做了, 我能不能在这里敲年终总结都是个未知数), 但是它真的没法完全从我的脑海中驱离, 而是仍然漂浮在记忆之海中, 时不时就会探出头让我意识到这件事.</p><h2 id="我阳性了"><a href="#我阳性了" class="headerlink" title="我阳性了"></a>我阳性了</h2><p>回家的第三天清晨, 我突然感觉到额头有些发热, 伴有轻微的头晕症状, 我心里大呼不妙 - 不会是阳性了吧. 我家里没有足够多的抗原, 这些也准备留给别人, 不过我简单测了一下体温 - 37.2℃ - 也不能说能够独善其身了, 我就乖乖做好了阳性的准备.</p><p>接到群里一些学长们很快就恢复健康的好消息, 我自然也没有那么畏惧, 结果没想到的是, 可能是我在家乡染上的毒株毒性比较强, 又可能是到了遍地阳性的家乡吸入的病毒载量比较高, 我阳性之后的身体状态明显比家里人同期差很多, 甚至过了一周才慢慢有退烧的架势, 令我叫苦不迭. 关于我与新冠病毒的抗争过程直接看 Notion 的<a href="https://mirror-supernova-d72.notion.site/14f36b43756e44bfb711a612e93a1559">文档</a>即可, 我就不在这里赘述了, 不过值得注意的是, 我在发病期间频繁想到死亡, 最后也加重了我在前言中提及的 “对生死的思考” 的状态.</p><p>可能一些人会在年终总结中提到国家的这些政策. 我心里自然有一个自私的衡量尺度, 不会在这里提, 不过大概有不少人的想法跟我是类似的. 政策已经实施, 你我也没什么左右的空间, 只能在时代的大潮中随波逐流. 对像我这种普通人来说, 活着, 就好啦. 相信新的 2023 年, 一切都会回到正轨的. 不过, 看到那些普通人在这场全球性瘟疫中艰难求生, 或者因为各种形式的次生灾害而凄凉死去的时候, 我还是会悲伤, 会愤慨, 又因为自己力量的渺小而无奈. 可能我没法做到什么实质性的事情, 不过有一份朴素的正义感就已经足够了.</p><h2 id="有关我的情感诉求"><a href="#有关我的情感诉求" class="headerlink" title="有关我的情感诉求"></a>有关我的情感诉求</h2><p>考虑到现在的时间 (<code>2022-12-31T21:24:13Z+0800</code>) 和我的精力, 这大概是这篇相当长度的非常繁杂的年终总结的最后一个主要板块. 在这里, 我想要稍微认真一点, 写一下我同样讳莫如深的情感方面的事情.</p><p>我在小学五六年级的时候开始萌发对异性 (那个时候显然还是生理女性) 的好感. 一些人知道我在初一的时候曾经对女同桌有一些想法, 不过后来这种情感很快就消失了. 此后我一直很少对女生有什么所谓的 “恋爱” 的想法. 这并不是说我觉醒为 MtF 了, 而是在当时的应试教育大环境下, 我做不到一边苦苦维持惨淡的成绩一边和女生谈恋爱, 而且我确实不怎么会玩, 对于社交也是马马虎虎, 也没有什么突出的成绩, 自然在中学丧失了择偶权.</p><p>到了大学, 我仍然对女性没什么谈恋爱乃至结婚育子的想法, 但是我现在有其他方面 - 例如普通的 “社交” 方面的需求. 我逐渐发现一个人的世界并不够稳定. 我的一切的人生目标和人生价值的实现, 与我目前的生活并不相称. 我终究需要一个, 嗯, 某个人或者是一群人, 发展更加<em>进一步</em>的关系 - 提前说明一下并不是淫趴, 我对三次元的多 P 不感兴趣. 不过我现在所处的专业让我对周围的人实在是没什么好感, 外加上我仍然是不懂现代的大学生会怎么玩, 而且因为一些原因我的宿舍离我班上的大多数人比较远, 我也没什么机会自然地融入他们, 所以我至今对于同一个班上的关系几乎没什么发展的空间.</p><p>但是, 我非常开心的是, 我在网上认识到我们学校以及外校的计算机系学生, 他们在计算机科学方面的水平都很高. 我很高兴能加入到他们的团体中, 并且在 2022 年能够逐渐地活跃其中, 即便我知道我现在的水平还远远不及他们, 不过这个 chatting 的环境让我感觉到很舒适, 让我感觉到 “啊, 他们是同类啊” 的愉快的感觉, 与周围同系的人的交流的感觉<strong>完全不同</strong>.</p><p>最近来看, 当然他们有的时候因为一些契机开始大谈特谈我听不懂的编译原理, 操作系统 (?) 啊还是什么各种我听不懂的技术, 我还是有的时候会深深地自卑, 甚至会没来由地大为光火, 动辄 Archive 群组甚至退群, 不过我也在慢慢地忍耐下来, 能够正视这样的事实. 退群好比是逃避, 我最终必然要面对我与别人的差距, 否则我就没有办法进步.</p><p>如果保持着这样的心理状态也挺好的, 一个人受不了了就水水群, 时间很快也就过去了. 不过, 某一天之后, 我被染上了别的色彩.</p><h3 id="lt-恋する気持ち-gt"><a href="#lt-恋する気持ち-gt" class="headerlink" title="&lt;恋する気持ち&gt;"></a>&lt;恋する気持ち&gt;</h3><p>这里提到的 &lt;<a href="https://music.youtube.com/watch?v=LEPYiL7HTgQ&feature=share">恋する気持ち</a>&gt; 是<a href="https://ja.wikipedia.org/wiki/%E8%A5%BF%E9%87%8E%E3%82%AB%E3%83%8A">西野カナ</a>所作音乐专辑 &lt;<a href="https://ja.wikipedia.org/wiki/With_LOVE">with LOVE</a>&gt; DISC 1 的第 3 个曲目. 我最早听到这首歌的一个版本竟然还是 Nightcore, 其本身也是做的一个比较简单的音乐可视化的效果, 我现在找不到视频的出处了, 不过我很快注意到视频标题中的 “Koi suru Kimochi” 我可以一瞬间闪过正确的日文写法, 不禁觉得跟着学校的文理通识课上了俩学期的日语还是有点用处的.</p><p>之后在 YouTube Music 听过几首西野カナ的歌之后, 自然我就被推送到了她的版本. 一边听, 我就一边开始想象我的 “Feeling in love” 了… 想象什么呢? 毕竟我从来没谈过, 我也不知道真正的 Feeling in love 是什么样子的. 不知道是不是受 HRT 影响的, 我现在对对方的性别已经不在意了, 不论是顺男顺女还是各种方向的跨, 关键还是看是不是情投意合吧. 不过我从来不承认我是同性恋者 - 喜欢一个人又不是喜欢整个拥有某种生殖器的群体.</p><p>但是, 我的心境确实发生了变化. 有的时候, 我会静静地躺在床上, 想象 Ta 正在做什么, 想象 Ta 眼中的世界是何种模样, 或者是频繁刷新聊天工具的页面, 生怕漏掉 Ta 的任何一条消息 (同为开发者, 应该意识到替消息队列瞎操心是没什么必要的才对). 有的时候看到有未读的消息, 还会抱着手机原地害羞许久, 在听录音的时候尤甚. 有的时候寄来的是纸质的书信, 上面的动作同样会持续好一阵子, 而且有的时候就会把每一封既往来信从头到尾重新读一遍. 尽管没有见面几次, 有的时候脑海中还是会浮现 Ta 的若有若无的身影, 让我心跳加速…</p><p>我与影视作品中那些呆瓜男主角不一样, 我大概明白 “啊, 我大概就是那种心情吧”. 但是这似乎也没有什么意义. 处理这些心情的时候, 我<em>自</em>认为是最接近女生的, 然而选择权并不在我的手上. 而且因为一些原因, 我更希望 Ta 能找到真正能理解 Ta, 接近 Ta, 能微笑着说 “余生请多指教” 的人… 唉, 到了这个时候, 我就不禁羡慕起那个人了.</p><details><summary>最后一小段副歌的 snippet</summary><blockquote><p>もしかしたらって時々</p><p>見つめてしまう無意識に</p><p>恋する気持ち (恋する気持ち)</p><p>キミも同じなら (Ah Ah)</p><p>もしかしたらって　ドキドキ</p><p>抑えられない簡単に</p><p>恋する気持ち (恋する気持ち)</p><p>独りよがりかな (Ah Ah)</p><p>絶対ありえないけど　近づいてみたら</p><p>君の顔に何か書いてないかな</p><p>絶対ありえないけど　耳を澄ましたら</p><p>心の声が聞こえてこないかな</p><p>Could it be that sometimes</p><p>When we catch each other’s eyes, unconsciously</p><p>Feelings of love (Feelings of love)</p><p>If you feel the same (Ah Ah)</p><p>Could it be that it’s not easy</p><p>To stop this racing heart</p><p>Feelings of love (Feelings of love)</p><p>Am I just convincing myself? (Ah Ah)</p><p>It’s surely impossible, but if I look closely</p><p>Will I see anything written on your face?</p><p>It’s surely impossible, but if I listen closely</p><p>Will I be able to hear the voice of your heart?</p></blockquote><p>来源: <a href="https://www.jpopasia.com/kananishino/lyrics/252024/with-love/koisuru-kimochi-%E6%81%8B%E3%81%99%E3%82%8B%E6%B0%97%E6%8C%81%E3%81%A1-the-feeling-of-love/">https://www.jpopasia.com/kananishino/lyrics/252024/with-love/koisuru-kimochi-%E6%81%8B%E3%81%99%E3%82%8B%E6%B0%97%E6%8C%81%E3%81%A1-the-feeling-of-love/</a>.</p></details><h2 id="build-release-tag-the-year-2022"><a href="#build-release-tag-the-year-2022" class="headerlink" title="build(release): tag the year 2022"></a><code>build(release): tag the year 2022</code></h2><p>了解过 <a href="https://www.conventionalcommits.org/en/v1.0.0/">Conventional commits</a> 的读者应该能看出来这个小节的标题正是根据这一 “convention” 来设计的. 现在 (<code>2022-12-31T22:37:52Z+0800</code>) 距离跨年的瞬间只剩短短的一个多小时了. 所幸 - 我终于可以长舒一口气了 - 我不至于写不完这篇杂文了. 虽然说有的话题没有提及, 但是这篇文章最后呈现的效果已经让我甚是满意了 - 本身就不是什么语言文字功底很强的人, 还想要什么自行车呢? 不过今年最后一点时间被占用之后, 我就很对不起催收我的实验报告和作业的助教了. すみません!</p><p>想来, 这一年, 我也作为历史的亲历者和见证者, 见证了 “动态清零” 的终结, 见证了全校学生的名字被填充进学校大门的白名单, 见证了社会的齿轮逐渐转动起来. 对于我自己, 我不敢说年龄长了一岁让我有什么成长和进步, 但是不能不提的是, 我在很多方面懂得了很多, 也思考了很多, 这些在文字中三言两语也很难道明. 我认识到, 有爱我的人, 有我所爱的人. 过去常常被家人笑称 “晚熟” 的我, 在这一年唤醒了很多很多情绪. 我意识到, 我自己是由我自己控制的, 而不应该继续一味地顺从父母的意见. 虽然还有些模糊, 但是我似乎终于意识到了我想要实现的目标应该是什么.</p><p>说句实在话, 我始终不会承诺放弃最极端的 “自残” 或 “自杀” 的手段, 但是如果能承受得住的话, 我当然是想活下去呐! 我想完成我的学业, 我想要研究我想研究的事物, 我想变成我期待的样子, 我想为改变社会, 改变世界贡献一份力量. 目前来看, 我暂时还不会考虑走到这一步 (而且我遗书真的还没写完呐), 所以请一直劝我放弃自杀的人冷静一下, 我今年是不会跳楼之类的.</p><p>2022 年还是要结束了… 过去熠熠生辉的瞬间, 我们难以忘怀, 感慨万千; 新的一年, 我们终会创造新的闪闪发光的回忆.</p><p><strong>我衷心地祝愿, 各位读者能够在新的一年身体健康, 诸事顺利, 家庭圆满, 成为一个理想的自己, 无悔于过去的一年.</strong></p><p>那么, 让我们在 2023 年再会吧!</p><p><strong>[完]</strong></p>]]></content>
    
    
    <summary type="html">如果将过去一年的回忆化为 Change log, 不知道有多少 `feat`, 有多少 `revert`, 又有多少 &quot;bug fixes and other minor improvement&quot; 呢.</summary>
    
    
    
    <category term="Essay" scheme="https://blog.tamako.work/categories/Essay/"/>
    
    
    <category term="Self Analysis" scheme="https://blog.tamako.work/tags/Self-Analysis/"/>
    
    <category term="New Year" scheme="https://blog.tamako.work/tags/New-Year/"/>
    
  </entry>
  
  <entry>
    <title>使用 GPG 加密、解密和验证信息</title>
    <link href="https://blog.tamako.work/techdev/gpg-encryption-decryption-validation/"/>
    <id>https://blog.tamako.work/techdev/gpg-encryption-decryption-validation/</id>
    <published>2022-12-09T14:37:42.000Z</published>
    <updated>2022-12-09T14:37:42.000Z</updated>
    
    <content type="html"><![CDATA[<p>本文将主要利用 <a href="https://en.wikipedia.org/wiki/GNU_Privacy_Guard">GNU Privacy Guard</a> (简称 “GnuPG” 或 “GPG”) 完成信息的加密, 解密和验证任务. 本文不会对 GPG 的工作原理以及 OpenPGP 的规范 (参见 <a href="https://datatracker.ietf.org/doc/html/rfc4880">RFC 4880</a>) 做过多的解读. 仅针对完成上述的任务而言, 只需要对其了解大体的情况即可.</p><span id="more"></span><h2 id="简要原理"><a href="#简要原理" class="headerlink" title="简要原理"></a>简要原理</h2><p><img src="https://upload.wikimedia.org/wikipedia/commons/4/4d/PGP_diagram.svg" alt="How PGP encryption works visually"></p><p>以上截取自 <a href="https://en.wikipedia.org/wiki/Pretty_Good_Privacy">Pretty Good Privacy</a> 维基词条的 SVG <a href="https://en.wikipedia.org/wiki/File:PGP_diagram.svg">图像</a> (可能需要切换为亮色模式以看清图中的文字). 其中的大部分工作将会由 GPG 完成. 读者需要注意的是从图中可以看到 “receiver’s public key” 和 “receiver’s private key” - 这暗示 OpenPGP 标准中存在 “公钥” 和 “私钥” 两个概念, 且这两种密钥都归属于同一个人. 加密时, 信息发送者需要信息接收者的公钥; 解密时, 信息接收者需要自己的私钥.</p><h2 id="测试环境"><a href="#测试环境" class="headerlink" title="测试环境"></a>测试环境</h2><p>笔者将主要使用本机的 Arch Linux 进行测试和演示. 同时会利用一台远端的 Linux 服务器用以演示双方通信操作.</p><h3 id="涉及软件包"><a href="#涉及软件包" class="headerlink" title="涉及软件包"></a>涉及软件包</h3><ul><li><code>core/gnupg</code> - 提供 <code>gpg</code></li><li><code>core/coreutils</code> - 提供 <code>tr</code>, <code>head</code></li><li><code>core/openssh</code> - 提供 <code>ssh</code>, <code>scp</code></li></ul><h3 id="信息"><a href="#信息" class="headerlink" title="信息"></a>信息</h3><p>本文中涉及到本地机器的所有工作将在 <code>~/Temp/gpg</code> 文件夹下进行. 该文件夹下有需要传输的信息 <code>message.txt</code>:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cat</span> message.txt</span>        </span><br><span class="line">CjYIdc[&quot;Ns`3[BA\=5#+TM&lt;[ORUhQ|i-E&gt;!S0e!hc_A&#x27;R_h!9SU2v$oJ2SIKGp&quot;l</span><br></pre></td></tr></table></figure><h3 id="信息收发双方"><a href="#信息收发双方" class="headerlink" title="信息收发双方"></a>信息收发双方</h3><table><thead><tr><th align="center">角色</th><th align="center">用户名</th><th align="center">邮箱</th></tr></thead><tbody><tr><td align="center">发送者</td><td align="center"><code>test1</code></td><td align="center"><code>test1@foo.bar</code></td></tr><tr><td align="center">接收者</td><td align="center"><code>test2</code></td><td align="center"><code>test2@foo.bar</code></td></tr></tbody></table><h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><h3 id="安装-GPG"><a href="#安装-GPG" class="headerlink" title="安装 GPG"></a>安装 GPG</h3><p>Linux 环境无需多言. 对于 Windows 可以选择 <a href="https://www.gpg4win.org/">Gpg4win</a> - 这是一个 GPG 在 Windows 上的实现.</p><h3 id="生成强密码"><a href="#生成强密码" class="headerlink" title="生成强密码"></a>生成强密码</h3><p>后续的操作中可能会涉及到生成强密码的需求. 自然, 一个可以在脑中记住的强密码是最好不过的, 不过这里将演示一个利用 <code>/dev/urandom</code> 生成高强度密码的方法:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">tr</span> -dc <span class="string">&quot;[:graph:]&quot;</span> &lt; /dev/urandom | <span class="built_in">head</span> -c 64; <span class="built_in">echo</span> <span class="string">&#x27;&#x27;</span></span></span><br><span class="line">Q-SU0QZA:&#123;6h%LLoR@Bd2M#jPOb.nu8&amp;xcimt&#125;atyo|G]O&#123;Ay&gt;+R;T&#x27;gGrUH)bWk</span><br></pre></td></tr></table></figure><p>其主要原理是, <code>tr</code> 可以 “translate or delete characters”<a href="https://man7.org/linux/man-pages/man1/tr.1.html">^1</a>. <code>tr</code> 从 <code>/dev/urandom</code> 设备文件中获取到随机字符流后, 可以仅保留符合 <code>[:graph:]</code> 条件 (“all printable characters, not including space”<a href="https://man7.org/linux/man-pages/man1/tr.1.html">^1</a>) 的字符, 再让 <code>head</code> 截取其中的前 64 个字符即可. 由此得到的则是长度为 64 的随机可见字符串.</p><p>同理, 若要生成 32 位仅包含小写字母和数字的字符串:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">tr</span> -dc <span class="string">&quot;a-z0-9&quot;</span> &lt; /dev/urandom | <span class="built_in">head</span> -c 32; <span class="built_in">echo</span> <span class="string">&#x27;&#x27;</span></span></span><br><span class="line">b2ylyqcs9x5gureu43b3ycw9txgww5sb</span><br></pre></td></tr></table></figure><h3 id="生成低熵随机数"><a href="#生成低熵随机数" class="headerlink" title="生成低熵随机数"></a>生成低熵随机数</h3><p>一些无头服务器可能无法满足 “低熵” 的条件, 从而导致生成的随机数不满足一些安全性要求较高的程序 (例如本文提到的 GPG) 的需求. Linux 上可以借助 <a href="https://wiki.archlinux.org/title/Haveged"><code>haveged</code></a>, <a href="https://wiki.archlinux.org/title/rng-tools"><code>rng-tools</code></a> 等来避免这种情况. 本文不再赘述.</p><h2 id="密钥操作"><a href="#密钥操作" class="headerlink" title="密钥操作"></a>密钥操作</h2><h3 id="生成密钥"><a href="#生成密钥" class="headerlink" title="生成密钥"></a>生成密钥</h3><p>使用 <code>gpg --full-generate-key</code> 来生成一个密钥对. 以下的代码块记录了终端中回显的整个过程.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">gpg --full-generate-key</span>      </span><br><span class="line">gpg (GnuPG) 2.2.40; Copyright (C) 2022 g10 Code GmbH</span><br><span class="line">This is free software: you are free to change and redistribute it.</span><br><span class="line">There is NO WARRANTY, to the extent permitted by law.</span><br><span class="line"></span><br><span class="line">Please select what kind of key you want:</span><br><span class="line">   (1) RSA and RSA (default)</span><br><span class="line">   (2) DSA and Elgamal</span><br><span class="line">   (3) DSA (sign only)</span><br><span class="line">   (4) RSA (sign only)</span><br><span class="line">  (14) Existing key from card</span><br><span class="line">Your selection? 1</span><br><span class="line">RSA keys may be between 1024 and 4096 bits long.</span><br><span class="line">What keysize do you want? (3072) 4096</span><br><span class="line">Requested keysize is 4096 bits</span><br><span class="line">Please specify how long the key should be valid.</span><br><span class="line">         0 = key does not expire</span><br><span class="line">      &lt;n&gt;  = key expires in n days</span><br><span class="line">      &lt;n&gt;w = key expires in n weeks</span><br><span class="line">      &lt;n&gt;m = key expires in n months</span><br><span class="line">      &lt;n&gt;y = key expires in n years</span><br><span class="line">Key is valid for? (0) 0</span><br><span class="line">Key does not expire at all</span><br><span class="line">Is this correct? (y/N) y</span><br><span class="line"></span><br><span class="line">GnuPG needs to construct a user ID to identify your key.</span><br><span class="line"></span><br><span class="line">Real name: test1</span><br><span class="line">Email address: test1@foo.bar</span><br><span class="line">Comment: test1&#x27;s PGP key</span><br><span class="line">You selected this USER-ID:</span><br><span class="line">    &quot;test1 (test1&#x27;s PGP key) &lt;test1@foo.bar&gt;&quot;</span><br><span class="line"></span><br><span class="line">Change (N)ame, (C)omment, (E)mail or (O)kay/(Q)uit? o</span><br><span class="line">We need to generate a lot of random bytes. It is a good idea to perform</span><br><span class="line">some other action (type on the keyboard, move the mouse, utilize the</span><br><span class="line">disks) during the prime generation; this gives the random number</span><br><span class="line">generator a better chance to gain enough entropy.</span><br><span class="line">We need to generate a lot of random bytes. It is a good idea to perform</span><br><span class="line">some other action (type on the keyboard, move the mouse, utilize the</span><br><span class="line">disks) during the prime generation; this gives the random number</span><br><span class="line">generator a better chance to gain enough entropy.</span><br><span class="line">gpg: revocation certificate stored as &#x27;/home/littleye233/.gnupg/openpgp-revocs.d/EB28C6D42ACFC1798DC7D1CB46D85BAE755DB198.rev&#x27;</span><br><span class="line">public and secret key created and signed.</span><br><span class="line"></span><br><span class="line">pub   rsa4096 2022-12-09 [SC]</span><br><span class="line">      EB28C6D42ACFC1798DC7D1CB46D85BAE755DB198</span><br><span class="line">uid                      test1 (test1&#x27;s PGP key) &lt;test1@foo.bar&gt;</span><br><span class="line">sub   rsa4096 2022-12-09 [E]</span><br></pre></td></tr></table></figure><p>其中需要用户回答如下几个问题:</p><ul><li>密钥的种类 - <code>RSA and RSA</code></li><li>RSA 密钥的长度 - <code>4096</code></li><li>密钥的有效期 - <code>key does not expire</code></li><li>确认信息正确性 - <code>y</code></li><li>真实姓名 - <code>test1</code></li><li>电子邮件地址 - <code>test1@foo.bar</code></li><li>注释 - <code>test1&#39;s PGP key</code></li><li>确认信息正确性 - <code>o</code></li><li><strong>(未回显)</strong> <strong>(可选)</strong> 密码片语 (passphrase)</li></ul><p>若设置密码片语, 在解密时则需要输入该字符串.</p><h3 id="查看密钥"><a href="#查看密钥" class="headerlink" title="查看密钥"></a>查看密钥</h3><p>查看本机中导入或生成的密钥有多种形式.</p><h4 id="列出私钥和指纹"><a href="#列出私钥和指纹" class="headerlink" title="列出私钥和指纹"></a>列出私钥和指纹</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">gpg --list-secret-keys --keyid-format=long --with-fingerprint</span></span><br><span class="line">gpg: checking the trustdb</span><br><span class="line">gpg: marginals needed: 3  completes needed: 1  trust model: pgp</span><br><span class="line">gpg: depth: 0  valid:  11  signed:   0  trust: 0-, 0q, 0n, 0m, 0f, 11u</span><br><span class="line">/home/littleye233/.gnupg/pubring.kbx</span><br><span class="line">------------------------------------</span><br><span class="line">... 省略多个私钥 ...</span><br><span class="line"></span><br><span class="line">sec   rsa4096/46D85BAE755DB198 2022-12-09 [SC]</span><br><span class="line">      Key fingerprint = EB28 C6D4 2ACF C179 8DC7  D1CB 46D8 5BAE 755D B198</span><br><span class="line">uid                 [ultimate] test1 (test1&#x27;s PGP key) &lt;test1@foo.bar&gt;</span><br><span class="line">ssb   rsa4096/EEAD650E9DE15AB8 2022-12-09 [E]</span><br></pre></td></tr></table></figure><h4 id="列出公钥和指纹"><a href="#列出公钥和指纹" class="headerlink" title="列出公钥和指纹"></a>列出公钥和指纹</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">gpg --list-keys --keyid-format=long --with-fingerprint</span> </span><br><span class="line">/home/littleye233/.gnupg/pubring.kbx</span><br><span class="line">------------------------------------</span><br><span class="line">... 省略多个公钥 ...</span><br><span class="line"></span><br><span class="line">pub   rsa4096/46D85BAE755DB198 2022-12-09 [SC]</span><br><span class="line">      Key fingerprint = EB28 C6D4 2ACF C179 8DC7  D1CB 46D8 5BAE 755D B198</span><br><span class="line">uid                 [ultimate] test1 (test1&#x27;s PGP key) &lt;test1@foo.bar&gt;</span><br><span class="line">sub   rsa4096/EEAD650E9DE15AB8 2022-12-09 [E]</span><br></pre></td></tr></table></figure><p>如果仅仅需要获取公钥指纹 (Key fingerprint) 等信息, 这个指令和上一条指令呈现的结果几乎类似. 但前者同时可以列出导入的公钥 - 这对于加密和验证信息的工作很有用.</p><h4 id="导出公钥"><a href="#导出公钥" class="headerlink" title="导出公钥"></a>导出公钥</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">gpg --<span class="built_in">export</span> --armor 46D85BAE755DB198</span></span><br><span class="line">-----BEGIN PGP PUBLIC KEY BLOCK-----</span><br><span class="line">... 省略具体内容 ...</span><br><span class="line">-----END PGP PUBLIC KEY BLOCK-----</span><br></pre></td></tr></table></figure><p><code>--armor</code> 选项在 GPG 的<a href="https://linux.die.net/man/1/gpg">帮助文档</a>中有如下说明:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--armor</span><br><span class="line">-a     Create ASCII armored output.  The default is to create the binary OpenPGP format.</span><br></pre></td></tr></table></figure><p>这种输出形式便于在不同机器之间传输密钥<a href="https://gist.github.com/LittleYe233/ee3f54c21ae8f4fd6da7b4c06b50e7c6">^2</a>. 同时这也是一种很好的分享公钥的方式:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpg --output test1_at_foo_dot_bar.asc --export --armor 46D85BAE755DB198</span><br></pre></td></tr></table></figure><p>值得注意的是, 这里确定密钥使用的是密钥 ID - <code>46D85BAE755DB198</code>. 事实上, 换用真实姓名和电子邮箱也是可以用来确定密钥的. 这里可以看出, 如果对同一个真实姓名或电子邮箱生成了多个密钥, GPG 在搜索密钥时, 默认会从列表中的第一个符合条件的密钥开始. 这在一些场合下 (例如需要输入密码片语的情景, 此时为了跳过某个密钥可能需要反复关闭输入密码片语的窗口) 可能会比较烦人. 因此, 若确实有需要多个 PGP 密钥的场合, 请最好避免使用相同的真实姓名和电子邮箱.</p><h4 id="导出私钥"><a href="#导出私钥" class="headerlink" title="导出私钥"></a>导出私钥</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">gpg --export-secret-key 46D85BAE755DB198</span></span><br><span class="line">-----BEGIN PGP PRIVATE KEY BLOCK-----</span><br><span class="line">... 省略具体内容 ...</span><br><span class="line">-----END PGP PRIVATE KEY BLOCK-----</span><br></pre></td></tr></table></figure><h3 id="导入密钥"><a href="#导入密钥" class="headerlink" title="导入密钥"></a>导入密钥</h3><p>假设 test2 用户发送来了 Ta 的 PGP 公钥 (<code>test2_at_foo_dot_bar.asc</code>), 则此时可以使用 <code>gpg --import</code> 导入:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpg --import test2_at_foo_dot_bar.asc</span><br></pre></td></tr></table></figure><p>对于远端机器, 则可以使用管道 (pipe)<a href="https://gist.github.com/LittleYe233/ee3f54c21ae8f4fd6da7b4c06b50e7c6">^2</a>:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sec   rsa4096/11B3A67EC13C2571 2022-12-09 [SC]</span><br><span class="line">      Key fingerprint = 5359 F3FA 8933 9C43 DB47  61A8 11B3 A67E C13C 2571</span><br><span class="line">uid                 [ultimate] test2 (test2&#x27;s PGP key) &lt;test2@foo.bar&gt;</span><br><span class="line">ssb   rsa4096/9C0A6E908BC7D25D 2022-12-09 [E]</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ssh root@54.255.5.62 gpg --<span class="built_in">export</span> --armor 11B3A67EC13C2571 | gpg --import</span></span><br><span class="line">gpg: key 11B3A67EC13C2571: public key &quot;test2 (test2&#x27;s PGP key) &lt;test2@foo.bar&gt;&quot; imported</span><br><span class="line">gpg: Total number processed: 1</span><br><span class="line">gpg:               imported: 1</span><br></pre></td></tr></table></figure><h3 id="移除密钥"><a href="#移除密钥" class="headerlink" title="移除密钥"></a>移除密钥</h3><p>移除公钥需要 <code>--delete-keys</code> 选项:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpg --delete-keys test2@foo.bar</span><br></pre></td></tr></table></figure><p>移除私钥则需要 <code>--delete-secret-keys</code> 选项:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpg --delete-secret-keys test2@foo.bar</span><br></pre></td></tr></table></figure><h3 id="设置信任等级"><a href="#设置信任等级" class="headerlink" title="设置信任等级"></a>设置信任等级</h3><p>默认导入的密钥的信任等级是 “unknown”. 在后续解密和验证信息的时候, 则可能会出现如下的输出:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gpg: WARNING: This key is not certified with a trusted signature!</span><br><span class="line">gpg:          There is no indication that the signature belongs to the owner.</span><br><span class="line">Primary key fingerprint: EB28 C6D4 2ACF C179 8DC7  D1CB 46D8 5BAE 755D B198</span><br></pre></td></tr></table></figure><p>此时则需要将信任等级更改为 “utimate” - 与本地生成的密钥的信任等级相同. 具体操作则是执行 <code>gpg --edit-key</code>. 例如, 在 test2 用户的远端服务器上更改 test1 用户的 PGP 密钥的信任等级时:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">gpg --edit-key test1@foo.bar</span></span><br><span class="line">gpg (GnuPG) 2.2.27; Copyright (C) 2021 Free Software Foundation, Inc.</span><br><span class="line">This is free software: you are free to change and redistribute it.</span><br><span class="line">There is NO WARRANTY, to the extent permitted by law.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pub  rsa4096/46D85BAE755DB198</span><br><span class="line">     created: 2022-12-09  expires: never       usage: SC  </span><br><span class="line">     trust: full          validity: unknown</span><br><span class="line">sub  rsa4096/EEAD650E9DE15AB8</span><br><span class="line">     created: 2022-12-09  expires: never       usage: E   </span><br><span class="line">[ unknown] (1). test1 (test1&#x27;s PGP key) &lt;test1@foo.bar&gt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">gpg&gt; </span><span class="language-bash">trust</span></span><br><span class="line">pub  rsa4096/46D85BAE755DB198</span><br><span class="line">     created: 2022-12-09  expires: never       usage: SC  </span><br><span class="line">     trust: full          validity: unknown</span><br><span class="line">sub  rsa4096/EEAD650E9DE15AB8</span><br><span class="line">     created: 2022-12-09  expires: never       usage: E   </span><br><span class="line">[ unknown] (1). test1 (test1&#x27;s PGP key) &lt;test1@foo.bar&gt;</span><br><span class="line"></span><br><span class="line">Please decide how far you trust this user to correctly verify other users&#x27; keys</span><br><span class="line">(by looking at passports, checking fingerprints from different sources, etc.)</span><br><span class="line"></span><br><span class="line">  1 = I don&#x27;t know or won&#x27;t say</span><br><span class="line">  2 = I do NOT trust</span><br><span class="line">  3 = I trust marginally</span><br><span class="line">  4 = I trust fully</span><br><span class="line">  5 = I trust ultimately</span><br><span class="line">  m = back to the main menu</span><br><span class="line"></span><br><span class="line">Your decision? 5</span><br><span class="line">Do you really want to set this key to ultimate trust? (y/N) y</span><br><span class="line"></span><br><span class="line">pub  rsa4096/46D85BAE755DB198</span><br><span class="line">     created: 2022-12-09  expires: never       usage: SC  </span><br><span class="line">     trust: ultimate      validity: unknown</span><br><span class="line">sub  rsa4096/EEAD650E9DE15AB8</span><br><span class="line">     created: 2022-12-09  expires: never       usage: E   </span><br><span class="line">[ unknown] (1). test1 (test1&#x27;s PGP key) &lt;test1@foo.bar&gt;</span><br><span class="line">Please note that the shown key validity is not necessarily correct</span><br><span class="line">unless you restart the program.</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">gpg&gt; </span><span class="language-bash">q</span></span><br></pre></td></tr></table></figure><h2 id="信息加密"><a href="#信息加密" class="headerlink" title="信息加密"></a>信息加密</h2><p>正如前文所述, 信息的加密需要信息接收者的公钥. 而刚刚笔者已经导入了 test2 用户的公钥. 现在则需要 <code>--encrypt</code> 选项来进行加密:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpg --encrypt --armor --recipient test2@foo.bar message.txt</span><br></pre></td></tr></table></figure><p><code>--armor</code> 的作用略去不提. <code>--recipient</code> 用以指定信息接收方 (这样其就可以使用自己的私钥解密), 可以指定多个 (诸如 <code>--recipient email1 --recipient email2</code> 的格式). 命令执行成功后, 当前目录会生成一个扩展名为 <code>.asc</code> 的文件 (<code>message.txt.asc</code>). 使用 <code>file</code> 查看其文件信息, 得到:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">file message.txt.asc</span> </span><br><span class="line">message.txt.asc: PGP message Public-Key Encrypted Session Key (old)</span><br></pre></td></tr></table></figure><h3 id="签名"><a href="#签名" class="headerlink" title="签名"></a>签名</h3><p><code>--sign</code> 可以表明信息的发送者是谁. 默认签名使用 “默认密钥” (若未明确设置, 则是密钥列表的第一个密钥). 若要显式指定一个密钥, 则需要使用 <code>--local-user</code> 选项. 另外换用 <code>--default-key</code> 选项可以同时设置 “默认密钥”.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpg --encrypt --armor --sign --local-user test1@foo.bar --recipient test2@foo.bar message.txt</span><br></pre></td></tr></table></figure><p>当然, 签名操作需要验证签名方的密码片语, 如果有的话.</p><h2 id="信息解密"><a href="#信息解密" class="headerlink" title="信息解密"></a>信息解密</h2><p>解密时, 则需要使用 <code>--decrypt</code> 选项:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpg --decrypt message.txt.asc</span><br></pre></td></tr></table></figure><p>与加密操作不同的是, 解密时, GPG 会尝试所有的密钥, 无需自行指定密钥.</p><p>对于未签名的加密信息, 可能的输出如下:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">gpg --decrypt message.txt.asc</span>                                   </span><br><span class="line">CjYIdc[&quot;Ns`3[BA\=5#+TM&lt;[ORUhQ|i-E&gt;!S0e!hc_A&#x27;R_h!9SU2v$oJ2SIKGp&quot;l</span><br><span class="line">gpg: encrypted with RSA key, ID EEAD650E9DE15AB8</span><br><span class="line">gpg: encrypted with 4096-bit RSA key, ID 9C0A6E908BC7D25D, created 2022-12-09</span><br><span class="line">      &quot;test2 (test2&#x27;s PGP key) &lt;test2@foo.bar&gt;&quot;</span><br></pre></td></tr></table></figure><p>对于已签名的加密信息, 在信息发送者的公钥未导入时, 此时无法检查签名, 可能的输出如下:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">gpg --decrypt message.txt.asc</span></span><br><span class="line">CjYIdc[&quot;Ns`3[BA\=5#+TM&lt;[ORUhQ|i-E&gt;!S0e!hc_A&#x27;R_h!9SU2v$oJ2SIKGp&quot;l</span><br><span class="line">gpg: encrypted with 4096-bit RSA key, ID 9C0A6E908BC7D25D, created 2022-12-09</span><br><span class="line">      &quot;test2 (test2&#x27;s PGP key) &lt;test2@foo.bar&gt;&quot;</span><br><span class="line">gpg: Signature made Fri 09 Dec 2022 04:25:43 PM UTC</span><br><span class="line">gpg:                using RSA key EB28C6D42ACFC1798DC7D1CB46D85BAE755DB198</span><br><span class="line">gpg:                issuer &quot;test1@foo.bar&quot;</span><br><span class="line">gpg: Can&#x27;t check signature: No public key</span><br></pre></td></tr></table></figure><p><a href="#%E5%AF%BC%E5%85%A5%E5%AF%86%E9%92%A5">导入</a>并<a href="#%E8%AE%BE%E7%BD%AE%E4%BF%A1%E4%BB%BB%E7%AD%89%E7%BA%A7">设置信任等级</a>后, 可能的输出如下:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">gpg --decrypt message.txt.asc</span>                    </span><br><span class="line">CjYIdc[&quot;Ns`3[BA\=5#+TM&lt;[ORUhQ|i-E&gt;!S0e!hc_A&#x27;R_h!9SU2v$oJ2SIKGp&quot;l</span><br><span class="line">gpg: encrypted with 4096-bit RSA key, ID 9C0A6E908BC7D25D, created 2022-12-09</span><br><span class="line">      &quot;test2 (test2&#x27;s PGP key) &lt;test2@foo.bar&gt;&quot;</span><br><span class="line">CjYIdc[&quot;Ns`3[BA\=5#+TM&lt;[ORUhQ|i-E&gt;!S0e!hc_A&#x27;R_h!9SU2v$oJ2SIKGp&quot;l</span><br><span class="line">gpg: Signature made Fri 09 Dec 2022 04:25:43 PM UTC</span><br><span class="line">gpg:                using RSA key EB28C6D42ACFC1798DC7D1CB46D85BAE755DB198</span><br><span class="line">gpg:                issuer &quot;test1@foo.bar&quot;</span><br><span class="line">gpg: checking the trustdb</span><br><span class="line">gpg: marginals needed: 3  completes needed: 1  trust model: pgp</span><br><span class="line">gpg: depth: 0  valid:   4  signed:   0  trust: 0-, 0q, 0n, 0m, 0f, 4u</span><br><span class="line">gpg: Good signature from &quot;test1 (test1&#x27;s PGP key) &lt;test1@foo.bar&gt;&quot; [ultimate]</span><br></pre></td></tr></table></figure><h2 id="信息验证"><a href="#信息验证" class="headerlink" title="信息验证"></a>信息验证</h2><h3 id="分离密钥"><a href="#分离密钥" class="headerlink" title="分离密钥"></a>分离密钥</h3><p>之前生成的加密文件 <code>message.txt.asc</code> 包含了原始文件的信息. 如下的命令使用了 <code>--detach-sign</code> 选项, 则是生成一个分离式 (detached) 的密钥. 这可以用来在无需加密的场合验证身份:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpg --local-user 46D85BAE755DB198 --output message.txt.asc --detach-sign --armor message.txt</span><br></pre></td></tr></table></figure><h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">gpg --verify message.txt.asc message.txt</span></span><br><span class="line">gpg: Signature made Sat 10 Dec 2022 12:46:26 AM CST</span><br><span class="line">gpg:                using RSA key EB28C6D42ACFC1798DC7D1CB46D85BAE755DB198</span><br><span class="line">gpg: Good signature from &quot;test1 (test1&#x27;s PGP key) &lt;test1@foo.bar&gt;&quot; [ultimate]</span><br></pre></td></tr></table></figure><h2 id="脚注"><a href="#脚注" class="headerlink" title="脚注"></a>脚注</h2>]]></content>
    
    
    <summary type="html">&lt;p&gt;本文将主要利用 &lt;a href=&quot;https://en.wikipedia.org/wiki/GNU_Privacy_Guard&quot;&gt;GNU Privacy Guard&lt;/a&gt; (简称 “GnuPG” 或 “GPG”) 完成信息的加密, 解密和验证任务. 本文不会对 GPG 的工作原理以及 OpenPGP 的规范 (参见 &lt;a href=&quot;https://datatracker.ietf.org/doc/html/rfc4880&quot;&gt;RFC 4880&lt;/a&gt;) 做过多的解读. 仅针对完成上述的任务而言, 只需要对其了解大体的情况即可.&lt;/p&gt;</summary>
    
    
    
    <category term="Essay" scheme="https://blog.tamako.work/categories/Essay/"/>
    
    <category term="Tutorial" scheme="https://blog.tamako.work/categories/Essay/Tutorial/"/>
    
    
    <category term="Information Security" scheme="https://blog.tamako.work/tags/Information-Security/"/>
    
    <category term="GPG" scheme="https://blog.tamako.work/tags/GPG/"/>
    
    <category term="OpenPGP" scheme="https://blog.tamako.work/tags/OpenPGP/"/>
    
  </entry>
  
  <entry>
    <title>Kotlin 简要语法快速学习</title>
    <link href="https://blog.tamako.work/techdev/kotlin/quick-learning/"/>
    <id>https://blog.tamako.work/techdev/kotlin/quick-learning/</id>
    <published>2022-12-07T12:03:58.000Z</published>
    <updated>2022-12-07T12:03:58.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>因为一些机缘巧合, 笔者需要研究一下 Android 应用程序的二次开发, 作为目标的软件恰好是使用 Kotlin 编写的, 而笔者尚无该编程语言的基础, 因此需要快速掌握 Kotlin 的一些重要语法.</p><span id="more"></span><p>笔者对 Kotlin 语法糖多早有所耳闻. 考虑到官方文档 (或者说, 笔者本次参考的资料) 未必对所有的语法特性都能面面俱到, 笔者在这篇文章中, 可能只会涉及到部分语法糖.</p><p>需要注意的是, 本文只会聚焦于 Kotlin 的<strong>语法规则</strong>, 并辅以一些具体例子, 并不会在这里谈 Kotlin 是如何<strong>编译</strong>源代码的, Kotlin 是如何应用到 <strong>Android 开发</strong>的, 诸如此类.</p><p>借用 Arch Linux 软件仓库 <a href="https://archlinux.org/packages/community/any/kotlin/">community/kotlin</a> 包的描述: Statically typed programming language that can interoperate with Java. 可以预料的是, Kotlin 和 Java 的语法规则有一定相似之处, 但笔者同样没有 Java 基础, 因此对这两门语言都比较陌生的读者也不用担心笔者跳过二者相似的部分不谈.</p><h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><h3 id="参考教程"><a href="#参考教程" class="headerlink" title="参考教程"></a>参考教程</h3><p>笔者主要参考的教程即为 Kotlin 的<a href="https://kotlinlang.org/docs/home.html">官方文档</a>, 并从 <a href="https://kotlinlang.org/docs/basic-syntax.html">Basic syntax</a> 章节开始.</p><p>同时, Kotlin 为已有变成基础的学习者提供了 <a href="https://kotlinlang.org/docs/learning-materials-overview.html">Learning materials overview</a> 的页面, 其中的第一章节同样是 Basic syntax.</p><h3 id="开发环境"><a href="#开发环境" class="headerlink" title="开发环境"></a>开发环境</h3><p>Kotlin <a href="https://kotlinlang.org/docs/getting-started.html#install-kotlin">官方文档</a>中建议使用 <a href="https://www.jetbrains.com/idea/download/">IntelliJ IDEA</a> 和 <a href="https://developer.android.com/studio">Android Studio</a> 来进行 Kotlin 开发, 但对于语法学习则不必要使用这些 IDE (更何况后者从名字上就像是针对 Android 开发的). 本次学习过程中, 笔者选择在 Arch Linux 中直接安装 community/kotlin 的包 (版本号为 1.7.22) 作为编译环境, <a href="https://archlinux.org/packages/extra/x86_64/jdk17-openjdk/">extra/jdk17-openjdk</a> 包 (版本号为 17.0.5.u1) 作为生成的 JAR 包的运行环境. 读者可以搭配装载 Kotlin 相关<a href="https://marketplace.visualstudio.com/items?itemName=fwcd.kotlin">插件</a>的 <a href="https://code.visualstudio.com/">Visual Studio Code</a> 用以编辑 Kotlin 源代码.</p><h2 id="编译运行"><a href="#编译运行" class="headerlink" title="编译运行"></a>编译运行</h2><p>这里笔者略去 JVM 等细节, 仅说明命令行环境下如何编译单文件 Kotlin 源代码.</p><p>假设需要编译的源代码文件路径为 <code>/path/to/kotlin-learning/helloworld.kt</code>. 保证 Java 运行时环境和 Kotlin 编译器安装的情况下, 执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /path/to/kotlin-learning</span><br><span class="line">kotlinc helloworld.kt -include-runtime -d helloworld.jar</span><br><span class="line">java -jar helloworld.jar</span><br></pre></td></tr></table></figure><h2 id="包的声明与导入"><a href="#包的声明与导入" class="headerlink" title="包的声明与导入"></a>包的声明与导入</h2><p>熟悉 Java 语法的读者应该很习惯诸如</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.myapp;</span><br></pre></td></tr></table></figure><p>的代码. 在 Kotlin 中一般仍然需要编写类似的结构, 这是因为 Kotlin 同样依赖”包” (package) 的结构来组织代码. 显而易见的是点分隔符 <code>.</code> 规定了包之间的层级关系. 暂时可以简单理解为这声明了代码文件的”ID”. 不过需要注意的是, Kotlin 中的包声明不必要与实际的文件系统结构一致, 也就是说, 声明了 <code>com.example.myapp</code> 的代码文件的路径不必要是 <code>com/example/myapp.kt</code>.</p><p>声明包名之后, 就可以通过 <code>import</code> 语句导入其他包, 乃至其他 (诸如顶级函数和属性, 枚举类型常数等):</p><figure class="highlight kotlin"><figcaption><span>package_example.kt</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> ktlearning,package_example</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入包 `OneFile`</span></span><br><span class="line"><span class="keyword">import</span> ktlearning.one_package.OneFile</span><br><span class="line"><span class="comment">// 导入包 `another_package` 下的所有子包</span></span><br><span class="line"><span class="keyword">import</span> ktlearning.another_package.*</span><br><span class="line"><span class="comment">// 避免包名冲突</span></span><br><span class="line"><span class="keyword">import</span> ktlearning.another_another_package.OneFile <span class="keyword">as</span> AnotherFile</span><br><span class="line"><span class="comment">// 导入顶级函数 `TopLevelFunc`</span></span><br><span class="line"><span class="keyword">import</span> ktlearning.another_another_package.AnotherFile.TopLevelFunc</span><br></pre></td></tr></table></figure><h2 id="主函数"><a href="#主函数" class="headerlink" title="主函数"></a>主函数</h2><p>Kotlin 需要主函数作为程序的入口. 主函数通常写作:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line">    <span class="comment">// 函数体</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这类似于 Java 中的</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="comment">// 函数体</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>从 Kotlin 的代码中, 可以看出这个主函数 <code>main(args)</code> 接受一个 <code>String</code> 类型的数组 (<code>Array</code>). 当然在当前版本的 Kotlin 中, 主函数可以省去 <code>args</code> 这一参数. 函数体中未使用该参数反而会触发警告.</p><p>对于这个参数, 一个常见的操作是直接将其转化为字符串并输出:</p><figure class="highlight kotlin"><figcaption><span>example.kt</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">println(args.contentToString())</span><br></pre></td></tr></table></figure><p>例如 <code>java -jar example.jar foo 1024 &quot;bar baz&quot;</code> 的输出将为</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[foo, 1024, bar baz]</span><br></pre></td></tr></table></figure><p>有趣的是, 若将 <code>.contentToString()</code> 删去, Kotlin 依然可以编译, 但最终可能会输出诸如</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Ljava.lang.String;@4f47d241</span><br></pre></td></tr></table></figure><p>的错误结果.</p><h2 id="输出到标准输出-standard-output"><a href="#输出到标准输出-standard-output" class="headerlink" title="输出到标准输出 (standard output)"></a>输出到标准输出 (standard output)</h2><figure class="highlight kotlin"><figcaption><span>helloworld.kt</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> ktlearning.helloworld</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    println(<span class="string">&quot;Hello world!&quot;</span>)</span><br><span class="line">    print(<span class="number">1</span>)</span><br><span class="line">    print(<span class="string">&quot; more &quot;</span>)</span><br><span class="line">    print(<span class="string">&quot;hello world!\n&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Hello world!</span><br><span class="line">1 more hello world!</span><br></pre></td></tr></table></figure><p>Kotlin 支持 <code>print(message)</code> 和 <code>println(message)</code> 两种输出到标准输出的方式. 需要注意的是这两个函数只接受<strong>单一</strong>变量参数.</p><h2 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h2><p>“属性” (property) 这个概念被归类于 Classes and objects 这一章节中. 这个术语可能更常在面向对象编程中提及. 当然, 本文之前涉及到的完整的可编译代码似乎并没有显式地涉及到面向对象 (例如, 没有出现 <code>class</code> 这一关键字), 不过 Kotlin 中依然将诸如其他编程语言中很早提及的 “不可变变量” (immutable variable) 和 “可变变量” (mutable variable) 都视为一种 “属性” - 这表明它们可以具有传统的 “变量” 所缺失的特性.</p><p>Kotlin 中同样有 “编译时常量” (compile-time constant) 的概念. 根据<a href="https://kotlinlang.org/docs/properties.html#compile-time-constants">官方文档</a>相关的表述, 这类属性若在编译时值已知, Kotlin 编译器则可以在编译期间将对其的引用替换为实际的值.</p><p>试图定义传统意义上的 “变量” 和 “常量” 时:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义不可变变量</span></span><br><span class="line"><span class="keyword">val</span> a: <span class="built_in">Int</span> = <span class="number">1</span></span><br><span class="line"><span class="comment">// 定义可变变量</span></span><br><span class="line"><span class="keyword">var</span> b = <span class="string">&quot;foo&quot;</span></span><br><span class="line"><span class="comment">// 定义编译时常量</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">val</span> PI = <span class="number">3.14159</span></span><br></pre></td></tr></table></figure><h3 id="getters-和-setters"><a href="#getters-和-setters" class="headerlink" title="getters 和 setters"></a>getters 和 setters</h3><p>如果可以提前涉及到一些面向对象的内容的话, 既然这些概念都可以被抽象为 “属性”, 那面向对象中 getter 和 setter 的存在就不可被略过了. Kotlin 中对可变属性的完整定义语法如下:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> &lt;propertyName&gt;[: &lt;PropertyType&gt;] [= &lt;property_initializer&gt;]</span><br><span class="line">    [&lt;getter&gt;]</span><br><span class="line">    [&lt;setter&gt;]</span><br></pre></td></tr></table></figure><p>不可变属性的则如下:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> &lt;propertyName&gt;[: &lt;PropertyType&gt;] [= &lt;property_initializer&gt;]</span><br><span class="line">    [&lt;getter&gt;]</span><br><span class="line">    <span class="comment">// 不允许定义 setter</span></span><br></pre></td></tr></table></figure><p>一些简单的定义示例如下:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自动推断为 `Int` 类型, 具有默认的 getter 和 setter</span></span><br><span class="line"><span class="keyword">var</span> initialized = <span class="number">1</span></span><br><span class="line"><span class="comment">// 为 `Int` 类型不可变属性设置自定义 getter</span></span><br><span class="line"><span class="keyword">val</span> area: <span class="built_in">Int</span></span><br><span class="line">    <span class="keyword">get</span>() = <span class="keyword">this</span>.width * <span class="keyword">this</span>.height</span><br><span class="line"><span class="comment">// 同时根据 getter 自动推断</span></span><br><span class="line"><span class="keyword">val</span> area2 <span class="keyword">get</span>() = <span class="keyword">this</span>.width * <span class="keyword">this</span>.height</span><br></pre></td></tr></table></figure><h3 id="backing-fields"><a href="#backing-fields" class="headerlink" title="backing fields"></a>backing fields</h3><p>若涉及到在属性的 setter 中为属性本身赋值时, 为避免出现无限递归的情形, Kotlin 引入了一个 “内部属性” <code>field</code> 用以 “临时” 存储属性值:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> counter = <span class="number">0</span></span><br><span class="line">    <span class="keyword">set</span>(value) &#123;</span><br><span class="line">        <span class="keyword">if</span> (value &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            field = value</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>如果将上述代码块中的 <code>field = value</code> 改为 <code>counter = value</code>, 编译器则会抛出堆栈溢出的错误.</p><h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><p>Kotlin 中任何事物皆是对象. 这里仅讨论一些基本的数据类型.</p><h3 id="整型"><a href="#整型" class="headerlink" title="整型"></a>整型</h3><table><thead><tr><th align="center">类型</th><th align="center">字节数</th></tr></thead><tbody><tr><td align="center"><code>Byte</code></td><td align="center">1</td></tr><tr><td align="center"><code>Short</code></td><td align="center">2</td></tr><tr><td align="center"><code>Int</code></td><td align="center">4</td></tr><tr><td align="center"><code>Long</code></td><td align="center">8</td></tr></tbody></table><p>与一些编程语言相同, 在类型自动推断中, 可以在数字末尾添加 <code>L</code> (例如 <code>1L</code>) 来声明其类型为 <code>Long</code> 而不是默认的 <code>Int</code>.</p><p>参见 <a href="https://kotlinlang.org/docs/numbers.html#integer-types">Integer types</a>.</p><h3 id="浮点型"><a href="#浮点型" class="headerlink" title="浮点型"></a>浮点型</h3><table><thead><tr><th align="center">类型</th><th align="center">字节数</th><th align="center">significant bits</th><th align="center">exponent bits</th><th align="center">decimal digits</th></tr></thead><tbody><tr><td align="center"><code>Float</code></td><td align="center">4</td><td align="center">24</td><td align="center">8</td><td align="center">6-7</td></tr><tr><td align="center"><code>Double</code></td><td align="center">8</td><td align="center">53</td><td align="center">11</td><td align="center">15-16</td></tr></tbody></table><p>同样, 在数字末尾添加 <code>f</code> 或 <code>F</code> (例如 <code>3.14f</code>) 来声明其类型为 <code>Float</code> 而不是默认的 <code>Double</code>.</p><p>需要注意的是, 浮点型和整型之间不会<strong>自动转换</strong>. 例如如下的代码会抛出编译错误:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">sum</span><span class="params">(a: <span class="type">Double</span>, b: <span class="type">Double</span>)</span></span> = a + b</span><br><span class="line"><span class="comment">// `1` 不是 `Double` 类型</span></span><br><span class="line">sum(<span class="number">1</span>, <span class="number">2.0</span>)</span><br></pre></td></tr></table></figure><p>参见 <a href="https://kotlinlang.org/docs/numbers.html#floating-point-types">Floating-point types</a>.</p><h3 id="无符号整型"><a href="#无符号整型" class="headerlink" title="无符号整型"></a>无符号整型</h3><p>只需要在原有的数据类型前添加 <code>U</code> (例如 <code>UByte</code>) 即可.</p><p>同样, 在数字末尾添加 <code>u</code> (例如 <code>1u</code>) 来声明其类型为无符号类型. 类似的, <code>ul</code> 或 <code>UL</code> 声明其类型为 <code>ULong</code>.</p><h3 id="特殊的数字表示"><a href="#特殊的数字表示" class="headerlink" title="特殊的数字表示"></a>特殊的数字表示</h3><p>除了上文提及的 <code>f</code> / <code>F</code> 和 <code>L</code>, Kotlin 还支持其他特别的数字表示方法:</p><table><thead><tr><th align="center">特殊表示</th><th align="center">示例</th></tr></thead><tbody><tr><td align="center">二进制整型</td><td align="center"><code>0b00001111</code></td></tr><tr><td align="center">八进制整型</td><td align="center"><strong>不支持</strong></td></tr><tr><td align="center">十六进制整型</td><td align="center"><code>0x0F</code></td></tr><tr><td align="center">科学计数法</td><td align="center"><code>1.0e24</code></td></tr></tbody></table><p>同时, Kotlin 支持在数字之间增加下划线 (<code>_</code>) 来增加可读性:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> oneMillion = <span class="number">1_000_000</span></span><br><span class="line"><span class="keyword">val</span> creditCardNumber = <span class="number">1234_5678_9012_3456L</span></span><br><span class="line"><span class="keyword">val</span> socialSecurityNumber = <span class="number">999_99_9999L</span></span><br><span class="line"><span class="keyword">val</span> hexBytes = <span class="number">0xFF_EC_DE_5E</span></span><br><span class="line"><span class="keyword">val</span> bytes = <span class="number">0b11010010_01101001_10010100_10010010</span></span><br></pre></td></tr></table></figure><h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><p>上文中已经出现了主函数的定义和使用方法. 对于一个通常的函数, 例如实现两个整数的加法:</p><figure class="highlight kotlin"><figcaption><span>func_sum.kt</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> ktlearning.func_sum</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通常的函数定义</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">sum1</span><span class="params">(a: <span class="type">Int</span>, b: <span class="type">Int</span>)</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 直接定义其返回值的函数定义, 同时实现了类型推断</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">sum2</span><span class="params">(a: <span class="type">Int</span>, b: <span class="type">Int</span>)</span></span> = a + b</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义无返回值的函数 (`Unit` 可以省略)</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">printSum</span><span class="params">(a: <span class="type">Int</span>, b: <span class="type">Int</span>)</span></span>: <span class="built_in">Unit</span> &#123;</span><br><span class="line">    println(<span class="string">&quot;Sum of <span class="variable">$a</span> and <span class="variable">$b</span> is <span class="subst">$&#123;a + b&#125;</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> a = <span class="number">2</span></span><br><span class="line">    <span class="keyword">var</span> b = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">    println(<span class="string">&quot;Sum of <span class="variable">$a</span> and <span class="variable">$b</span> is <span class="subst">$&#123;sum1(a, b)&#125;</span>&quot;</span>)</span><br><span class="line">    println(<span class="string">&quot;Sum of <span class="variable">$a</span> and <span class="variable">$b</span> is <span class="subst">$&#123;sum2(a, b)&#125;</span>&quot;</span>)</span><br><span class="line">    printSum(a, b)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="面向对象"><a href="#面向对象" class="headerlink" title="面向对象"></a>面向对象</h2><p>直接用例子说明:</p><figure class="highlight kotlin"><figcaption><span>oop_shape.kt</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> ktlearning.oop_shape</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可继承的类前加 `open`</span></span><br><span class="line"><span class="keyword">open</span> <span class="keyword">class</span> <span class="title class_">Shape</span>(name: String) &#123;</span><br><span class="line">    <span class="comment">// the primary constructor</span></span><br><span class="line">    <span class="keyword">var</span> name = name</span><br><span class="line"></span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">say</span><span class="params">()</span></span> &#123;</span><br><span class="line">        println(<span class="string">&quot;My name is <span class="subst">$&#123;this.name&#125;</span>!&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">val</span> area: <span class="built_in">Double</span> = <span class="number">0.0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span>(name: String, width: <span class="built_in">Double</span>, height: <span class="built_in">Double</span>) : Shape(name) &#123;</span><br><span class="line">    <span class="keyword">var</span> width = width</span><br><span class="line">    <span class="keyword">var</span> height = height</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重载父类的属性</span></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">val</span> area: <span class="built_in">Double</span></span><br><span class="line">        <span class="keyword">get</span>() = <span class="keyword">this</span>.width * <span class="keyword">this</span>.height</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span>(name: String, radius: <span class="built_in">Double</span>) : Shape(name) &#123;</span><br><span class="line">    <span class="keyword">val</span> PI = <span class="number">3.1415926</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> radius = radius</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">val</span> area: <span class="built_in">Double</span></span><br><span class="line">        <span class="keyword">get</span>() = PI * <span class="keyword">this</span>.radius * <span class="keyword">this</span>.radius</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> rect = Rectangle(<span class="string">&quot;My Rectangle&quot;</span>, <span class="number">2.0</span>, <span class="number">3.5</span>)</span><br><span class="line">    <span class="keyword">val</span> circ = Circle(<span class="string">&quot;My Circle&quot;</span>, <span class="number">2.0</span>)</span><br><span class="line"></span><br><span class="line">    rect.say()</span><br><span class="line">    circ.say()</span><br><span class="line"></span><br><span class="line">    println(<span class="string">&quot;The area of <span class="subst">$&#123;rect.name&#125;</span> is <span class="subst">$&#123;rect.area&#125;</span>&quot;</span>)</span><br><span class="line">    println(<span class="string">&quot;The area of <span class="subst">$&#123;circ.name&#125;</span> is <span class="subst">$&#123;circ.area&#125;</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出为:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">My name is My Rectangle!</span><br><span class="line">My name is My Circle!</span><br><span class="line">The area of My Rectangle is 7.0</span><br><span class="line">The area of My Circle is 12.5663704</span><br></pre></td></tr></table></figure><p>参见 <a href="https://kotlinlang.org/docs/basic-syntax.html#creating-classes-and-instances">Creating classes and instances</a>.</p><h2 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 行注释</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    块注释</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    下面是内层块注释.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    <span class="comment">/* 内层块注释 */</span></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    上面是内层块注释</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h2 id="条件结构"><a href="#条件结构" class="headerlink" title="条件结构"></a>条件结构</h2><h3 id="if-语句块"><a href="#if-语句块" class="headerlink" title="if 语句块"></a><code>if</code> 语句块</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (a &gt; b)</span><br><span class="line">    println(a)</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    println(b)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="条件表达式"><a href="#条件表达式" class="headerlink" title="条件表达式"></a>条件表达式</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">max</span><span class="params">(a: <span class="type">Int</span>, b: <span class="type">Int</span>)</span></span> = <span class="keyword">if</span> (a &gt; b) a <span class="keyword">else</span> b</span><br></pre></td></tr></table></figure><p>相对的, C 中为</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">max</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (a &gt; b) ? a : b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Python 中为</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">max</span>(<span class="params">a: <span class="built_in">int</span>, b: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="keyword">return</span> a <span class="keyword">if</span> a &gt; b <span class="keyword">else</span> b</span><br></pre></td></tr></table></figure><p><del>(个人认为 Python 的条件表达式的结构经常写错, 因为条件被插入在两个分支表达式之间.)</del></p><h3 id="when"><a href="#when" class="headerlink" title="when"></a><code>when</code></h3><p>Kotlin 中的 <code>when</code> 类似于 C 中的 <code>switch</code>, 但其用法更加灵活:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">when</span> (x) &#123;</span><br><span class="line">    <span class="comment">// 左侧可以是一个表达式, 用以匹配</span></span><br><span class="line">    <span class="number">1</span> -&gt; println(<span class="string">&quot;x == 1&quot;</span>)</span><br><span class="line">    <span class="number">2</span> -&gt; println(<span class="string">&quot;x == 2&quot;</span>)</span><br><span class="line">    <span class="comment">// 不匹配上述所有表达式</span></span><br><span class="line">    <span class="keyword">else</span> -&gt; &#123;</span><br><span class="line">        println(<span class="string">&quot;x is neither 1 nor 2&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// `when` 也可以作为表达式</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">describe</span><span class="params">(obj: <span class="type">Any</span>)</span></span>: String =</span><br><span class="line">    <span class="keyword">when</span> (obj) &#123;</span><br><span class="line">        <span class="number">1</span>          -&gt; <span class="string">&quot;One&quot;</span></span><br><span class="line">        <span class="string">&quot;Hello&quot;</span>    -&gt; <span class="string">&quot;Greeting&quot;</span></span><br><span class="line">        <span class="comment">// 可以包含条件表达式</span></span><br><span class="line">        <span class="keyword">is</span> <span class="built_in">Long</span>    -&gt; <span class="string">&quot;Long&quot;</span></span><br><span class="line">        !<span class="keyword">is</span> String -&gt; <span class="string">&quot;Not a string&quot;</span></span><br><span class="line">        <span class="keyword">else</span>       -&gt; <span class="string">&quot;Unknown&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">isPositive</span><span class="params">(x: <span class="type">Int</span>)</span></span> = <span class="keyword">when</span> (x) &#123;</span><br><span class="line">    <span class="comment">// 当覆盖所有可能性时, 无需 `else` 分支</span></span><br><span class="line">    x &gt; <span class="number">0</span> -&gt; <span class="literal">true</span></span><br><span class="line">    x &lt;= <span class="number">0</span> -&gt; <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="循环结构"><a href="#循环结构" class="headerlink" title="循环结构"></a>循环结构</h2><h3 id="for-循环"><a href="#for-循环" class="headerlink" title="for 循环"></a><code>for</code> 循环</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1.</span><span class="number">.3</span>) &#123;</span><br><span class="line">    println(i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">6</span> downTo <span class="number">0</span> step <span class="number">2</span>) &#123;</span><br><span class="line">    println(i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (elem <span class="keyword">in</span> array) &#123;</span><br><span class="line">    println(elem)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> array.indices) &#123;</span><br><span class="line">    println(array[i])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ((i, elem) <span class="keyword">in</span> array.withIndex()) &#123;</span><br><span class="line">    println(<span class="string">&quot;array[<span class="variable">$i</span>] = <span class="variable">$elem</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="while-循环"><a href="#while-循环" class="headerlink" title="while 循环"></a><code>while</code> 循环</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (x &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    x--</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">val</span> y = retrieveData()</span><br><span class="line">&#125; <span class="keyword">while</span> (y != <span class="literal">null</span>)</span><br></pre></td></tr></table></figure><h2 id="可空值-nullable-values-和空值检查-null-checks"><a href="#可空值-nullable-values-和空值检查-null-checks" class="headerlink" title="可空值 (nullable values) 和空值检查 (null checks)"></a>可空值 (nullable values) 和空值检查 (null checks)</h2><p>可空类型需要在类型后添加 <code>?</code> 标识. <code>null</code> 则表示空值.</p><figure class="highlight kotlin"><figcaption><span>null_check.kt</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 若字符串不能表示一个整型, 则转化为 `null`</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">parseInt</span><span class="params">(str: <span class="type">String</span>)</span></span>: <span class="built_in">Int</span>? &#123;</span><br><span class="line">    <span class="keyword">return</span> str.toIntOrNull()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">printProduct</span><span class="params">(arg1: <span class="type">String</span>, arg2: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> x = parseInt(arg1)</span><br><span class="line">    <span class="keyword">val</span> y = parseInt(arg2)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 不能直接使用 `x * y`, 因为 `x` 和 `y` 可能为 `null`</span></span><br><span class="line">    <span class="keyword">if</span> (x != <span class="literal">null</span> &amp;&amp; y != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 空值检查后, 其类型自动转化为非空的整型</span></span><br><span class="line">        println(x * y)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        println(<span class="string">&quot;&#x27;<span class="variable">$arg1</span>&#x27; or &#x27;<span class="variable">$arg2</span>&#x27; is not a number&quot;</span>)</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    printProduct(<span class="string">&quot;6&quot;</span>, <span class="string">&quot;7&quot;</span>)</span><br><span class="line">    printProduct(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;7&quot;</span>)</span><br><span class="line">    printProduct(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出为:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">42</span><br><span class="line">&#x27;a&#x27; or &#x27;7&#x27; is not a number</span><br><span class="line">&#x27;a&#x27; or &#x27;b&#x27; is not a number</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;因为一些机缘巧合, 笔者需要研究一下 Android 应用程序的二次开发, 作为目标的软件恰好是使用 Kotlin 编写的, 而笔者尚无该编程语言的基础, 因此需要快速掌握 Kotlin 的一些重要语法.&lt;/p&gt;</summary>
    
    
    
    <category term="Essay" scheme="https://blog.tamako.work/categories/Essay/"/>
    
    <category term="Tutorial" scheme="https://blog.tamako.work/categories/Essay/Tutorial/"/>
    
    
    <category term="Kotlin" scheme="https://blog.tamako.work/tags/Kotlin/"/>
    
  </entry>
  
  <entry>
    <title>个人近况 (-2022.11)</title>
    <link href="https://blog.tamako.work/myself/recent/-2022-nov/"/>
    <id>https://blog.tamako.work/myself/recent/-2022-nov/</id>
    <published>2022-11-29T15:10:40.000Z</published>
    <updated>2022-11-29T15:10:40.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>现在是 2022 年 11 月 29 日夜间 23 时 10 分 40 秒，<a href="#%E5%A5%B3%E8%A3%85%E5%92%8C%E8%B7%A8%E6%80%A7%E5%88%AB">身着米黄色睡裙</a>。</p><p>挣扎了许久，我还是考虑写一下至今（2022 年 11 月底）的一些个人近况。时间跨度未知，纯粹看我的记忆最远能触及到何处。某种程度上，也是在一个公开的平台上对自己最近的一些行为的总结。<strong>可能会有对未来的展望。这个看我的时间安排如何。</strong></p><p>当然，这篇文字得以诞生，某种程度上也受到<strong>某个网站</strong>的激励（因为我暂时无法决定是否需要公开，故暂时隐去具体的地址）。同时，可能读者——也就是<em>你</em>——会发现这篇文章的风格和之前迥然不同。关于这篇文字创作的契机、那个“某个网站”以及本文展现出此种样貌的原因，将会在<a href="#%E5%85%B3%E4%BA%8E%E6%9C%AC%E6%96%87">后文</a>中提及。</p><p>全文可能较长，尤其是面面俱到地说的情况下。我尽可能把握好详略。</p><span id="more"></span><h2 id="学习"><a href="#学习" class="headerlink" title="学习"></a>学习</h2><p>学生自然是要学习的。当然进了高校之后，学什么就不是别人（甚至是自己能控制的了）。</p><h3 id="常规课业"><a href="#常规课业" class="headerlink" title="常规课业"></a>常规课业</h3><p>这里说的“常规课业”，主要指的是我所在学校为我所在专业制定的培养方案中所规定的学科。除了数学等基础课、专业课之外，还包括文社科之类。</p><p>嗯……说实话，真的不太妙。</p><p>计入绩点并参与专业排名的文社科只有《马克思主义基本原理》一个。文社科我反而没那么担心。虽然比不过一些 95 分上下的卷王，但考试前多翻翻书，（如果可以的话）熟悉一下历年的卷子，想拿个 70 多分倒也没那么难。<del>（至于年轻的女老师很可爱让我没法大摆特摆这件事还是不提了。）</del></p><p>所以，现在最岌岌可危、极其容易喜提挂科的科目，反而是专业基础课——《模拟电子技术基础》。当然这门课本身也就不算容易学。不过最重要的是，我对于我现在身处的专业实在没什么兴趣。虽说计算机科学领域在本科阶段非科班也有机会超越科班水平，某种程度上我也可以在这一方面和科班的比一比。但不管怎么说，非科班的压力就在于，我必须要面对许多门我本身可能不必要学习的课程。如果同时有一些保研、出国的计划，这些课程也需要获得一定的分数，而不能仅限于勉强通过。所以，我还必须要花费一定的精力以维持自己的分数——每当这个时候，我不免想感慨自己的高考志愿是否合适。当然，<strong>这又有什么用呢</strong>？一般想到这一步就会乖乖继续去学习去了。</p><p>然而，正如我上面所说，这门课已经不是单纯的<strong>低分</strong>了，而是到了<strong>难以及格</strong>的地步。问有没有认真学，那我肯定只能遗憾地表示否定。所以，这说到底还是一种咎由自取。</p><p>剩下两门数学，一个是概率论，一个是复变函数。数学科目我还是有较大的把握的，至于最后考试分数如何，这就不是我能控制的了。“考试状态”，从小学开始提及，一直贯穿到人生的最后一门考试。这个概念有时太过抽象，反而让人（尤其是我）难以探明其究竟，以至于大学以来的考试跟抽奖差不多，抽到啥结果就是啥。</p><p>马上临近期末，考试月也来临了。希望最好能有个稍微好看点的结果吧。</p><h3 id="计算机科学"><a href="#计算机科学" class="headerlink" title="计算机科学"></a>计算机科学</h3><p>嗯，那我不学专业要求的科目，去学什么了呢？</p><p>虽然我特别想去研究计算机科学这一块，但说实话我还真的没怎么学。现在回过头来看，大概其中一个原因是，因为当下常规课业的压力加大，以及个人各种事务的增多以及心态的转变之类，我一度无暇顾及对其的探究。另一个原因是，我进错“赛道”了。我中途跑去研究机器学习的一些具体项目，甚至还试图加入了一个研究组（虽然目前还没有什么具体的进度，毕竟能力尚不足）。实际上利用机器学习的各种模型和算法之类来完成一些高位的具体需求，和偏数学、偏底层的计算机科学甚至可以说是两个世界的研究方向了。我承认像操作系统、编译器那些知识对我来说还有些难度。不过，所幸之前受本部一位学长的指点，加上个人的一些思考，我认为我应该还是更喜欢后者。所以我现在正在抽一点时间从著名的 <a href="https://csdiy.wiki/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/CSAPP/">CMU CS15213: CSAPP</a> 开始看起。之后可能是直接跳到 <a href="https://csdiy.wiki/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/MIT6.S081/">MIT 6.S081: Operating System Engineering</a>。</p><h3 id="机器学习"><a href="#机器学习" class="headerlink" title="机器学习"></a>机器学习</h3><p>如同上面一节所说，跟了一个研究组。现在某种程度上还处在“选题”的阶段，所以也没什么好说的。</p><p><del>（我现在还在拿笔记本电脑的 CPU 跑项目……）</del></p><h2 id="女装和跨性别"><a href="#女装和跨性别" class="headerlink" title="女装和跨性别"></a>女装和跨性别</h2><p>本来这一块的内容应该单独在一个系列的文章中说的，不过考虑到这也属于“近况”的一部分，以及我现在实在是分身乏术，无力再撰写一个完整的系列，故会在这里提及一下。</p><p>我最早的女装尝试已不可考。大规模的女装尝试则是于去年（2021 年）十一国庆假期期间开始——具体来说，开始于高中同学寄来第一套女仆装的那一天。经过一番努力和多种尝试，我现在现存的各类女装大约有 20 套左右，而 <a href="#%E6%80%A7%E5%88%AB%E8%AE%A4%E5%90%8C">RLE</a>（Real-life experience）的程度则从最开始的躲在教学楼厕所到如今自然地穿着裙子在宿舍和楼梯道内活动。</p><p>从女装购买的类型偏好来看，现在主要偏向于日常类的裙子一类。个人认为这是一种观念上的好的转变。不过考虑到现在头晕头痛，还是按下不表为好（什么鬼）。</p><h3 id="性别认同"><a href="#性别认同" class="headerlink" title="性别认同"></a>性别认同</h3><p>有记录的首次知晓“药娘”这一概念的日期是 2022 年 3 月 15 日，有记录的首次查询“<a href="https://mtf.wiki/zh-cn/docs/">跨性别</a>”<a href="https://en.m.wikipedia.org/wiki/Transgender">维基百科</a>词条则是在同年 7 月上旬。</p><p>必须要承认的是，我的过去并没有与我认识的跨性别女性幼年期所拥有的<a href="https://genderdysphoria.fyi/zh/">性别烦躁</a>类似的经历——当几年前甚至十几年前的她们苦恼于与出生性别的固有形象不符而遭受的歧视时，我似乎按部就班地遵从父母和老师的教导顺利度过了初等和中等教育阶段。所以早先有的时候我会不自觉地思考：我现在<em>认定</em>的性别认同（女性）与<em>应当</em>（即排除了种种心理上的“错觉”之后的判断）的性别认同（即与出生性别相同的男性）是否存在不可调和的矛盾？——写这句话的时候，我是感觉很不和谐的，因为这仿佛都不在说人话。我当下认同自己的性别应该是女性，那从何处冒出来一个“应当”的性别认同？所幸，现在我已经几乎不再思考这一问题了。随着今年剩余的天数一点点减少，我对另一方向的性别的认同感有增无减。至少，上述的两种截然相反的性心理所产生的矛盾应该是化解了。</p><p>考虑性别转变的过程中，我的一些行为习惯和<a href="#ta"><em>某些</em></a>心理状态也悄然发生了转变。在外貌上有一些比较明显的尝试，例如：开始蓄长发（以前的头发真的太短了，也压根整不出什么发型来，当然这也是父母在我没什么特殊偏好下给出的 fallback）、开始用梳子（超级短的头发自然也用不上什么梳子了）、向别的跨性别女性咨询洗浴用品的款式、购买护肤品之类。至于其他的变化，如果有时间的话，就在新的系列专栏中再见吧。</p><h2 id="Ta"><a href="#Ta" class="headerlink" title="Ta"></a>Ta</h2><p>Ta，代指某一个人。</p><p>我和 Ta 在一个网站上第一次相遇。</p><p>Ta 带给了我很多，未曾有过的体验。</p><p>因为 Ta，我开始做出一些改变。</p><p>我不会在这里写 Ta。</p><p>但是我希望 Ta 能看到。</p><h2 id="心理状态"><a href="#心理状态" class="headerlink" title="心理状态"></a>心理状态</h2><p>我的心理状态，现在，很不好。<strong>很不好</strong>。</p><p>当然，我认为“很不好”，也不一定是真的“很不好”——在我父母看来，大概如此。我知道处于抑郁状态不代表患抑郁症，处于焦虑状态不代表患焦虑症，云云，类似于随机事件 $A$ 满足 $P(A)=1$ 不代表它是整个样本空间一样。但是，我自认为，我现在的心理状态肯定没有以前——甚至是一个月前——要好。</p><p>曾经的我被父母和老师认定是心态很好的人，而如今却发生了翻天覆地的转变。其转变的原因，我至今未能探明。现在的结果是，我比以往更容易陷入负面的情绪当中。之前还因为这些事情“被”辅导员谈过——当然是以心理疏导的名义，辅导员并没有对我施压之类。最近学校要求全校同学集体填写的心理测评量表中，一些测评项我给出了较为负面的回答，而那时我的心理状态其实还没到那么糟糕的程度。事实上我在当天晚上遇到一些事情，陷入“emo”的漩涡后，我立刻有了修改量表结果的冲动——不过我毕竟本性还是懒人，实在不想重新填写那几十道题目，就让它过去吧。</p><p>我的心路历程是可以作为近一个月来解释我的诸多行为、贯穿始终的一条主线的。同样的，因为时间和精力的原因，我无法在这里展开详谈。如果这个系列（“个人近况”以及其他相关的文章）不会终止于本篇文字的话，我大概可以以这个话题继续在这个系列中创作。</p><h2 id="关于本文"><a href="#关于本文" class="headerlink" title="关于本文"></a>关于本文</h2><p>前面写了这么多，现在才开始写本文的“关于页”（About page），确实有些奇怪。不过因为我到了晚上就容易神智不清，请各位多多谅解。</p><p>这个博客原本是主要注重技术的。受到早期个人固有性格的影响，我甚至连早期技术类博文的文风都尽可能控制成 Wiki 风格。不过，可能是因为考虑跨性别之类的缘故，或是诸位脑补出的一些契机，从而使我意识到了自己更多元的样子，现在我想要走出“冰冷机械”（可能有人会反驳，不过我现在没什么力气去争论）的技术的世界，去尝试用自己的双手描述自己，以一种更加自然的风格。原来还需要写的，是真正的——也就是本站的“<a href="/about">关于页</a>”。不过我觉得这一页需要更加审慎地去写，因此就暂时延后，而将本文提到最重要的日程上。</p><p>我有的时候自嘲自己是没什么能力、不可靠的工具人，对人际关系什么的几乎都不在意，只会摆弄自己手头的 tech works。不过呢，我认为，我现在的心态应该是变了。我愿意去拥抱跟原先不一样的生活，不论怎么说，这都是一种巨大的、可喜可贺的进步。</p><h2 id="展望"><a href="#展望" class="headerlink" title="展望"></a>展望</h2><p>从上面的只言片语中可以看出，狭义上对于本站未来的计划，我自然是会分出一部分写博客的时间来写写更偏向人文社科方面的内容，不仅仅是个人近况，包括文学作品、影视作品之类评价类的文字也可能会考虑收纳其中。而对于我在生活上后续的安排——其实也没什么特别的，走一步算一步。当然，就我目前的性别认同的状态，以及心理上的种种思绪，我可能会安排精神科或心理科的咨询。其他的，到时候再说吧。</p><p>对于本站技术上的改变，我可能会考虑修复<a href="https://github.com/LittleYe233/hexo-theme-amazingremake">本主题</a>的 bugs，以及对本博客增添一些功能性页面（关于页，之类）和评论区功能。</p><p>那么，让我们在下一篇博文中再见吧。</p><p><strong>敬请期待。</strong></p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;现在是 2022 年 11 月 29 日夜间 23 时 10 分 40 秒，&lt;a href=&quot;#%E5%A5%B3%E8%A3%85%E5%92%8C%E8%B7%A8%E6%80%A7%E5%88%AB&quot;&gt;身着米黄色睡裙&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;挣扎了许久，我还是考虑写一下至今（2022 年 11 月底）的一些个人近况。时间跨度未知，纯粹看我的记忆最远能触及到何处。某种程度上，也是在一个公开的平台上对自己最近的一些行为的总结。&lt;strong&gt;可能会有对未来的展望。这个看我的时间安排如何。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;当然，这篇文字得以诞生，某种程度上也受到&lt;strong&gt;某个网站&lt;/strong&gt;的激励（因为我暂时无法决定是否需要公开，故暂时隐去具体的地址）。同时，可能读者——也就是&lt;em&gt;你&lt;/em&gt;——会发现这篇文章的风格和之前迥然不同。关于这篇文字创作的契机、那个“某个网站”以及本文展现出此种样貌的原因，将会在&lt;a href=&quot;#%E5%85%B3%E4%BA%8E%E6%9C%AC%E6%96%87&quot;&gt;后文&lt;/a&gt;中提及。&lt;/p&gt;
&lt;p&gt;全文可能较长，尤其是面面俱到地说的情况下。我尽可能把握好详略。&lt;/p&gt;</summary>
    
    
    
    <category term="Essay" scheme="https://blog.tamako.work/categories/Essay/"/>
    
    <category term="Report" scheme="https://blog.tamako.work/categories/Essay/Report/"/>
    
    
    <category term="Self Analysis" scheme="https://blog.tamako.work/tags/Self-Analysis/"/>
    
    <category term="Cross-dressing" scheme="https://blog.tamako.work/tags/Cross-dressing/"/>
    
    <category term="Transgender" scheme="https://blog.tamako.work/tags/Transgender/"/>
    
    <category term="Recent Activities" scheme="https://blog.tamako.work/tags/Recent-Activities/"/>
    
  </entry>
  
  <entry>
    <title>【Arch Linux】使用 Wine 运行 Galgame</title>
    <link href="https://blog.tamako.work/techdev/arch/wine-galgame/"/>
    <id>https://blog.tamako.work/techdev/arch/wine-galgame/</id>
    <published>2022-08-24T16:03:09.000Z</published>
    <updated>2022-08-24T16:03:09.000Z</updated>
    
    <content type="html"><![CDATA[<p>本文主要介绍在 Arch Linux 上通过 Wine 运行 Galgame 的主要步骤. 理论上对其他 Linux 发行版也可作类似操作.</p><p>需要注意的是, 以下教程<strong>很可能</strong>只对日文原版的 Galgame 有效. 考虑到中国大陆大量汉化 Galgame 存在”壳”, 标准的 Wine 配置可能无法应对, 需要据情况自行分析.</p><span id="more"></span><h2 id="Wine"><a href="#Wine" class="headerlink" title="Wine"></a>Wine</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>对 Wine 的简要介绍可参见<a href="https://en.wikipedia.org/wiki/Wine_(software)">维基百科</a>和 <a href="https://wiki.archlinux.org/title/wine">Arch Linux Wiki 同名词条</a>, 并非本文重点, 故不作赘述.</p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>Wine 的开发和 Staging (包含一些修复和补丁等) 分支位于官方包仓库的 <a href="https://wiki.archlinux.org/title/Official_repositories#multilib">Multilib</a> 仓库, Stable 分支位于 AUR. 以 Staging 分支为例:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S wine-staging</span><br></pre></td></tr></table></figure><p>同时可能需要安装 32 位的图形和音频驱动, 分别参见 Arch Linux Wiki 的 <a href="https://wiki.archlinux.org/title/wine#Graphics_drivers">Wine#Graphics drivers</a> 和 <a href="https://wiki.archlinux.org/title/wine#Sound">Wine#Sound</a> 章节.</p><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>使用 <code>winecfg</code> 进行 Wine 相关的配置. 一般情况下不需要做改动.</p><p>对于启动系统 UI 缩放的设备, 可以在 Graphics 选项卡下的 Screen resolution 设置项下等比例设置 DPI, 例如默认值为 96 时, 150% 缩放等级对应的 DPI 为 144.</p><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wine notepad</span><br></pre></td></tr></table></figure><h2 id="字体和-locale"><a href="#字体和-locale" class="headerlink" title="字体和 locale"></a>字体和 locale</h2><p>对于 Wine 来说如上的设置已经可以启动很多应用程序了, 但对于日本生产的 Galgame 来说, 默认简体中文或英文的系统环境极有可能造成”乱码”. 因此我们还需要作一些额外的设置.</p><h3 id="日文字体"><a href="#日文字体" class="headerlink" title="日文字体"></a>日文字体</h3><p>一些教程<a href="http://brokendragontranslation.com/shift_jis_linux.html">^1</a>给出的解决方案是从系统语言为日本语的 Windows 系统中复制 <code>C:\Windows\Fonts</code> 文件夹中的字体, 不过 AUR 已经有人整理过日本语字体包:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yay -S ttf-ms-win11-auto-japanese</span><br></pre></td></tr></table></figure><p>若出现字体安装失败的情况, 请参照<a href="/techdev/arch/localization-simplified-chinese/#ttf-ms-win11-auto-%E7%9B%B8%E5%85%B3%E5%8C%85%E6%97%A0%E6%95%88">此章节</a>.</p><h3 id="Shift-JIS-locale"><a href="#Shift-JIS-locale" class="headerlink" title="Shift-JIS locale"></a>Shift-JIS locale</h3><p>许多 Galgame 的开发 locale 使用的都是 Shift-JIS, 但其并不在大部分现代 Linux 发行版中内置. 需要另外安装.</p><p>参考<a href="http://brokendragontranslation.com/shift_jis_linux.html">此教程</a>, 下载作者提供的 <a href="https://mega.nz/#!KB413K5Y!anzW3tV-XYMinQZtWaMOlDaBE1cibls15DpAQH4tiHc">mega.nz</a> 或 <a href="https://drive.google.com/open?id=1X3pPqiks5-5Z2iMkDuPOVnAOAi_68rKW">Google Drive</a> 内的文件并按照要求解压后:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo localedef  -i ja_JP  -f SHIFT_JIS ja_JP.sjis --no-warnings=ascii</span><br><span class="line">sudo sed -i <span class="string">&#x27;/ja_JP.UTF-8 UTF-8/a ja_JP.SJIS SHIFT_JIS  &#x27;</span> /etc/locale.gen</span><br><span class="line"><span class="comment"># sudo locale-gen # 可能会失败, 但此时 locale 应已配置成功. 此时需要将上一行命令中新生成的一行数据删除或注释.</span></span><br></pre></td></tr></table></figure><p>此时再在终端中切换目录到 Galgame 目录下, 执行:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LC_ALL=ja_JP.sjis wine &lt;游戏可执行文件&gt;.exe</span><br></pre></td></tr></table></figure><p>同时可以尝试 ja_JP.utf8. 在 <code>/etc/locale.gen</code> 中找到 <code>#ja_JP.UTF-8 UTF-8</code> 一行, 删除前面的注释符后执行 <code>sudo locale-gen</code>, 再:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LC_ALL=ja_JP.utf8 wine &lt;游戏可执行文件&gt;.exe</span><br></pre></td></tr></table></figure><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2>]]></content>
    
    
    <summary type="html">&lt;p&gt;本文主要介绍在 Arch Linux 上通过 Wine 运行 Galgame 的主要步骤. 理论上对其他 Linux 发行版也可作类似操作.&lt;/p&gt;
&lt;p&gt;需要注意的是, 以下教程&lt;strong&gt;很可能&lt;/strong&gt;只对日文原版的 Galgame 有效. 考虑到中国大陆大量汉化 Galgame 存在”壳”, 标准的 Wine 配置可能无法应对, 需要据情况自行分析.&lt;/p&gt;</summary>
    
    
    
    <category term="Essay" scheme="https://blog.tamako.work/categories/Essay/"/>
    
    <category term="Tutorial" scheme="https://blog.tamako.work/categories/Essay/Tutorial/"/>
    
    
    <category term="Arch Linux" scheme="https://blog.tamako.work/tags/Arch-Linux/"/>
    
    <category term="Wine" scheme="https://blog.tamako.work/tags/Wine/"/>
    
    <category term="Galgame" scheme="https://blog.tamako.work/tags/Galgame/"/>
    
  </entry>
  
  <entry>
    <title>【Arch Linux】编译安装 AUR 上的 Linux 内核</title>
    <link href="https://blog.tamako.work/techdev/arch/kernel-compilation/"/>
    <id>https://blog.tamako.work/techdev/arch/kernel-compilation/</id>
    <published>2022-08-15T11:00:49.000Z</published>
    <updated>2022-08-15T11:00:49.000Z</updated>
    
    <content type="html"><![CDATA[<p>Arch Linux 可以使用多种 Linux 内核. 默认的内核由官方 <code>core</code> 仓库的 <code>linux</code> 包提供, 一般另附有 <code>linux-headers</code> 包. 官方仓库中提供的预编译内核还有同为 <code>core</code> 仓库的 <code>linux-lts</code> 和 <code>extra</code> 仓库的 <code>linux-zen</code>. 不过, 在一些场合下, 例如需要更新的或是有 patch 的内核时, 我们可能需要从 AUR 中获取需要的内核并手动编译安装. 本文以 <code>linux-mainline</code> 包为例, 主要借助 <code>yay</code> 更便捷地处理相关操作.</p><span id="more"></span><p>通常情况下, 只需要 <code>yay -S linux-mainline</code> 即可. 以下需要对编译安装过程做一些可选操作.</p><h2 id="获取-PKGBUILD"><a href="#获取-PKGBUILD" class="headerlink" title="获取 PKGBUILD"></a>获取 <code>PKGBUILD</code></h2><p>使用 <code>yay</code> 的 <code>-G</code> 选项仅获得 <code>PKGBUILD</code> 等相关的文件. 添加 <code>--force</code> 以强制保持与上游 AUR 包内容一致. 由于该操作默认目标文件夹为当前文件夹, 所以可以切换到 <code>~/.cache/yay</code> 后再获取.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p ~/.cache/yay &amp;&amp; <span class="built_in">cd</span> ~/.cache/yay</span><br><span class="line">yay -G --force linux-mainline</span><br></pre></td></tr></table></figure><h2 id="可选-修改上游仓库-URL"><a href="#可选-修改上游仓库-URL" class="headerlink" title="(可选) 修改上游仓库 URL"></a>(可选) 修改上游仓库 URL</h2><p>进入 <code>linux-mainline</code> 文件夹查看 <code>PKGBUILD</code> 后可以发现其从 &lt;kernel.org&gt; 的 Git 服务器获取上游的 Linux 源码:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="built_in">source</span>=(</span><br><span class="line">  <span class="string">&quot;<span class="variable">$_srcname</span>::git+https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git#tag=<span class="variable">$_tag</span>&quot;</span></span><br><span class="line">  config         <span class="comment"># the main kernel config file</span></span><br><span class="line">)</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>但是完整的 Linux 仓库体积已经超过 2 GB, 对于中国大陆用户不够友好. 好在 &lt;kernel.org&gt; 在北京已经设置 Git 镜像: <a href="https://kernel.source.codeaurora.cn/">https://kernel.source.codeaurora.cn/</a>. 所以我们可以修改上游仓库的 URL, 以提高下载速度. 在编辑器中打开 <code>PKGBUILD</code>:</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">26c26</span><br><span class="line">&lt;   &quot;$_srcname::git+https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git#tag=$_tag&quot;</span><br><span class="line"><span class="comment">---</span></span><br><span class="line">&gt;   &quot;$_srcname::git+https://kernel.source.codeaurora.cn/pub/scm/linux/kernel/git/torvalds/linux.git#tag=$_tag&quot;</span><br></pre></td></tr></table></figure><p>或者是执行下面的命令修改:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;s/git+https\:\/\/git\.kernel\.org\/pub\/scm\/linux\/kernel\/git\/torvalds\/linux\.git/git+https:\/\/kernel.source.codeaurora.cn\/pub\/scm\/linux\/kernel\/git\/torvalds\/linux.git/&#x27;</span> PKGBUILD</span><br></pre></td></tr></table></figure><p>此外, 还可以通过 <code>yay</code> 的 <code>--editmenu</code> 参数交互式编辑:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yay -S --editmenu linux-mainline</span><br></pre></td></tr></table></figure><h2 id="可选-获取-PGP-密钥"><a href="#可选-获取-PGP-密钥" class="headerlink" title="(可选) 获取 PGP 密钥"></a>(可选) 获取 PGP 密钥</h2><p>查看 <code>PKGBUILD</code> 可以看到用户需要接受三个 PGP 密钥, 分别是:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">validpgpkeys=(</span><br><span class="line">  <span class="string">&#x27;ABAF11C65A2970B130ABE3C479BE3E4300411886&#x27;</span>  <span class="comment"># Linus Torvalds</span></span><br><span class="line">  <span class="string">&#x27;647F28654894E3BD457199BE38DBBDC86092693E&#x27;</span>  <span class="comment"># Greg Kroah-Hartman</span></span><br><span class="line">  <span class="string">&#x27;A2FF3A36AAA56654109064AB19802F8B0D70FC30&#x27;</span>  <span class="comment"># Jan Alexander Steffens (heftig)</span></span><br><span class="line">)</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>但是安装过程中可能发现 yay 卡在获取密钥的部分. 对于后两个密钥, 可以通过:<a href="https://github.com/Jguer/yay/issues/1022#issuecomment-538720089">^1</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gpg --keyserver hkp://keys.openpgp.org --recv-keys 647F28654894E3BD457199BE38DBBDC86092693E</span><br><span class="line">gpg --keyserver hkp://keys.openpgp.org --recv-keys A2FF3A36AAA56654109064AB19802F8B0D70FC30</span><br></pre></td></tr></table></figure><p>获取.</p><p>这个选项可以持久化:<a href="https://github.com/Jguer/yay/issues/1022#issuecomment-538768636">^2</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yay -Y --gpgflags <span class="string">&quot;--keyserver hkp://keys.openpgp.org&quot;</span> --save</span><br></pre></td></tr></table></figure><p>不过对于第一个密钥, 可能需要其他的方法. 首先保证存在 <code>gpg2</code> (对应包为 <code>core</code> 仓库的 <code>gnupg</code>), 再:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpg2 --auto-key-locate cert,pka,dane,wkd,keyserver --locate-keys torvalds@kernel.org</span><br></pre></td></tr></table></figure><h2 id="可选-多线程编译安装"><a href="#可选-多线程编译安装" class="headerlink" title="(可选) 多线程编译安装"></a>(可选) 多线程编译安装</h2><p>需要手动传入 <code>make</code> 命令的编译 flags:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MAKEFLAGS=<span class="string">&quot;-j16&quot;</span> yay -S linux-mainline <span class="comment"># 16 线程</span></span><br></pre></td></tr></table></figure><p>多线程编译仍然可能需要较长时间 (笔者测试需要 30 分钟左右, 因机器配置而异). 请不要断电.</p><h2 id="更新-Boot-loader-配置"><a href="#更新-Boot-loader-配置" class="headerlink" title="更新 Boot loader 配置"></a>更新 Boot loader 配置</h2><p>以 GRUB 为例:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo grub-mkconfig -o /boot/grub/grub.cfg</span><br></pre></td></tr></table></figure><h2 id="重启"><a href="#重启" class="headerlink" title="重启"></a>重启</h2><p>这是非常重要的 - 否则折腾半天系统服务没法加载的时候会很痛苦.</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2>]]></content>
    
    
    <summary type="html">&lt;p&gt;Arch Linux 可以使用多种 Linux 内核. 默认的内核由官方 &lt;code&gt;core&lt;/code&gt; 仓库的 &lt;code&gt;linux&lt;/code&gt; 包提供, 一般另附有 &lt;code&gt;linux-headers&lt;/code&gt; 包. 官方仓库中提供的预编译内核还有同为 &lt;code&gt;core&lt;/code&gt; 仓库的 &lt;code&gt;linux-lts&lt;/code&gt; 和 &lt;code&gt;extra&lt;/code&gt; 仓库的 &lt;code&gt;linux-zen&lt;/code&gt;. 不过, 在一些场合下, 例如需要更新的或是有 patch 的内核时, 我们可能需要从 AUR 中获取需要的内核并手动编译安装. 本文以 &lt;code&gt;linux-mainline&lt;/code&gt; 包为例, 主要借助 &lt;code&gt;yay&lt;/code&gt; 更便捷地处理相关操作.&lt;/p&gt;</summary>
    
    
    
    <category term="Essay" scheme="https://blog.tamako.work/categories/Essay/"/>
    
    <category term="Tutorial" scheme="https://blog.tamako.work/categories/Essay/Tutorial/"/>
    
    
    <category term="Arch Linux" scheme="https://blog.tamako.work/tags/Arch-Linux/"/>
    
    <category term="Operating System" scheme="https://blog.tamako.work/tags/Operating-System/"/>
    
    <category term="Kernel" scheme="https://blog.tamako.work/tags/Kernel/"/>
    
    <category term="AUR" scheme="https://blog.tamako.work/tags/AUR/"/>
    
    <category term="Compilation" scheme="https://blog.tamako.work/tags/Compilation/"/>
    
  </entry>
  
  <entry>
    <title>Codeforces 1399D: Binary String to Subsequences</title>
    <link href="https://blog.tamako.work/acmoi/codeforces/1399d/"/>
    <id>https://blog.tamako.work/acmoi/codeforces/1399d/</id>
    <published>2022-08-01T16:39:59.000Z</published>
    <updated>2022-08-02T00:45:19.018Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://codeforces.com/problemset/problem/1399/D">Codeforces 1399D</a> C++ 一解.</p></blockquote><span id="more"></span><h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p>本题本身的思路是很清晰的, 但考虑到一些极端数据, 需要额外添加一些数据结构.</p><p>可以确定的是, 给定的字符串的每个字符都要纳入某一个子序列中. 同时可以注意到, 如果已经存在一些子序列, 对于源串的某个字符, 只要其能接在某个子序列之后, 就不会增加现有子序列的数量; 若这个字符无法接在任何现有子序列之后, 拆开其中一部分子序列使其能够纳入也不会使子序列数量减少. 因此这种策略是最优的.</p><p>本题给定的数据规模 $\sum n\leq2\times10^5$. 若每次尝试添加字符到子序列时都顺序搜索现有子序列, 部分测试点无法通过 (例如:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">200000</span><br><span class="line">111111111111... (200000 个 1)</span><br></pre></td></tr></table></figure><p>). 因此可以设置两个栈结构用于存储现有的 “尾数” 为 0 和 1 的子序列的序号. 因为只需要构造出一种可行的组合子序列的方案即可, 只需要对栈作入栈, 出栈操作, 其时间开销可以接受.</p><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">char</span> <span class="title">change_bit</span><span class="params">(<span class="keyword">char</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x == <span class="string">&#x27;1&#x27;</span> ? <span class="string">&#x27;0&#x27;</span> : <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">change_bit</span><span class="params">(<span class="keyword">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x ? <span class="number">0</span> : <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">get_bit</span><span class="params">(<span class="keyword">char</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve_and_print</span><span class="params">(string s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n = s.<span class="built_in">length</span>(), total = <span class="number">0</span>;</span><br><span class="line">    <span class="function">vector&lt;<span class="keyword">int</span>&gt; <span class="title">ans</span><span class="params">(n, <span class="number">0</span>)</span>, stack[2]</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">char</span> c = <span class="built_in">change_bit</span>(s[i]);</span><br><span class="line">        <span class="keyword">int</span> x = <span class="built_in">get_bit</span>(c), y = <span class="built_in">get_bit</span>(s[i]);</span><br><span class="line">        <span class="keyword">if</span> (stack[x].<span class="built_in">empty</span>())</span><br><span class="line">        &#123;</span><br><span class="line">            ++total;</span><br><span class="line">            ans[i] = total;</span><br><span class="line">            stack[y].<span class="built_in">push_back</span>(total - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> j = stack[x].<span class="built_in">back</span>();</span><br><span class="line">            stack[x].<span class="built_in">pop_back</span>();</span><br><span class="line">            stack[y].<span class="built_in">push_back</span>(j);</span><br><span class="line">            ans[i] = j + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; total &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; ans[i] &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ios_base::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="number">0</span>), cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> t, n;</span><br><span class="line">    string s;</span><br><span class="line"></span><br><span class="line">    cin &gt;&gt; t;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (t--)</span><br><span class="line">    &#123;</span><br><span class="line">        cin &gt;&gt; n &gt;&gt; s;</span><br><span class="line">        <span class="built_in">solve_and_print</span>(s);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://codeforces.com/problemset/problem/1399/D&quot;&gt;Codeforces 1399D&lt;/a&gt; C++ 一解.&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Essay" scheme="https://blog.tamako.work/categories/Essay/"/>
    
    
    <category term="Programming" scheme="https://blog.tamako.work/tags/Programming/"/>
    
    <category term="C++" scheme="https://blog.tamako.work/tags/C/"/>
    
    <category term="Codeforces" scheme="https://blog.tamako.work/tags/Codeforces/"/>
    
    <category term="Solution" scheme="https://blog.tamako.work/tags/Solution/"/>
    
  </entry>
  
  <entry>
    <title>Codeforces 1368B: Codeforces Subsequences</title>
    <link href="https://blog.tamako.work/acmoi/codeforces/1368b/"/>
    <id>https://blog.tamako.work/acmoi/codeforces/1368b/</id>
    <published>2022-08-01T10:25:06.000Z</published>
    <updated>2022-08-01T14:08:08.080Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://codeforces.com/problemset/problem/1368/B">Codeforces 1368B</a> C++ 和 Python 一解.</p></blockquote><span id="more"></span><blockquote><p>终于看到一道比较有趣的 constructive algorithm 的题目了.</p></blockquote><h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p>本题是 “乘法原理” 的经典应用之一: 每一个内容为 <code>codeforces</code> 子序列都需要在源串中各选择十个字符连续重复的字符串 (指连续的 <code>c</code>, <code>o</code>, <code>d</code> 等十个字符串) 中的一个字符. 若假定源串 $s$ 中 <code>c</code>, <code>o</code>, <code>d</code> 等字符各连续重复 $a_0,a_1,a_2,\cdots,a_9$ 次, 则最终能生成的 <code>codeforces</code> 子序列共有 $l=a_0a_1a_2\cdots a_9$ 个. 而为满足题意, 需要选择合适的 $a_0,a_1,a_2,\cdots,a_9$, 使得 $l\geq k$ 且 $L=a_0+a_1+a_2+\cdots+a_9$ 尽可能小.</p><h3 id="一种贪心的策略"><a href="#一种贪心的策略" class="headerlink" title="一种贪心的策略"></a>一种贪心的策略</h3><p>我们知道, 根据均值不等式, 对于长度为 $n$ 的正有限实数列 ${a_i}$, 有</p><p>$$<br>\sqrt[n]{\prod^{n}<em>{i=1}{a_i}}\leq\sum^{n}</em>{i=1}{a_i},<br>$$</p><p>当且仅当 ${a_i}$ 是常数列时取等号. 对于本题, 可以猜想: 当左式恒定, 即 $l$ 恒定时, 若要使右式 (也即 $L$) 尽可能小, 则需要选择相差不大的 $a_i(i=0,1,\cdots,9)$. 这即是一种贪心策略.</p><p>我们希望 $a_i$ 的极差尽可能小, 一种选择方法是令其中一部分 $a_i$ 比另一部分恰好大 $1$ (当然理想情况是这些 $a_i$ 都相等). 不妨假设 $a_0,a_1,\cdots,a_{m-1}$ ($m=0,1,\cdots,10$, 当 $m=0$ 时规定 $a_i=a$, 当 $m=10$ 时规定 $a_i=a+1$) 都等于 $a+1(a\in\mathbb{N}^{*})$, $a_m,a_{m+1},\cdots,a_9$ 都等于 $a$. 那么</p><p>$$<br>l=(a+1)^{10-m}a^m,\<br>L=(10-m)(a+1)+ma=10a-m+10.<br>$$</p><h3 id="a-和-m-的确定"><a href="#a-和-m-的确定" class="headerlink" title="$a$ 和 $m$ 的确定"></a>$a$ 和 $m$ 的确定</h3><p>首先我们关注 $m=10$ 即 $l=a^{10}$ 的情况. 注意到此时若要使 $l\geq k$, 则 $a\geq\sqrt[10]{k}$.</p><p>而当 $a$ 固定时, 对于不同的 $m$, 有 $\sup l=(a+1)^{10}$, $\inf l=a^{10}$, 且考虑到当 $a_p&gt;a_q$ 时恒有 $\left.L\right|<em>{a=a_p}\geq\left.L\right|</em>{a=a_q}$, 则 $a$ 可以选取 $\lfloor\sqrt[10]{k}\rfloor$.</p><p>对于 $m$, 理论上根据 $l\geq k$ 可以推导得到 $m\leq\dfrac{10\ln(a+1)-\ln k}{\ln(a+1)-\ln a}$, 但在实际编程中考虑到浮点数存在的误差 (直接用此式计算无法通过 Codeforces 测试集), 我们需要利用大整数 (<code>long long unsigned</code> 足够) 从 $m=0$ 或 $m=10$ 开始逐个测试 (理论上也可以使用二分查找, 但本题的数据规模下不必要), 直到找到符合要求的 $m$. 为方便起见, 确定 $a$ 的过程依然使用了对数法, 同时为尽可能保证计算准确, 代码中使用了自定义的下取整函数 <code>better_floor()</code>.</p><p>在 Python 中, 考虑到其原生支持处理超长整数, 对上述推导公式修改为 $k(a+1)^m\leq a^m(a+1)^{10}$, 同样可以达到题意所需要求, 而这式两边即对应下述代码中的 <code>left</code> 和 <code>right</code>.</p><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><h3 id="C"><a href="#C" class="headerlink" title="C++"></a>C++</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EPS (1e-14)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">const</span> string <span class="title">base</span><span class="params">(<span class="string">&quot;codeforces&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">better_floor</span><span class="params">(<span class="keyword">double</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">double</span> y = <span class="built_in">ceil</span>(x);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> (y - x &lt; EPS ? y : <span class="built_in">floor</span>(x));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">calc_m</span><span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> <span class="keyword">unsigned</span> k, <span class="keyword">int</span> a)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> <span class="keyword">unsigned</span> l = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> m = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        l *= a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (l &lt; k &amp;&amp; m-- &gt;= <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        l = l * (a + <span class="number">1</span>) / a;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> m;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> <span class="keyword">unsigned</span> k;</span><br><span class="line">    <span class="keyword">int</span> a, m;</span><br><span class="line"></span><br><span class="line">    cin &gt;&gt; k;</span><br><span class="line"></span><br><span class="line">    a = <span class="built_in"><span class="keyword">int</span></span>(<span class="built_in">better_floor</span>(<span class="built_in">pow</span>(k, <span class="number">0.1</span>)));</span><br><span class="line">    m = <span class="built_in">calc_m</span>(k, a);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span> - m; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="built_in">string</span>(a + <span class="number">1</span>, base[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">10</span> - m; i &lt; <span class="number">10</span>; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="built_in">string</span>(a, base[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calc_m3</span>(<span class="params">k, a</span>):</span></span><br><span class="line">    left, right = k, (a + <span class="number">1</span>) ** <span class="number">10</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">12</span>):</span><br><span class="line">        left *= a + <span class="number">1</span></span><br><span class="line">        right *= a</span><br><span class="line">        <span class="keyword">if</span> left &gt; right:</span><br><span class="line">            <span class="keyword">return</span> i - <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line"></span><br><span class="line">k = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line"></span><br><span class="line">base = <span class="string">&#x27;codeforces&#x27;</span></span><br><span class="line">a = <span class="built_in">int</span>(k ** <span class="number">0.1</span>)</span><br><span class="line">m = calc_m3(k, a)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span> - m):</span><br><span class="line">    <span class="built_in">print</span>(base[i] * (a + <span class="number">1</span>), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span> - m, <span class="number">10</span>):</span><br><span class="line">    <span class="built_in">print</span>(base[i] * a, end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://codeforces.com/problemset/problem/1368/B&quot;&gt;Codeforces 1368B&lt;/a&gt; C++ 和 Python 一解.&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Essay" scheme="https://blog.tamako.work/categories/Essay/"/>
    
    
    <category term="Programming" scheme="https://blog.tamako.work/tags/Programming/"/>
    
    <category term="Python" scheme="https://blog.tamako.work/tags/Python/"/>
    
    <category term="C++" scheme="https://blog.tamako.work/tags/C/"/>
    
    <category term="Codeforces" scheme="https://blog.tamako.work/tags/Codeforces/"/>
    
    <category term="Solution" scheme="https://blog.tamako.work/tags/Solution/"/>
    
  </entry>
  
  <entry>
    <title>Codeforces 1430C: Numbers on Whiteboard</title>
    <link href="https://blog.tamako.work/acmoi/codeforces/1430c/"/>
    <id>https://blog.tamako.work/acmoi/codeforces/1430c/</id>
    <published>2022-07-31T02:39:03.000Z</published>
    <updated>2022-07-31T02:49:50.473Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://codeforces.com/problemset/problem/1430/C">Codeforces 1430C</a> C++ 一解.</p></blockquote><span id="more"></span><h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p>白板上的数字初始状态是固定的 $1,2,\cdots,n$. 每次操作都会 “折损” 当下所有数字之和, 而 “折损” 的量即为选定的两个数之和的一半. 因此为使最后得到的数字最小, 一种贪心的方法是每次选择最大的两个数字做操作.</p><p>操作时对于两数之和为奇数的, 得到的新数字需要向上取整. 虽然有 “凭空” 增大数字总和的可能性, 但经过数学归纳即可得知最后一次操作选定的数字一定是 $1$ 和 $3$ $(n&gt;2)$ 或 $1$ 和 $2$ $(n=2)$, 也即最后得到的数字为 $2$. 显然若要得到小于 $2$ 的数字, 需要在倒数第二次操作时白板上只剩下两个 $1$, 而这在向上取整的规则下是做不到的. 因此这种贪心方法即为最优解.</p><h3 id="空间和时间优化"><a href="#空间和时间优化" class="headerlink" title="空间和时间优化"></a>空间和时间优化</h3><p>因为白板数字的初始状态是规律性的连续自然数列, 选定数字的过程也极为规律, 无需要实际使用栈等数据结构模拟. 官方<a href="https://codeforces.com/blog/entry/83614">题解</a>则提供了使用实际数据结构 <code>vector&lt;int&gt;</code> 的方法.</p><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solveAndPrint</span><span class="params">(<span class="keyword">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="number">2</span> &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; n - <span class="number">1</span> &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; n &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt; n; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; n - i &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; n - i + <span class="number">2</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> t, n;</span><br><span class="line"></span><br><span class="line">    cin &gt;&gt; t;</span><br><span class="line">    <span class="keyword">while</span> (t--)</span><br><span class="line">    &#123;</span><br><span class="line">        cin &gt;&gt; n;</span><br><span class="line">        <span class="built_in">solveAndPrint</span>(n);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://codeforces.com/problemset/problem/1430/C&quot;&gt;Codeforces 1430C&lt;/a&gt; C++ 一解.&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Essay" scheme="https://blog.tamako.work/categories/Essay/"/>
    
    
    <category term="Programming" scheme="https://blog.tamako.work/tags/Programming/"/>
    
    <category term="C++" scheme="https://blog.tamako.work/tags/C/"/>
    
    <category term="Codeforces" scheme="https://blog.tamako.work/tags/Codeforces/"/>
    
    <category term="Solution" scheme="https://blog.tamako.work/tags/Solution/"/>
    
  </entry>
  
  <entry>
    <title>Codeforces 1419D1: Sage&#39;s Birthday (easy version)</title>
    <link href="https://blog.tamako.work/acmoi/codeforces/1419d1/"/>
    <id>https://blog.tamako.work/acmoi/codeforces/1419d1/</id>
    <published>2022-07-30T16:40:20.000Z</published>
    <updated>2022-07-30T16:44:38.999Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://codeforces.com/problemset/problem/1419/D1">Codeforces 1419D1</a> C++ 一解.</p></blockquote><span id="more"></span><h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p>本题是简单版本, 各个冰淇淋球的价格都不相同. 我们只需要构造出数量最多的 “谷” 即可. 与上篇 <a href="https://blog.imakiseki.cf/acmoi/codeforces/1312b/">Codeforces 1312B: Bogosort</a> 类似, 这次相当于对一个排序后的数组同时从两边取数输出, 例如对输入数据 $[7,6,5,4,3,2,1]$, 两边取数得到 $[7,1,6,2,5,3,4]$, 这样得到的新数列的 “谷” 数量最多, 且为 $\left[\dfrac{n-1}{2}\right]$.</p><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> a[<span class="number">100000</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n, p = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        cin &gt;&gt; a[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; (n - <span class="number">1</span>) / <span class="number">2</span> &lt;&lt; endl;</span><br><span class="line">    <span class="built_in">sort</span>(a, a + n);</span><br><span class="line">    <span class="keyword">while</span> (p++ &lt; n / <span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; a[n - p] &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; a[p - <span class="number">1</span>] &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (n % <span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; a[p - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://codeforces.com/problemset/problem/1419/D1&quot;&gt;Codeforces 1419D1&lt;/a&gt; C++ 一解.&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Essay" scheme="https://blog.tamako.work/categories/Essay/"/>
    
    
    <category term="Programming" scheme="https://blog.tamako.work/tags/Programming/"/>
    
    <category term="C++" scheme="https://blog.tamako.work/tags/C/"/>
    
    <category term="Codeforces" scheme="https://blog.tamako.work/tags/Codeforces/"/>
    
    <category term="Solution" scheme="https://blog.tamako.work/tags/Solution/"/>
    
  </entry>
  
  <entry>
    <title>Codeforces 1312B: Bogosort</title>
    <link href="https://blog.tamako.work/acmoi/codeforces/1312b/"/>
    <id>https://blog.tamako.work/acmoi/codeforces/1312b/</id>
    <published>2022-07-30T15:21:16.000Z</published>
    <updated>2022-07-30T15:53:25.407Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://codeforces.com/problemset/problem/1312/B">Codeforces 1312B</a> C++ 一解.</p></blockquote><span id="more"></span><h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p>此题相当于排序数组后使两个有限数列 (一个是数列 ${1,2,\cdots,n}$, 一个是排序后的数组 $a_\mathrm{sorted}$) 的差各不相同. 一个很容易想到的构造方法是对一个单调 (不一定严格) 递减数列与严格单调递增数列求差, 这样得到的差数列的各元素一定各不相同 (且是单调递减的).</p><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> t, n, a[<span class="number">100</span>];</span><br><span class="line"></span><br><span class="line">    cin &gt;&gt; t;</span><br><span class="line">    <span class="keyword">while</span> (t--)</span><br><span class="line">    &#123;</span><br><span class="line">        cin &gt;&gt; n;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">        &#123;</span><br><span class="line">            cin &gt;&gt; a[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">sort</span>(a, a + n); <span class="comment">// 先递增排列</span></span><br><span class="line">        <span class="keyword">while</span> (n--)</span><br><span class="line">        &#123;</span><br><span class="line">            cout &lt;&lt; a[n] &lt;&lt; <span class="string">&#x27; &#x27;</span>; <span class="comment">// 再倒序输出, 相当于 &quot;构造&quot; 出了递减数列</span></span><br><span class="line">        &#125;</span><br><span class="line">        cout &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://codeforces.com/problemset/problem/1312/B&quot;&gt;Codeforces 1312B&lt;/a&gt; C++ 一解.&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Essay" scheme="https://blog.tamako.work/categories/Essay/"/>
    
    
    <category term="Programming" scheme="https://blog.tamako.work/tags/Programming/"/>
    
    <category term="C++" scheme="https://blog.tamako.work/tags/C/"/>
    
    <category term="Codeforces" scheme="https://blog.tamako.work/tags/Codeforces/"/>
    
    <category term="Solution" scheme="https://blog.tamako.work/tags/Solution/"/>
    
  </entry>
  
  <entry>
    <title>Codeforces 1474B: Different Divisors</title>
    <link href="https://blog.tamako.work/acmoi/codeforces/1474b/"/>
    <id>https://blog.tamako.work/acmoi/codeforces/1474b/</id>
    <published>2022-07-30T03:14:01.000Z</published>
    <updated>2022-07-30T03:56:54.024Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://codeforces.com/problemset/problem/1474/B">Codeforces 1474B</a> C++ 一解.</p></blockquote><span id="more"></span><h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p>$a$ 至少要有 $4$ 个因子 (自然包括 $1$ 和 $a$ 本身), 且任意两因子的差不小于 $d$. 为使 $a$ 尽可能小, 我们只希望 $a$ 有且仅有 $4$ 个因子, 也就是再确定两个不同的质因子 $p,q$ ($a=pq$, 且不妨设 $p&lt;q$).</p><p>一个很显然的事实是: 对于充分大的 $d$, 我们越能保证 $a-q\geq d$ (不会证明故从略), 因此我们只需要在质数表中找到不小于 $1+d$ ($1$ 即是因子升序排列的第一个因子) 的 $p$ (第二个因子) 和不小于 $p+d$ 的 $q$ (第三个因子), 再确保 $a$ (第四个因子) 与 $q$ 的差不小于 $d$ 即可. 经过验证, 对于 $d=1$ 依然有 $a-q\geq d$.</p><h3 id="生成质数表"><a href="#生成质数表" class="headerlink" title="生成质数表"></a>生成质数表</h3><p>生成质数表的方式有很多. 以下代码中尝试利用 STL 的 <code>vector&lt;int&gt;</code> 动态生成/更新指定范围内的质数表. 当然考虑到 $d\leq 10,000$, 可以直接生成完整长度 (所需的最大质数为 $20,011$, 根据质数定理估计质数表长度为 $2020$) 的质数表.</p><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_PRIME (20011) <span class="comment">// 10007 and 20011 are primes.</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isPrime</span><span class="params">(<span class="keyword">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x == <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (x == <span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (x % <span class="number">2</span> == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">3</span>; i &lt;= <span class="built_in"><span class="keyword">int</span></span>(<span class="built_in">floor</span>(<span class="built_in">sqrt</span>(x))); i += <span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (x % i == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">vector&lt;<span class="keyword">int</span>&gt; <span class="title">updatePrimes</span><span class="params">(<span class="keyword">int</span> maxn, vector&lt;<span class="keyword">int</span>&gt; primes)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> lastPrime = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (primes.<span class="built_in">size</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        lastPrime = primes.<span class="built_in">back</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        primes.<span class="built_in">push_back</span>(<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = lastPrime + (lastPrime == <span class="number">2</span> ? <span class="number">1</span> : <span class="number">2</span>); i &lt;= maxn; i += <span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">isPrime</span>(i))</span><br><span class="line">        &#123;</span><br><span class="line">            primes.<span class="built_in">push_back</span>(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> primes;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">vector&lt;<span class="keyword">int</span>&gt; <span class="title">updatePrimes</span><span class="params">(<span class="keyword">int</span> maxn)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">updatePrimes</span>(maxn, vector&lt;<span class="keyword">int</span>&gt;());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> d, vector&lt;<span class="keyword">int</span>&gt; primes)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vector&lt;<span class="keyword">int</span>&gt;::iterator index1 = <span class="built_in">lower_bound</span>(primes.<span class="built_in">begin</span>(), primes.<span class="built_in">end</span>(), <span class="number">1</span> + d);</span><br><span class="line">    vector&lt;<span class="keyword">int</span>&gt;::iterator index2 = <span class="built_in">lower_bound</span>(primes.<span class="built_in">begin</span>(), primes.<span class="built_in">end</span>(), *index1 + d);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> *index1 * *index2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> t, d;</span><br><span class="line">    vector&lt;<span class="keyword">int</span>&gt; primes = <span class="built_in">updatePrimes</span>(MAX_PRIME);</span><br><span class="line"></span><br><span class="line">    cin &gt;&gt; t;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (t--)</span><br><span class="line">    &#123;</span><br><span class="line">        cin &gt;&gt; d;</span><br><span class="line">        cout &lt;&lt; <span class="built_in">solve</span>(d, primes) &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://codeforces.com/problemset/problem/1474/B&quot;&gt;Codeforces 1474B&lt;/a&gt; C++ 一解.&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Essay" scheme="https://blog.tamako.work/categories/Essay/"/>
    
    
    <category term="Programming" scheme="https://blog.tamako.work/tags/Programming/"/>
    
    <category term="C++" scheme="https://blog.tamako.work/tags/C/"/>
    
    <category term="Codeforces" scheme="https://blog.tamako.work/tags/Codeforces/"/>
    
    <category term="Solution" scheme="https://blog.tamako.work/tags/Solution/"/>
    
  </entry>
  
  <entry>
    <title>Codeforces 766A: Mahmoud and Longest Uncommon Subsequence</title>
    <link href="https://blog.tamako.work/acmoi/codeforces/766a/"/>
    <id>https://blog.tamako.work/acmoi/codeforces/766a/</id>
    <published>2022-07-30T00:52:37.000Z</published>
    <updated>2022-07-30T01:03:13.140Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://codeforces.com/problemset/problem/766/A">Codeforces 766A</a> C++ 一解.</p></blockquote><span id="more"></span><h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p>两个字符串的最长不公共子序列被定义为最长的仅为其中一个字符串的子序列的字符串.</p><p>对于两个长度不相同的字符串 (不妨设 $a,b$ 且 $a$ 的长度较长), 一个非常直观的想法是: 因为一个字符串的子序列的长度必须不大于该串的长度, 只要选取 $a$ 本身作为所求的子序列, 其肯定是 $a$ 的子序列, 而不是 $b$ 的子序列.</p><p>而对于长度相同的情况, 我们同样可以使用类似的思路: 若两个串不相同, 我们总能选择其中一个串本身作为所求的子序列, 这样其一定不会是另一个串的子序列; 若两个串完全相同, 此时我们就无法找到一个串 (根据题意, 包括空串) 作为所求的子序列, 只能输出 $-1$.</p><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    string a, b;</span><br><span class="line"></span><br><span class="line">    cin &gt;&gt; a &gt;&gt; b;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (a == b)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="number">-1</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="built_in">max</span>(a.<span class="built_in">length</span>(), b.<span class="built_in">length</span>()) &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://codeforces.com/problemset/problem/766/A&quot;&gt;Codeforces 766A&lt;/a&gt; C++ 一解.&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Essay" scheme="https://blog.tamako.work/categories/Essay/"/>
    
    
  </entry>
  
  <entry>
    <title>Codeforces 1520C: Not Adjacent Matrix</title>
    <link href="https://blog.tamako.work/acmoi/codeforces/1520c/"/>
    <id>https://blog.tamako.work/acmoi/codeforces/1520c/</id>
    <published>2022-07-28T11:23:45.000Z</published>
    <updated>2022-07-28T11:39:43.700Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://codeforces.com/problemset/problem/1520/C">Codeforces 1520C</a> C++ 一解.</p></blockquote><span id="more"></span><h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p>只要求对 $n$ 阶方阵依次填充 $1,2,\cdots,n^2$, 一种常见的思考模式是依次将这个自然数序列填充到正确的位置. 显然对于本题一个较好的方案是间隔填充: 先从元素 $(0,0)$ (假定方阵左上角元素坐标为此, 其他类推) 开始每次间隔一格填充直至一行填充完毕, 再跳转到下一行间隔填充直至右下角元素 $(n-1,n-1)$, 接着顺序填充剩下的元素. 这样就能满足题意.</p><p>Codeforces 上<a href="https://codeforces.com/blog/entry/90342">编辑者博客</a>中, <a href="https://codeforces.com/profile/MikeMirzayanov">MikeMirzayazov</a> 用黑白棋盘举例, 先填充白格再填充黑格, 判定颜色依据为横纵坐标之和的奇偶性. 而以下的代码则直接将方阵拉长为长度为 $n$ 的一维数组, 直接根据下标的奇偶性填充数字, 效果类似. 当然以下的代码推出了每个坐标对应的数值的解析式, 并未利用到数组空间.</p><p>同时, 利用这样的填充方案, 显然可以得知当且仅当 $n=2$ 时找不到满足题意的方阵; 为方便编程, 这里将 $n=1$ 也做了特殊处理.</p><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solveAndPrint</span><span class="params">(<span class="keyword">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> nn = n * n;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="number">1</span> &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="number">-1</span> &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (n % <span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nn; ++i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (i % <span class="number">2</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                cout &lt;&lt; (nn + i) / <span class="number">2</span> + <span class="number">1</span> &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                cout &lt;&lt; i / <span class="number">2</span> + <span class="number">1</span> &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> ((i + <span class="number">1</span>) % n == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                cout &lt;&lt; endl;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nn; ++i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (i % <span class="number">2</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                cout &lt;&lt; (nn + i + <span class="number">1</span>) / <span class="number">2</span> &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                cout &lt;&lt; i / <span class="number">2</span> + <span class="number">1</span> &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> ((i + <span class="number">1</span>) % n == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                cout &lt;&lt; endl;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> t, n;</span><br><span class="line"></span><br><span class="line">    cin &gt;&gt; t;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; t; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        cin &gt;&gt; n;</span><br><span class="line">        <span class="built_in">solveAndPrint</span>(n);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://codeforces.com/problemset/problem/1520/C&quot;&gt;Codeforces 1520C&lt;/a&gt; C++ 一解.&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Essay" scheme="https://blog.tamako.work/categories/Essay/"/>
    
    
    <category term="Programming" scheme="https://blog.tamako.work/tags/Programming/"/>
    
    <category term="C++" scheme="https://blog.tamako.work/tags/C/"/>
    
    <category term="Codeforces" scheme="https://blog.tamako.work/tags/Codeforces/"/>
    
    <category term="Solution" scheme="https://blog.tamako.work/tags/Solution/"/>
    
  </entry>
  
  <entry>
    <title>Codeforces 266B: Queue at the School</title>
    <link href="https://blog.tamako.work/acmoi/codeforces/266b/"/>
    <id>https://blog.tamako.work/acmoi/codeforces/266b/</id>
    <published>2022-07-26T14:57:22.000Z</published>
    <updated>2022-08-15T14:43:42.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://codeforces.com/problemset/problem/266/B">Codeforces 266B</a> C++ 一解。</p></blockquote><span id="more"></span><h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p>简单的模拟。把 B 想象成箱子，要不断往右侧推。</p><p>需要注意的是，没有正确理解题意的话容易理解成每次让箱子统一右移一格。但实际上，遇到 <code>BBG</code> 的情况，下一秒应该是 <code>BGB</code> 而不是 <code>GBB</code>，因为某一时刻某两个相邻位置的 B 和 G 互换后，就只能考虑其后的位置了。再拿箱子举例，应该想象成连续的箱子无法推动，只能推动箱子“队列”的最末一个。</p><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// brute force</span></span><br><span class="line"><span class="function">string <span class="title">solve</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span> t, string s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> l = s.<span class="built_in">length</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; t; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (j &lt; l - <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (s[j] == <span class="string">&#x27;B&#x27;</span> &amp;&amp; s[j + <span class="number">1</span>] == <span class="string">&#x27;G&#x27;</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                s[j] = <span class="string">&#x27;G&#x27;</span>;</span><br><span class="line">                s[j + <span class="number">1</span>] = <span class="string">&#x27;B&#x27;</span>;</span><br><span class="line">                j += <span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                ++j;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n, t;</span><br><span class="line">    string s, a;</span><br><span class="line"></span><br><span class="line">    cin &gt;&gt; n &gt;&gt; t;</span><br><span class="line">    cin &gt;&gt; s;</span><br><span class="line"></span><br><span class="line">    a = <span class="built_in">solve</span>(n, t, s);</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; a &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://codeforces.com/problemset/problem/266/B&quot;&gt;Codeforces 266B&lt;/a&gt; C++ 一解。&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Essay" scheme="https://blog.tamako.work/categories/Essay/"/>
    
    
    <category term="Programming" scheme="https://blog.tamako.work/tags/Programming/"/>
    
    <category term="C++" scheme="https://blog.tamako.work/tags/C/"/>
    
    <category term="Codeforces" scheme="https://blog.tamako.work/tags/Codeforces/"/>
    
    <category term="Solution" scheme="https://blog.tamako.work/tags/Solution/"/>
    
  </entry>
  
  <entry>
    <title>【Arch Linux】本地化：简体中文</title>
    <link href="https://blog.tamako.work/techdev/arch/localization-simplified-chinese/"/>
    <id>https://blog.tamako.work/techdev/arch/localization-simplified-chinese/</id>
    <published>2022-07-13T14:26:58.000Z</published>
    <updated>2022-07-13T18:14:13.000Z</updated>
    
    <content type="html"><![CDATA[<p>本文主要介绍 Arch Linux 本地化为简体中文的操作。</p><p>本文的测试环境是 KDE Plasma + SDDM + Wayland。考虑到 Xorg 教程较多，且大部分操作通用，本文会存在 Xorg 和 Wayland 混合描述的情况。</p><span id="more"></span><h2 id="必要配置"><a href="#必要配置" class="headerlink" title="必要配置"></a>必要配置</h2><p>不建议用户日常使用 root 帐户，则此时用户的当前帐户建议拥有 sudo 权限。安装 <code>sudo</code> 包。</p><p>同时部分本地化安装包在 AUR 源中，建议用户安装 AUR helper。本文以 <code>yay</code> 为例。</p><h2 id="生成语言环境-1"><a href="#生成语言环境-1" class="headerlink" title="生成语言环境^1"></a>生成语言环境<a href="https://wiki.archlinux.org/title/Localization/Simplified_Chinese#locale_settings">^1</a></h2><p>编辑 <code>/etc/locale.gen</code>，找到 <code>#en_US.UTF-8 UTF-8</code> 和 <code>#zh_CN.UTF-8 UTF-8</code>，删除前面的注释符号“#”。</p><p>再生成语言环境文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo locale-gen</span><br></pre></td></tr></table></figure><p>为保证大部分程序和终端环境显示正常，在 <code>/etc/locale.conf</code> 中设置 <code>LANG</code> 环境变量：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LANG=en_US.UTF-8</span><br></pre></td></tr></table></figure><h3 id="（可选）为-Xorg-图形界面设置中文语言环境"><a href="#（可选）为-Xorg-图形界面设置中文语言环境" class="headerlink" title="（可选）为 Xorg 图形界面设置中文语言环境"></a>（可选）为 Xorg 图形界面设置中文语言环境</h3><p>编辑 <code>~/.xinitrc</code> 或 <code>~/.xprofile</code>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> LANG=zh_CN.UTF-8</span><br><span class="line"><span class="built_in">export</span> LANGUAGE=zh_CN:en_US</span><br></pre></td></tr></table></figure><h2 id="显示简体中文字体"><a href="#显示简体中文字体" class="headerlink" title="显示简体中文字体"></a>显示简体中文字体</h2><p>此时图形界面的中文显示一般是异常的。这可以通过安装相关字体解决。</p><h3 id="安装字体-2"><a href="#安装字体-2" class="headerlink" title="安装字体^2"></a>安装字体<a href="https://wiki.archlinux.org/title/Localization/Simplified_Chinese#Install_fonts">^2</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S wqy-microhei wqy-microhei-lite wqy-bitmapfont wqy-zenhei ttf-arphic-ukai ttf-arphic-uming adobe-source-han-sans-cn-fonts adobe-source-han-serif-cn-fonts noto-fonts-cjk</span><br></pre></td></tr></table></figure><p>可选 AUR 源中 <code>ttf-ms-win11-auto-*</code> 相关的包（存在已知问题，见<a href="#ttf-ms-win11-auto--%E7%9B%B8%E5%85%B3%E5%8C%85%E6%97%A0%E6%95%88">下文</a>）。</p><p>一般此时字体缓存已刷新。若无：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fc-cache -fv</span><br></pre></td></tr></table></figure><p>可以通过类似下述命令验证字体缓存：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fc-match -s | grep <span class="string">&#x27;Noto Sans CJK&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="ttf-ms-win11-auto-相关包无效"><a href="#ttf-ms-win11-auto-相关包无效" class="headerlink" title="ttf-ms-win11-auto-* 相关包无效"></a><code>ttf-ms-win11-auto-*</code> 相关包无效</h4><p>参见 <code>ttf-ms-win11-auto</code> AUR 包<a href="https://aur.archlinux.org/packages/ttf-ms-win11-auto">详情页面</a>下的<a href="https://aur.archlinux.org/packages/ttf-ms-win11-auto#comment-873004">评论</a>：</p><blockquote><p>It still throws <code>ln: failed to create symbolic link &#39;/home/&lt;User&gt;/.cache/yay/ttf-ms-win11-auto/src/&#39; -&gt; &#39;&#39;: No such file or directory</code> warnings when I install the package via yay. Manually copy/move the font files from <code>~/.cache/yay/ttf-ms-win11-auto/src</code> to <code>/usr/share/fonts</code> and <code>fc-cache -fv</code> can solve the problem.</p></blockquote><p>因此，读者只需查看 AUR 包的缓存（如 <code>~/.cache/yay/ttf-ms-win11-auto</code>），找到其中的字体文件，或是解压其中的压缩包（如 <code>ttf-ms-win11-auto-zh_cn-10.0.22000.318-2-any.pkg.tar.zst</code>）得到字体文件，将其复制到 <code>/usr/share/fonts</code> 并重新生成字体缓存即可。</p><h3 id="修复简体中文字符显示为日文的问题-3"><a href="#修复简体中文字符显示为日文的问题-3" class="headerlink" title="修复简体中文字符显示为日文的问题^3"></a>修复简体中文字符显示为日文的问题<a href="https://wiki.archlinux.org/title/Localization/Simplified_Chinese#Fixed_Simplified_Chinese_display_as_a_variant_(Japanese)_glyph">^3</a></h3><p>新建文件 <code>/etc/fonts/conf.avail/64-language-selector-prefer.conf</code>：</p><p>若安装 <a href="https://archlinux.org/packages/?name=noto-fonts-cjk">noto-fonts-cjk</a> 包：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">fontconfig</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;fonts.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">fontconfig</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">alias</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">family</span>&gt;</span>serif<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">prefer</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">family</span>&gt;</span>Noto Serif CJK SC<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">family</span>&gt;</span>Noto Serif CJK TC<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">family</span>&gt;</span>Noto Serif CJK JP<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">prefer</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">alias</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">alias</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">family</span>&gt;</span>sans-serif<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">prefer</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">family</span>&gt;</span>Noto Sans CJK SC<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">family</span>&gt;</span>Noto Sans CJK TC<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">family</span>&gt;</span>Noto Sans CJK JP<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">prefer</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">alias</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">alias</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">family</span>&gt;</span>monospace<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">prefer</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">family</span>&gt;</span>Noto Sans Mono CJK SC<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">family</span>&gt;</span>Noto Sans Mono CJK TC<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">family</span>&gt;</span>Noto Sans Mono CJK JP<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">prefer</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">alias</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">fontconfig</span>&gt;</span></span><br></pre></td></tr></table></figure><p>若安装 <a href="https://archlinux.org/packages/?name=adobe-source-han-sans-otc-fonts">adobe-source-han-sans-otc-fonts</a> 包：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">fontconfig</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;fonts.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">fontconfig</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">alias</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">family</span>&gt;</span>serif<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">prefer</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">family</span>&gt;</span>Source Han Serif SC<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">family</span>&gt;</span>Source Han Serif TC<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">family</span>&gt;</span>Source Han Serif HW<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">family</span>&gt;</span>Source Han Serif K<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">prefer</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">alias</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">alias</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">family</span>&gt;</span>sans-serif<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">prefer</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">family</span>&gt;</span>Source Han Sans SC<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">family</span>&gt;</span>Source Han Sans TC<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">family</span>&gt;</span>Source Han Sans HW<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">family</span>&gt;</span>Source Han Sans K<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">prefer</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">alias</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">alias</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">family</span>&gt;</span>monospace<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">prefer</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">family</span>&gt;</span>Source Han Sans SC<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">family</span>&gt;</span>Source Han Sans TC<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">family</span>&gt;</span>Source Han Sans HW<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">family</span>&gt;</span>Source Han Sans K<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">prefer</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">alias</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">fontconfig</span>&gt;</span></span><br></pre></td></tr></table></figure><p>然后新建软链接应用配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ln -s /etc/fonts/conf.avail/64-language-selector-prefer.conf /etc/fonts/conf.d/64-language-selector-prefer.conf</span><br></pre></td></tr></table></figure><p>随后刷新字体缓存生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fc-cache -fv</span><br></pre></td></tr></table></figure><h2 id="中文输入法"><a href="#中文输入法" class="headerlink" title="中文输入法"></a>中文输入法</h2><p>本文使用 Fcitx 5 框架配套 Rime 输入法引擎和 Clover Pinyin（四叶草拼音）输入方案。</p><h3 id="Fcitx-5"><a href="#Fcitx-5" class="headerlink" title="Fcitx 5"></a>Fcitx 5</h3><h4 id="安装-4"><a href="#安装-4" class="headerlink" title="安装^4"></a>安装<a href="https://wiki.archlinux.org/title/Fcitx5#Installation">^4</a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S fcitx5 fcitx5-qt fcitx5-gtk fcitx5-configtool</span><br></pre></td></tr></table></figure><p>在 Xorg 环境下，编辑 <code>~/.xprofile</code>：<a href="https://wiki.archlinux.org/title/Fcitx5#Integration">^5</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> GTK_IM_MODULE=fcitx5</span><br><span class="line"><span class="built_in">export</span> QT_IM_MODULE=fcitx5</span><br><span class="line"><span class="built_in">export</span> XMODIFIERS=<span class="string">&quot;@im=fcitx5&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> LANG=<span class="string">&quot;zh_CN.UTF-8&quot;</span></span><br><span class="line"><span class="built_in">export</span> LC_CTYPE=<span class="string">&quot;zh_CN.UTF-8&quot;</span></span><br></pre></td></tr></table></figure><p>在 Wayland 环境下，编辑 <code>/etc/environment</code>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GTK_IM_MODULE=fcitx</span><br><span class="line">QT_IM_MODULE=fcitx</span><br><span class="line">XMODIFIERS=<span class="string">&quot;@im=fcitx&quot;</span></span><br></pre></td></tr></table></figure><p>注销会话或重启。</p><h4 id="外观"><a href="#外观" class="headerlink" title="外观"></a>外观</h4><p>本文使用 <a href="https://github.com/hosxy/Fcitx5-Material-Color">Material Color</a> 皮肤。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S fcitx5-material-color</span><br></pre></td></tr></table></figure><p>再编辑 Fcitx 5 的配置文件 <code>~/.config/fcitx5/conf/classicui.conf</code>：<a href="https://github.com/hosxy/Fcitx5-Material-Color/blob/master/README.md#%E6%89%8B%E5%8A%A8%E5%AE%89%E8%A3%85">^6</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 垂直候选列表</span></span><br><span class="line">Vertical Candidate List=False</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按屏幕 DPI 使用</span></span><br><span class="line">PerScreenDPI=True</span><br><span class="line"></span><br><span class="line"><span class="comment"># Font (设置成你喜欢的字体)</span></span><br><span class="line">Font=<span class="string">&quot;思源黑体 CN Medium 13&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 主题</span></span><br><span class="line">Theme=Material-Color-Pink</span><br></pre></td></tr></table></figure><h4 id="诊断工具"><a href="#诊断工具" class="headerlink" title="诊断工具"></a>诊断工具</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fcitx5-diagnose</span><br></pre></td></tr></table></figure><h3 id="Rime"><a href="#Rime" class="headerlink" title="Rime"></a><a href="https://rime.im/">Rime</a></h3><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S fcitx5-rime</span><br></pre></td></tr></table></figure><p>重启 Fcitx 5。依次 System Settings -&gt; Regional Settings -&gt; Input Method -&gt; Add Input Method… -&gt; Only Show Current Language [Uncheck] -&gt; Rime（中州韻）来激活输入法。</p><p><strong>注意</strong>：Rime 系统目录位于 <code>/usr/share/rime-data</code>。本地目录 <code>~/.local/share/fcitx5/rime</code> 可以覆盖前者的配置。</p><h4 id="单行模式"><a href="#单行模式" class="headerlink" title="单行模式"></a>单行模式</h4><p>单行模式类似于 Windows 10 中微软拼音的默认行为：输入的拼音序列能同时键入到文本中，待选定候选词后才将其替换为对应的词。</p><p>编辑 <code>~/.config/fcitx5/conf/rime.conf</code>：<a href="https://github.com/hosxy/Fcitx5-Material-Color/blob/master/README.md#%E5%8D%95%E8%A1%8C%E6%A8%A1%E5%BC%8F-inline-preedit">^7</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 可用时在应用程序中显示预编辑文本（开启单行模式）</span></span><br><span class="line">PreeditInApplication=True</span><br></pre></td></tr></table></figure><h3 id="Clover-Pinyin"><a href="#Clover-Pinyin" class="headerlink" title="Clover Pinyin"></a>Clover Pinyin</h3><h4 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yay -S rime-cloverpinyin</span><br></pre></td></tr></table></figure><p>编辑 <code>~/.local/share/fcitx5/rime/default.custom.yaml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">patch:</span></span><br><span class="line">  <span class="comment"># 每页候选词个数</span></span><br><span class="line">  <span class="attr">&quot;menu/page_size&quot;:</span> <span class="number">9</span></span><br><span class="line">  <span class="attr">schema_list:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">schema:</span> <span class="string">clover</span></span><br></pre></td></tr></table></figure><p>重启 Fcitx 5。</p><p><strong>注意</strong>：Clover Pinyin 有关快捷键等配置位于 <code>~/.local/share/fcitx5/rime/build/clover.schema.yaml</code>。</p><h4 id="Emoji"><a href="#Emoji" class="headerlink" title="Emoji"></a>Emoji</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S noto-fonts-emoji</span><br><span class="line">yay -S noto-color-emoji-fontconfig</span><br></pre></td></tr></table></figure><p>注销会话或重启。</p><h4 id="特殊符号"><a href="#特殊符号" class="headerlink" title="特殊符号"></a>特殊符号</h4><p>指输入特殊符号拼音出现候选词（如“pingfang”出现“²”），或输入“/xx”（“xx”表示一些英文字母的组合）出现一类候选词（如“/sx”出现数学相关特殊符号）。</p><p>对于前者，目前尚无较好的解决方案。</p><p>对于后者，参考该<a href="https://github.com/fkxxyz/rime-cloverpinyin/issues/71#issuecomment-820448262">回复</a>。</p><p><strong>注意</strong>：特殊符号支持存在已知问题，可能导致内存溢出，可以通过如下命令简单修复：<a href="https://github.com/fkxxyz/rime-cloverpinyin/issues/99">^8</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&quot;<span class="subst">$(curl -fsSL https://github.com/fkxxyz/rime-symbols/raw/master/rime-symbols-gen)</span>&quot;</span></span><br><span class="line">mkdir -p ~/.<span class="built_in">local</span>/share/fcitx5/rime/opencc</span><br><span class="line">mv symbol.json symbol_category.txt symbol_word.txt ~/.<span class="built_in">local</span>/share/fcitx5/rime/opencc</span><br></pre></td></tr></table></figure><p>重新部署 Rime。</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2>]]></content>
    
    
    <summary type="html">&lt;p&gt;本文主要介绍 Arch Linux 本地化为简体中文的操作。&lt;/p&gt;
&lt;p&gt;本文的测试环境是 KDE Plasma + SDDM + Wayland。考虑到 Xorg 教程较多，且大部分操作通用，本文会存在 Xorg 和 Wayland 混合描述的情况。&lt;/p&gt;</summary>
    
    
    
    <category term="Essay" scheme="https://blog.tamako.work/categories/Essay/"/>
    
    <category term="Tutorial" scheme="https://blog.tamako.work/categories/Essay/Tutorial/"/>
    
    
    <category term="Arch Linux" scheme="https://blog.tamako.work/tags/Arch-Linux/"/>
    
    <category term="Simplified Chinese" scheme="https://blog.tamako.work/tags/Simplified-Chinese/"/>
    
    <category term="Operating System" scheme="https://blog.tamako.work/tags/Operating-System/"/>
    
    <category term="Desktop" scheme="https://blog.tamako.work/tags/Desktop/"/>
    
    <category term="Localization" scheme="https://blog.tamako.work/tags/Localization/"/>
    
  </entry>
  
  <entry>
    <title>【Arch Linux】maddy 邮件服务器搭建</title>
    <link href="https://blog.tamako.work/techdev/arch/maddy/"/>
    <id>https://blog.tamako.work/techdev/arch/maddy/</id>
    <published>2022-05-15T17:09:52.000Z</published>
    <updated>2022-07-13T12:03:22.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://github.com/foxcpp/maddy">maddy</a> 是一个开源的轻量级“可组合”（composable）多合一邮件服务器，支持通过 IMAP/SMTP 等协议和 DKIM、SPF、DMARC、DANE、MTA-STS 等安全模式收发邮件。本文将以<a href="https://maddy.email/tutorials/setting-up/">官方文档</a>为主线，整理 maddy 服务器配置流程。</p></blockquote><span id="more"></span><h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><p>为保证 maddy 的正常运行，请先明确一些建议满足的前提条件：</p><ul><li>具有公网地址（本文以 IPv4 为例）并开放 25、143、465（TLS）、587、993（TLS）等端口（一些 VPS 提供商如谷歌云不支持）的服务器；</li><li>拥有一个域名（最好是付费二级域名，避免一些 DNS 服务商如 Cloudflare 封禁对其的 API 操作），并接入 DNS 服务商（本文以 <a href="https://www.cloudflare.com/">Cloudflare</a> 为例）；</li><li>TLS 证书（本文以 <a href="https://letsencrypt.org/">Let’s Encrypt</a> 和一款证书获取软件 <a href="https://certbot.eff.org/">certbot</a> 为例）。</li></ul><p>为叙述方便，本文假设邮件服务器的主域名为 example.org，<a href="https://zh.wikipedia.org/zh-cn/MX%E8%AE%B0%E5%BD%95">邮件交换</a>（<a href="https://en.wikipedia.org/wiki/MX_record">MX</a>）域名为 mx1.example.org，公网 IPv4 地址为 10.2.3.4，邮件账户为 <a href="mailto:&#112;&#111;&#115;&#116;&#109;&#97;&#115;&#116;&#101;&#x72;&#x40;&#101;&#120;&#x61;&#x6d;&#x70;&#x6c;&#x65;&#x2e;&#x6f;&#x72;&#x67;">&#112;&#111;&#115;&#116;&#109;&#97;&#115;&#116;&#101;&#x72;&#x40;&#101;&#120;&#x61;&#x6d;&#x70;&#x6c;&#x65;&#x2e;&#x6f;&#x72;&#x67;</a>。</p><p>同时需要在服务器上至少安装如下的软件包：</p><ul><li>maddy</li><li>certbot<ul><li>certbot-dns-cloudflare</li></ul></li><li>nginx（或其他 Web 服务端）</li></ul><p>除 maddy 外，其他的软件包都可以使用 <code>pacman</code> 直接安装。</p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>可以在 GitHub 的 <a href="https://github.com/foxcpp/maddy/releases">Releases</a> 页面获取 maddy 最新版本的源码和预编译程序。也可以参照<a href="https://maddy.email/tutorials/setting-up/#installing-maddy">官方文档</a>的说明，从源码构建、AUR 处获取或 Docker 镜像部署。</p><p><strong>注意</strong>：从 AUR 处获取需要下载体积很大的 golang 编译器。为节约下载并安装编译器的时间，读者可以直接使用 GitHub 的预编译程序。本文也以此为例。</p><p>在服务器终端中执行如下命令，以下载 maddy 的预编译程序：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装 zstd 包，以解压 *.zst 类型的文件</span></span><br><span class="line">sudo pacman -S zstd --needed</span><br><span class="line"><span class="comment"># 下载地址，可以任意选择</span></span><br><span class="line"><span class="built_in">cd</span> ~/Downloads</span><br><span class="line">wget https://github.com/foxcpp/maddy/releases/download/v0.5.4/maddy-0.5.4-x86_64-linux-musl.tar.zst</span><br><span class="line"><span class="comment"># 参考 zsh 的 extract 插件</span></span><br><span class="line">tar --zstd -xvf maddy-0.5.4-x86_64-linux-musl.tar.zst || zstdcat maddy-0.5.4-x86_64-linux-musl.tar.zst | tar xvf -</span><br><span class="line"><span class="built_in">cd</span> maddy-0.5.4-x86_64-linux-musl</span><br><span class="line"><span class="comment"># 复制服务</span></span><br><span class="line">sudo cp systemd/*.service /etc/systemd/system</span><br><span class="line"><span class="comment"># 复制可执行文件</span></span><br><span class="line">sudo cp maddy maddyctl /usr/<span class="built_in">local</span>/bin</span><br><span class="line"><span class="comment"># 复制配置文件</span></span><br><span class="line">sudo mkdir -p /etc/maddy</span><br><span class="line">sudo cp maddy.conf /etc/maddy</span><br><span class="line"><span class="comment"># 复制 man 文件</span></span><br><span class="line">sudo cp man/*.1 /usr/share/man/man1</span><br><span class="line">sudo cp man/*.5 /usr/share/man/man5</span><br></pre></td></tr></table></figure><p>启动服务前，先加载所有新增服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl daemon-reload</span><br></pre></td></tr></table></figure><p>若要开机自启：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl <span class="built_in">enable</span> maddy</span><br></pre></td></tr></table></figure><p>因为 maddy 运行在非 root 用户上，还需要创建一个用户用以运行 maddy 服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo useradd -mrU -s /sbin/nologin -d /var/lib/maddy -c <span class="string">&quot;maddy mail server&quot;</span> maddy</span><br></pre></td></tr></table></figure><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="域名"><a href="#域名" class="headerlink" title="域名"></a>域名</h3><p>使用任何编辑器打开 <code>/etc/maddy/maddy.conf</code>，修改 <code>$(hostname)</code> 和 <code>$(primary_domain)</code> 变量的值为 <code>mx1.example.org</code> 和 <code>example.org</code>。</p><h3 id="TLS-证书"><a href="#TLS-证书" class="headerlink" title="TLS 证书"></a>TLS 证书</h3><h4 id="获取"><a href="#获取" class="headerlink" title="获取"></a>获取</h4><p>Let’s Enccrypt 签发的 TLS 证书可以通过 certbot 获取。根据 <a href="https://eff-certbot.readthedocs.io/en/stable">certbot</a> 和 <a href="https://certbot-dns-cloudflare.readthedocs.io/en/stable/">certbot-dns-cloudflare</a> 的官方文档，首先需要在 Cloudflare 的 API Token <a href="https://dash.cloudflare.com/profile/api-tokens">配置页面</a>新建一个 Token，选择“Edit zone DNS”的模板，在“Zone Resources”选择目标二级域名（本文则是“example.org”）即可。</p><p><strong>注意</strong>：Token 只会显示一次，在配置好证书前，请务必牢记。</p><p>随后，可以在服务器上存储 Token 以方便后续使用。在终端中执行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p ~/.secrets/certbot</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;&lt;TOKEN&gt;&#x27;</span> &gt; ~/.secrets/certbot/cloudflare.ini  <span class="comment"># 替换为获取到的 Token</span></span><br></pre></td></tr></table></figure><p>并设置权限提高安全性：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 600 ~/.secrets/certbot/cloudflare.ini</span><br></pre></td></tr></table></figure><p>再使用 certbot 获取证书：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot certonly --dns-cloudflare --dns-cloudflare-credentials ~/.secrets/certbot/cloudflare.ini -d <span class="string">&#x27;*.example.org&#x27;</span> -d <span class="string">&#x27;example.org&#x27;</span></span><br></pre></td></tr></table></figure><p><strong>注意</strong>：可以选择不为含通配符域名，而是根据后文实际需要指定必要的三级域名签发证书。</p><p>首次获取证书需要填写邮箱等个人信息。签发完毕后则可以通过 <code>sudo certbot certificates</code> 获取证书的详细信息和存储位置。一般存储位置在 <code>/etc/letsencrypt/live/example.org</code>，其中证书文件名为 <code>fullchain.pem</code>，私钥路径为 <code>privkey.pem</code>。</p><h4 id="配置-1"><a href="#配置-1" class="headerlink" title="配置"></a>配置</h4><p>编辑 <code>/etc/maddy/maddy.conf</code>，修改 <code>tls file</code> 一行为</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tls file /etc/letsencrypt/live/$(primary_domain)/fullchain.pem /etc/letsencrypt/live/$(primary_domain)/privkey.pem</span><br></pre></td></tr></table></figure><p><code>/etc/letsencrypt/live</code> 文件夹默认权限为 750，maddy 无法访问，故需要使用 ACL 进行权限控制：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo setfacl -R -m u:maddy:rX /etc/letsencrypt/&#123;live,archive&#125;</span><br></pre></td></tr></table></figure><p>此时可以启动 maddy 服务来测试：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start maddy</span><br></pre></td></tr></table></figure><p>若服务未报错，则可以继续进行配置。</p><h3 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h3><p>进入 Cloudflare 的 DNS 配置页，作出如下所示的配置：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">example.org.   A     10.2.3.4</span><br><span class="line">example.org.   MX    10 mx1.example.org.</span><br><span class="line">mx1.example.org.   A     10.2.3.4</span><br><span class="line">example.org.     TXT   &quot;v=spf1 mx ~all&quot;</span><br><span class="line">mx1.example.org. TXT   &quot;v=spf1 mx ~all&quot;</span><br><span class="line">_dmarc.example.org.   TXT    &quot;v=DMARC1; p=quarantine; ruf=mailto:postmaster@example.org&quot;</span><br><span class="line">_mta-sts.example.org.   TXT    &quot;v=STSv1; id=1&quot;</span><br><span class="line">_smtp._tls.example.org. TXT    &quot;v=TLSRPTv1;rua=mailto:postmaster@example.org&quot;</span><br><span class="line">default._domainkey.example.org.    TXT   &quot;v=DKIM1; k=ed25519; p=nAcUUozPlhc4VPhp7hZl+owES7j7OlEv0laaDEDBAqg=&quot;</span><br></pre></td></tr></table></figure><p>其中最后一条记录的值需要用</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cat /var/lib/maddy/dkim_keys/example.org_default.dns</span><br></pre></td></tr></table></figure><p>的输出替换。若显示文件不存在，请确认 maddy 服务是否曾成功运行过至少一次。</p><h3 id="MTA-STS"><a href="#MTA-STS" class="headerlink" title="MTA-STS"></a>MTA-STS</h3><p>MTA-STS 要求访问 <a href="https://mta-sts.example.org/.well-known/mta-sts.txt">https://mta-sts.example.org/.well-known/mta-sts.txt</a> 时能输出类似如下的文本：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">version: STSv1</span><br><span class="line">mode: enforce</span><br><span class="line">max_age: 604800</span><br><span class="line">mx: mx1.example.org</span><br></pre></td></tr></table></figure><p>对于已经安装 HTTP Echo 模块的 Nginx，直接在 <code>/etc/nginx/nginx.conf</code> 中添加如下条目：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>          <span class="number">443</span> ssl http2;</span><br><span class="line">    <span class="attribute">server_name</span>     mta-sts.example.org;</span><br><span class="line">    <span class="attribute">error_log</span>       /var/log/nginx/log.log;</span><br><span class="line">    <span class="attribute">ssl_certificate</span> /etc/letsencrypt/live/example.org/fullchain.pem;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /etc/letsencrypt/live/example.org/privkey.pem;</span><br><span class="line">    <span class="attribute">ssl_session_timeout</span> <span class="number">5m</span>;</span><br><span class="line">    <span class="attribute">ssl_protocols</span> TLSv1.<span class="number">2</span> TLSv1.<span class="number">3</span>;</span><br><span class="line">    <span class="attribute">ssl_ciphers</span> ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;</span><br><span class="line">    <span class="attribute">ssl_prefer_server_ciphers</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">location</span> /.well-known/mta-sts.txt &#123;</span><br><span class="line">        <span class="attribute">echo</span> <span class="string">&#x27;version: STSv1&#x27;</span>;</span><br><span class="line">        <span class="attribute">echo</span> <span class="string">&#x27;mode: enforce&#x27;</span>;</span><br><span class="line">        <span class="attribute">echo</span> <span class="string">&#x27;max_age: 604800&#x27;</span>;</span><br><span class="line">        <span class="attribute">echo</span> <span class="string">&#x27;mx: mx1.example.org&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对于未安装该模块的 Nginx，先添加如下条目：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>          <span class="number">443</span> ssl http2;</span><br><span class="line">    <span class="attribute">server_name</span>     mta-sts.example.org;</span><br><span class="line">    <span class="attribute">error_log</span>       /var/log/nginx/log.log;</span><br><span class="line">    <span class="attribute">ssl_certificate</span> /etc/letsencrypt/live/example.org/fullchain.pem;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /etc/letsencrypt/live/example.org/privkey.pem;</span><br><span class="line">    <span class="attribute">ssl_session_timeout</span> <span class="number">5m</span>;</span><br><span class="line">    <span class="attribute">ssl_protocols</span> TLSv1.<span class="number">2</span> TLSv1.<span class="number">3</span>;</span><br><span class="line">    <span class="attribute">ssl_ciphers</span> ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;</span><br><span class="line">    <span class="attribute">ssl_prefer_server_ciphers</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">location</span> /.well-known/mta-sts.txt &#123;</span><br><span class="line">        <span class="attribute">root</span> /usr/share/nginx/mta-sts;  <span class="comment"># /usr/share/nginx 是 Nginx 的静态资源默认位置</span></span><br><span class="line">        <span class="attribute">index</span> /mta-sts.txt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>再新建 <code>/usr/share/nginx/mta-sts</code> 文件夹，将指定文本写入 <code>mta-sts.txt</code> 文件中：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo cat &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">version: STSv1</span></span><br><span class="line"><span class="string">mode: enforce</span></span><br><span class="line"><span class="string">max_age: 604800</span></span><br><span class="line"><span class="string">mx: mx1.example.org</span></span><br><span class="line"><span class="string">EOF</span> &gt; /usr/share/nginx/mta-sts/mta-sts.txt</span><br></pre></td></tr></table></figure><p>重启 Nginx 服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart nginx</span><br></pre></td></tr></table></figure><p>检查上述网络路径是否能够正常访问。</p><h3 id="DANE"><a href="#DANE" class="headerlink" title="DANE"></a>DANE</h3><p>设置 TLSA（DANE）需要在 <a href="https://www.huque.com/bin/gen_tlsa">https://www.huque.com/bin/gen_tlsa</a> 生成对应的 DNS 记录。</p><p>进入页面后，在“Enter/paste PEM format X.509 certificate here:”下的文本框中输入<a href="#tls-%E8%AF%81%E4%B9%A6">上文</a>中获取的证书的内容：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cat /etc/letsencrypt/live/example.org/fullchain.pem</span><br></pre></td></tr></table></figure><p><strong>注意</strong>：该证书很长，务必复制完全。</p><p>下方的“Port Number:”填写 <code>25</code>，<code>Transport Protocol:</code> 填写 <code>tcp</code>，<code>Domain Name:</code> 填写 <code>mx1.example.org</code>。再点击“Generate”生成记录。将 DNS 记录写入 Cloudflare 中。</p><h3 id="创建邮件账户"><a href="#创建邮件账户" class="headerlink" title="创建邮件账户"></a>创建邮件账户</h3><p>在服务器终端中：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">maddyctl creds create postmaster@example.org</span><br><span class="line">maddyctl imap-acct create postmaster@example.org</span><br></pre></td></tr></table></figure><p>此时，邮件账户的用户名为“<a href="mailto:&#112;&#x6f;&#115;&#116;&#x6d;&#x61;&#x73;&#x74;&#x65;&#114;&#x40;&#x65;&#x78;&#97;&#x6d;&#112;&#108;&#101;&#46;&#111;&#x72;&#x67;">&#112;&#x6f;&#115;&#116;&#x6d;&#x61;&#x73;&#x74;&#x65;&#114;&#x40;&#x65;&#x78;&#97;&#x6d;&#112;&#108;&#101;&#46;&#111;&#x72;&#x67;</a>”，密码则在创建账户时要求设置。该账户已经可以在邮件客户端（如 Thunderbird 和 Outlook）中配置并使用。</p><h3 id="（可选）开启-DNSSEC-认证"><a href="#（可选）开启-DNSSEC-认证" class="headerlink" title="（可选）开启 DNSSEC 认证"></a>（可选）开启 DNSSEC 认证</h3><p><a href="https://en.wikipedia.org/wiki/Domain_Name_System_Security_Extensions">DNSSEC</a>（Domain Name System Security Extensions），即<a href="https://zh.wikipedia.org/zh-cn/%E5%9F%9F%E5%90%8D%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E6%89%A9%E5%B1%95">域名系统安全扩展</a>，对DNS提供给DNS客户端（解析器）的DNS数据来源进行认证，并验证不存在性和校验数据完整性验证。</p><p><a href="https://wiki.archlinux.org/title/DNSSEC">Arch Wiki</a> 中给出了一些验证方法。安装 <code>ldns</code> 包后：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ drill -DT example.org  <span class="comment"># 替换为二级域名</span></span><br><span class="line"><span class="comment"># 省略多行</span></span><br><span class="line">[T] example.org. 60      IN      A       10.2.3.4</span><br><span class="line">;;[S] self sig OK; [B] bogus; [T] trusted</span><br></pre></td></tr></table></figure><p>如果命令执行结果如上所示（域名前的 flag 值为“T”），则说明 DNSSEC 认证已开启；反之，请参考 <a href="https://wiki.archlinux.org/title/DNSSEC#Install_a_DNSSEC-validating_resolver">Install a DNSSEC-validating resolver</a> 章节，或参考 DNS 服务商的文档。</p><p>以下简单介绍 Cloudflare 为域名开启 DNSSEC 的方法：进入 Cloudflare <a href="https://dash.cloudflare.com/">控制台</a>后，进入目标域名的详情页面，点击左侧的“DNS”选项卡，在页面尾部的“DNSSEC”部分点击“Enable DNSSEC”。随后 Cloudflare 将给出域名的 DS Record。再进入<strong>域名注册商</strong>的域名管理页面设置 DS Record。具体设置方法参照 Cloudflare 的<a href="https://developers.cloudflare.com/dns/additional-options/dnssec#step-2--add-ds-record-to-your-registrar">官方文档</a>。</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/foxcpp/maddy&quot;&gt;maddy&lt;/a&gt; 是一个开源的轻量级“可组合”（composable）多合一邮件服务器，支持通过 IMAP/SMTP 等协议和 DKIM、SPF、DMARC、DANE、MTA-STS 等安全模式收发邮件。本文将以&lt;a href=&quot;https://maddy.email/tutorials/setting-up/&quot;&gt;官方文档&lt;/a&gt;为主线，整理 maddy 服务器配置流程。&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Essay" scheme="https://blog.tamako.work/categories/Essay/"/>
    
    
    <category term="Arch Linux" scheme="https://blog.tamako.work/tags/Arch-Linux/"/>
    
    <category term="maddy" scheme="https://blog.tamako.work/tags/maddy/"/>
    
    <category term="Email" scheme="https://blog.tamako.work/tags/Email/"/>
    
  </entry>
  
  <entry>
    <title>【Arch Linux】misskey 手动部署和配置</title>
    <link href="https://blog.tamako.work/techdev/arch/misskey/"/>
    <id>https://blog.tamako.work/techdev/arch/misskey/</id>
    <published>2022-04-29T12:45:20.000Z</published>
    <updated>2022-07-13T12:03:22.000Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://misskey-hub.net/en/">misskey</a> 是一款开源的“跨星际”（interplanetary）社交平台，以微博为主要形式，界面美观，内含元素丰富。本文即针对该平台在 Arch Linux 的手动安装方式作说明。</p><span id="more"></span><blockquote><p>笔者：为什么不用 docker 安装（这是官方认定 recommended 的安装方式）？只是不怎么想用 docker（</p></blockquote><blockquote><p><strong>注意</strong>：基于 Arch Linux 发行版的特殊性（非开箱即用），笔者会<strong>尽可能多</strong>地补充安装过程，<strong>尽可能</strong>让读者能从头到尾依照本文操作。但若存在疏漏，敬请谅解。</p></blockquote><h2 id="检查系统配置"><a href="#检查系统配置" class="headerlink" title="检查系统配置"></a>检查系统配置</h2><p>misskey 对服务端的性能配置要求较高，建议配置至少 2 核 CPU 和 4GB RAM。笔者使用的服务器部分配置如下（多人共有，但对 misskey 来说也已足够）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ neofetch</span><br><span class="line"><span class="comment"># 省略部分输出</span></span><br><span class="line">OS: Arch Linux x86_64</span><br><span class="line">Kernel: 5.15.34-1-lts</span><br><span class="line">CPU: AMD EPYC 7282 (4) @ 2.794GHz</span><br><span class="line">Memory: 1590MiB / 7950MiB</span><br></pre></td></tr></table></figure><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><h4 id="系统"><a href="#系统" class="headerlink" title="系统"></a>系统</h4><p>安装所有依赖（这里假设读者已经安装了 <code>sudo</code> 并配置好相关权限）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -Syu  <span class="comment"># 更新系统</span></span><br><span class="line">sudo pacman -S sudo visudo nano base-devel python --needed</span><br><span class="line">sudo python -m ensurepip --upgrade  <span class="comment"># 安装/升级 pip</span></span><br><span class="line">sudo ln -sf /usr/bin/&#123;nano,vi&#125;</span><br><span class="line">sudo visudo</span><br></pre></td></tr></table></figure><p>在打开的编辑器 <code>nano</code> 中去除 <code>#%wheel ALL=(ALL:ALL) ALL</code> 一行前的注释，依次按 <code>Ctrl+X</code>、<code>y</code>、<code>Enter</code> 保存。</p><p>同时考虑到 pip 用户配置下 <code>$PATH</code> 环境变量问题，使用编辑器打开当前终端配置（例如 <code>~/.bashrc</code>），添加如下行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PATH=~/.<span class="built_in">local</span>/bin:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure><h4 id="misskey"><a href="#misskey" class="headerlink" title="misskey"></a>misskey</h4><p>官方文档中给出的 misskey 需要的依赖有：</p><ul><li>Node.JS（16.x）</li><li>PostgreSQL（建议 12.x 或 13.x）</li><li>Redis</li><li>yarn（可选，若不安装，后续安装过程中 <code>yarn</code> 应替换为 <code>npx yarn</code>）</li><li>FFmpeg</li></ul><p>考虑到大部分软件的向后兼容性，可以直接安装所有依赖：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S nodejs npm postgresql redis yarn ffmpeg --needed</span><br></pre></td></tr></table></figure><h3 id="用户"><a href="#用户" class="headerlink" title="用户"></a>用户</h3><p>因笔者服务器环境中存在多用户、多管理情况，此处的操作与官方文档不同——创建了一个有 <code>sudo</code> 权限、可登录、有家目录的用户。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useradd -m -G wheel -s /bin/bash misskey</span><br></pre></td></tr></table></figure><p>并使用 <code>sudo passwd misskey</code> 设置登录密码。</p><p>若依照官方文档，仅需：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useradd -r -s /usr/bin/nologin misskey</span><br></pre></td></tr></table></figure><p>之后切换入该用户继续操作：<code>su - misskey</code>。</p><h3 id="下载源码"><a href="#下载源码" class="headerlink" title="下载源码"></a>下载源码</h3><p>根据上文中用户创建方式，目录的路径可能不能完全如文中所述。请读者根据自身情况合理选择安装路径。</p><p>在终端中执行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir .opt</span><br><span class="line"><span class="built_in">cd</span> .opt</span><br><span class="line">git <span class="built_in">clone</span> --recursive https://github.com/misskey-dev/misskey.git</span><br><span class="line"><span class="built_in">cd</span> misskey</span><br><span class="line">git checkout master</span><br></pre></td></tr></table></figure><p><strong>注意</strong>：截至本文编写时，misskey 源码库克隆大小 88.22MB，子库（misskey-assets）克隆大小 69.76MB。请自行选择是否“科学上网”或使用镜像站。</p><h3 id="安装依赖库"><a href="#安装依赖库" class="headerlink" title="安装依赖库"></a>安装依赖库</h3><p>在终端中执行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn</span><br></pre></td></tr></table></figure><p><strong>注意</strong>：请自行选择是否“科学上网”或使用镜像站。</p><p><strong>注意</strong>：该过程耗时较长。若无人值守，建议使用 <code>tmux</code> 或 <code>screen</code> 防止 ssh 连接中断导致安装过程中断。</p><h3 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h3><p>在终端中执行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NODE_ENV=production yarn build</span><br></pre></td></tr></table></figure><p><strong>注意</strong>：该过程耗时较长。若无人值守，建议使用 <code>tmux</code> 或 <code>screen</code> 防止 ssh 连接中断导致安装过程中断。</p><h3 id="初始化数据库"><a href="#初始化数据库" class="headerlink" title="初始化数据库"></a>初始化数据库</h3><h4 id="Postgresql"><a href="#Postgresql" class="headerlink" title="Postgresql"></a>Postgresql</h4><p>在终端中执行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sudo -iu postgres  <span class="comment"># 切换到 postgres 用户</span></span><br><span class="line">initdb -D /var/lib/postgres/data</span><br><span class="line"><span class="comment"># （可选）修改 locale 和编码：</span></span><br><span class="line"><span class="comment"># initdb --locale=en_US.UTF-8 --encoding=UTF8 -D /var/lib/postgres/data</span></span><br><span class="line"><span class="built_in">exit</span>  <span class="comment"># 返回 misskey 用户</span></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> postgresql --now</span><br><span class="line">sudo systemctl status postgresql  <span class="comment"># 查看服务状态</span></span><br><span class="line"><span class="comment"># （可选）添加 SQL 操作历史文件</span></span><br><span class="line">sudo touch /var/lib/postgres/.psql_history</span><br><span class="line">sudo chown postgres:postgres /var/lib/postgres/.psql_history</span><br><span class="line">sudo -u postgres psql</span><br></pre></td></tr></table></figure><p>进入 Postgresql 操作界面，执行：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> database misskey;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> misskey <span class="keyword">with</span> encrypted password <span class="string">&#x27;&#123;YOUR_PASSWORD&#125;&#x27;</span>;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> privileges <span class="keyword">on</span> database misskey <span class="keyword">to</span> misskey;</span><br><span class="line">\q</span><br></pre></td></tr></table></figure><p>其中上面的 <code>&#39;&#123;YOUR_PASSWORD&#125;&#39;</code> 可以任意配置，但需要和后面的 misskey 配置文件保持一致。</p><h4 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h4><p>在终端中执行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl <span class="built_in">enable</span> redis --now</span><br><span class="line">sudo systemctl status redis  <span class="comment"># 查看服务状态</span></span><br></pre></td></tr></table></figure><h3 id="前置配置"><a href="#前置配置" class="headerlink" title="前置配置"></a>前置配置</h3><p>从 <code>.config</code> 文件夹中复制 <code>example.yml</code> 到 <code>default.yml</code>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp .config/&#123;example,default&#125;.yml</span><br></pre></td></tr></table></figure><p>然后使用编辑器编辑后者，例如 <code>nano .config/default.yml</code>。其中最重要的配置（不修改就会直接导致 misskey 跑不通）是：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#   ┌──────────────────────────┐</span></span><br><span class="line"><span class="comment">#───┘ PostgreSQL configuration └────────────────────────────────</span></span><br><span class="line"></span><br><span class="line"><span class="attr">db:</span></span><br><span class="line">  <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">5432</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Database name</span></span><br><span class="line">  <span class="attr">db:</span> <span class="string">misskey</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Auth</span></span><br><span class="line">  <span class="attr">user:</span> <span class="string">example-misskey-user</span></span><br><span class="line">  <span class="attr">pass:</span> <span class="string">example-misskey-pass</span></span><br></pre></td></tr></table></figure><p>将其中的 <code>user</code> 配置项改为 <code>user: misskey</code>，<code>pass</code> 配置项根据上面的配置保持一致。</p><h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><p>在终端中执行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yarn run init</span><br><span class="line">NODE_ENV=production npm start</span><br></pre></td></tr></table></figure><p>若在终端中看到类似如下的输出：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">INFO *  [core boot]     Welcome to Misskey!</span><br><span class="line">INFO *  [core boot]     Misskey v12.110.1</span><br><span class="line">INFO *  [core boot env] NODE_ENV: production</span><br><span class="line">INFO *  [core boot env] You do not have root privileges</span><br><span class="line">INFO *  [core boot nodejs]      Version v17.9.0 detected.</span><br><span class="line">DONE *  [core boot config]      Loaded</span><br><span class="line">INFO *  [core boot db]  Connecting...</span><br><span class="line">DONE *  [core boot db]  Connected: v14.2</span><br><span class="line">DONE *  [core boot]     Misskey initialized</span><br><span class="line">INFO *  [core boot]     Starting 1 worker...</span><br><span class="line">(node:324552) ExperimentalWarning: Importing JSON modules is an experimental feature. This feature could change at any time</span><br><span class="line">(Use `node --trace-warnings ...` to show where the warning was created)</span><br><span class="line">DONE *  [core boot]     All workers started</span><br><span class="line">DONE *  [core boot]     Now listening on port 3000 on https://example.tld</span><br></pre></td></tr></table></figure><p>则表示 misskey 部署成功。</p><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="systemd-服务"><a href="#systemd-服务" class="headerlink" title="systemd 服务"></a>systemd 服务</h3><p>可以配置 systemd 服务让其管理 misskey 的运行。新建 <code>/etc/systemd/system/misskey.service</code>，在编辑器中打开并填入如下内容：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=Misskey daemon</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">Type</span>=simple</span><br><span class="line"><span class="attr">User</span>=misskey</span><br><span class="line"><span class="attr">ExecStart</span>=/usr/bin/npm start</span><br><span class="line"><span class="attr">WorkingDirectory</span>=/home/misskey/.opt/misskey</span><br><span class="line"><span class="attr">Environment</span>=<span class="string">&quot;NODE_ENV=production&quot;</span></span><br><span class="line"><span class="attr">TimeoutSec</span>=<span class="number">60</span></span><br><span class="line"><span class="attr">StandardOutput</span>=syslog</span><br><span class="line"><span class="attr">StandardError</span>=syslog</span><br><span class="line"><span class="attr">SyslogIdentifier</span>=misskey</span><br><span class="line"><span class="attr">Restart</span>=always</span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target</span><br></pre></td></tr></table></figure><p>然后分别通过 <code>sudo systemctl start misskey</code> 和 <code>sudo systemctl enable misskey</code> 启动 misskey 并添加开机自启。</p><h3 id="端口转发（反向代理）和-TLS"><a href="#端口转发（反向代理）和-TLS" class="headerlink" title="端口转发（反向代理）和 TLS"></a>端口转发（反向代理）和 TLS</h3><p>misskey 支持 HTTPS/SSL/TLS 。这需要配置相关证书，并设置端口转发（反向代理）。笔者使用的软件包是 nginx，并已在 Cloudflare 添加一个域名。</p><p><strong>注意</strong>：部分免费二级域名（如 .cf、.tk）无法使用后文中提及的 Cloudflare API 自动更新 DNS 记录。请读者自行选用其他域名，或使用其他 DNS 服务。</p><h4 id="证书"><a href="#证书" class="headerlink" title="证书"></a>证书</h4><p>首先安装自动签发 Let’s Encrypt 证书的软件包 certbot：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m pip install certbot certbot-cloudflare-dns</span><br></pre></td></tr></table></figure><p>为防止证书信息泄露（certbot 默认工作和日志目录均在 <code>/etc</code>、<code>/var</code> 等文件夹中），先创建相关文件夹：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 工作目录、日志目录、配置目录（存放证书）</span></span><br><span class="line">mkdir -p ~/.var/letsencrypt ~/.logs/letsencrypt ~/.etc/letsencrypt</span><br></pre></td></tr></table></figure><p>再写入 Cloudflare API 的相关配置文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p ~/.secrets/certbot</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;dns_cloudflare_api_token = &#123;API_TOKEN&#125;&#x27;</span> &gt; ~/.secrets/certbot/cloudflare.ini</span><br></pre></td></tr></table></figure><p>其中 <code>&#123;API_TOKEN&#125;</code> 表示 Cloudflare 账户的 API token。请参见 Cloudflare 和 Certbot 相关文档配置。</p><p>为保证安全性，建议为其重新配置权限：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod -R 700 ~/.secrets</span><br><span class="line">chmod -R 600 ~/.secrets/certbot/cloudflare.ini</span><br></pre></td></tr></table></figure><p>最后，在终端中执行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 此处使用 Cloudflare API 更新 DNS</span></span><br><span class="line">certbot certonly --dns-cloudflare --dns-cloudflare-credentials ~/.secrets/certbot/cloudflare.ini -d <span class="string">&#x27;&#123;domain&#125;&#x27;</span> --config-dir ~/.etc/letsencrypt --work-dir ~/.var/letsencrypt --logs-dir ~/.logs/letsencrypt</span><br></pre></td></tr></table></figure><p>其中 <code>&#39;&#123;domain&#125;&#39;</code> 是为 misskey 分配的域名。certbot 运行过程中需要同意相关服务条款并输入邮箱注册。</p><h4 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h4><p>在 DNS 服务商（如 Cloudflare）中添加一条 A/AAAA 记录，从域名指向服务器的 IP 地址。</p><h4 id="端口转发（反向代理）"><a href="#端口转发（反向代理）" class="headerlink" title="端口转发（反向代理）"></a>端口转发（反向代理）</h4><p>在终端中执行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S nginx-mainline --needed</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> nginx --now</span><br></pre></td></tr></table></figure><p>再打开 <code>/etc/nginx/nginx.conf</code>，添加如下类似的配置项：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">443</span> ssl http2;</span><br><span class="line">    <span class="attribute">server_name</span>  <span class="string">&#x27;&#123;domain&#125;&#x27;</span>;</span><br><span class="line">    <span class="attribute">error_log</span>    /var/log/nginx/log.log;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">ssl_certificate</span> /home/misskey/.etc/letsencrypt/live/<span class="string">&#x27;&#123;domain&#125;&#x27;</span>/fullchain.pem;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /home/misskey/.etc/letsencrypt/live/<span class="string">&#x27;&#123;domain&#125;&#x27;</span>/privkey.pem;</span><br><span class="line">    <span class="attribute">ssl_session_timeout</span> <span class="number">5m</span>;</span><br><span class="line">    <span class="attribute">ssl_protocols</span> TLSv1.<span class="number">2</span> TLSv1.<span class="number">3</span>;</span><br><span class="line">    <span class="attribute">ssl_ciphers</span> ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;</span><br><span class="line">    <span class="attribute">ssl_prefer_server_ciphers</span> <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://localhost:3000;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP $remote_addr;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host $http_host;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Referer http://$host;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中 <code>&#39;&#123;domain&#125;&#39;</code> 表示分配的域名。证书路径以实际情况为准。</p><p>最后重启 nginx 服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart nginx</span><br></pre></td></tr></table></figure><h4 id="misskey-1"><a href="#misskey-1" class="headerlink" title="misskey"></a>misskey</h4><p>打开 misskey 配置文件 <code>~/.opt/misskey/.config/default.yml</code>，修改如下配置项：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#   ┌─────┐</span></span><br><span class="line"><span class="comment">#───┘ URL └─────────────────────────────────────────────────────</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Final accessible URL seen by a user.</span></span><br><span class="line"><span class="attr">url:</span> <span class="string">&#x27;&#123;domain&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>设置为先前分配的域名。</p><p>最后重启 misskey 服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart misskey</span><br></pre></td></tr></table></figure><h2 id="特别致谢"><a href="#特别致谢" class="headerlink" title="特别致谢"></a>特别致谢</h2><p>感谢一位朋友“梦可味”在撰写本文前提供的在 Ubuntu 发行版中安装 misskey 的教程，其上有对多处踩坑的详细记录，让笔者能更快速地完成安装。之后会发布 misskey 在 Ubuntu 下的安装及配置教程。</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="https://misskey-hub.net/en/docs/install/manual.html">misskey 官方文档</a></li><li><a href="https://www.garron.me/en/bits/build-essential-arch-linux.html">build-essential in Arch Linux</a></li><li><a href="https://wiki.archlinux.org/title/Users_and_groups">Users and groups - ArchWiki</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://misskey-hub.net/en/&quot;&gt;misskey&lt;/a&gt; 是一款开源的“跨星际”（interplanetary）社交平台，以微博为主要形式，界面美观，内含元素丰富。本文即针对该平台在 Arch Linux 的手动安装方式作说明。&lt;/p&gt;</summary>
    
    
    
    <category term="Essay" scheme="https://blog.tamako.work/categories/Essay/"/>
    
    
    <category term="Arch Linux" scheme="https://blog.tamako.work/tags/Arch-Linux/"/>
    
    <category term="misskey" scheme="https://blog.tamako.work/tags/misskey/"/>
    
  </entry>
  
  <entry>
    <title>Arch Linux 物理机安装大体思路和部分实现细节（MBR &amp; GPT）</title>
    <link href="https://blog.tamako.work/techdev/arch/installation/"/>
    <id>https://blog.tamako.work/techdev/arch/installation/</id>
    <published>2022-04-28T12:18:05.000Z</published>
    <updated>2022-07-13T14:36:50.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>作为<a href="https://wiki.archlinux.org/title/Installation_guide">官方文档</a>的补充，大致提供一些安装 Arch Linux 到物理机上并安装桌面环境的思路和文档中未提及的细节。</p><span id="more"></span><h2 id="设备"><a href="#设备" class="headerlink" title="设备"></a>设备</h2><p>本文的主要篇幅将建立在如下几个设备之上：</p><ul><li>主力机<ul><li>操作系统：Manjaro x86_64</li><li>用途：下载并烧录镜像、为目标机器提供网络服务、<em>远程操作</em>、应急使用等</li></ul></li><li>目标机器<ul><li>操作系统：Windows 7 Utimate x86_64</li><li>磁盘数量：1</li><li>磁盘记录类型：MBR</li><li>启动类型：BIOS</li><li>目标：与 Windows 并存安装 Arch Linux</li></ul></li><li>U 盘<ul><li>总容量：8 GB</li><li>用途：烧录 Arch Linux 镜像</li></ul></li></ul><p>在文末，会对磁盘记录类型为 GPT、启动类型为 UEFI 的设备的安装过程，及图形界面其他的安装方案作一些说明。</p><p><strong>注意</strong>：强烈建议为主力机增添显示器、键盘等外设（对笔记本电脑等已有的除外），并在完全配置好网络环境前使用有线网络，防止因安装过程出现问题导致无法联网时难以检修。</p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="分区"><a href="#分区" class="headerlink" title="分区"></a>分区</h3><p>建议在安装 Arch Linux 前分区，或是分出空闲空间，避免因不熟悉命令行环境或参数不直观导致数据丢失。笔者选择后者。</p><p>对于主力机是 Linux 的读者，可以使用 <code>gparted</code> 工具进行分区；对于 Windows 读者，可以使用 Disk Genius 工具进行分区。<strong>需要注意的是</strong>，gparted 底层使用 <code>parted</code> 命令行工具，而该工具在调整分区时无法调整分区头部位置。因此，对于有多启动需求的读者，建议在 Windows 下使用 Disk Genius 工具分区。若主力机上无 Windows 分区，可以在其他可移动介质中安装用于维护的 Windows PE 系统。</p><p>笔者的设备已有 BIOS/MBR 类型的 Windows 存在，安装时更加方便。对于大部分使用 UEFI/GPT 类型的读者，请参照<a href="https://wiki.archlinux.org/title/Arch_boot_process#Boot_loader">官方文档</a>。两种类型的设备的安装过程没有太大差异，且互联网上已有诸多相关的资料供读者参考。但若在安装后出现无法加载 Linux 或其它系统的情况（尤其是 UEFI/GPT 类型），排除软件原因后，考虑升级主板或更换相关硬件。</p><p>笔者的分区方案是：</p><table><thead><tr><th align="center">分区</th><th align="center">文件类型</th><th align="center">大小</th><th align="center">格式化</th><th align="center">启动项</th><th align="center">挂载点</th><th align="center"><strong>安装镜像环境</strong>中的挂载点</th></tr></thead><tbody><tr><td align="center"><code>/dev/sda1</code></td><td align="center">HPFS/NTFS/exFAT</td><td align="center">65GB</td><td align="center">否</td><td align="center">是</td><td align="center"></td><td align="center"></td></tr><tr><td align="center"><code>/dev/sda2</code></td><td align="center">HPFS/NTFS/exFAT</td><td align="center">312.8GB</td><td align="center">否</td><td align="center">否</td><td align="center"></td><td align="center"></td></tr><tr><td align="center"><code>/dev/sda3</code></td><td align="center">Linux swap / Solaris</td><td align="center">8GB</td><td align="center">是</td><td align="center">否</td><td align="center">[SWAP]</td><td align="center"></td></tr><tr><td align="center"><code>/dev/sda4</code></td><td align="center">Linux</td><td align="center">80GB</td><td align="center">是</td><td align="center">否</td><td align="center"><code>/</code></td><td align="center"><code>/mnt</code></td></tr></tbody></table><p>其中，“挂载点”表示该分区在<strong>安装后</strong>操作系统中的路径，“<strong>安装镜像环境</strong>中的挂载点”表示该分区在<strong>当前环境</strong>（安装镜像环境）中的路径。</p><h3 id="烧录镜像"><a href="#烧录镜像" class="headerlink" title="烧录镜像"></a>烧录镜像</h3><p>终端执行 <code>sudo fdisk -l</code> 记录需要写入镜像的 U 盘的设备路径。根据<a href="https://wiki.archlinux.org/title/USB_flash_installation_medium#Using_basic_command_line_utilities">官方文档</a>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dd bs=4M <span class="keyword">if</span>=/path/to/archlinux-version-x86_64.iso of=/dev/sdx conv=fsync oflag=direct status=progress</span><br></pre></td></tr></table></figure><p>注意写入后 U 盘的卷标应形如 <code>ARCH_YYYYDD</code>，其中 <code>YYYY</code> 和 <code>DD</code> 表示镜像版本号中的年份和月份。若不是，建议手动更改。</p><h3 id="U-盘启动"><a href="#U-盘启动" class="headerlink" title="U 盘启动"></a>U 盘启动</h3><p>U 盘启动成功后进入镜像内置的简易操作系统。与其他发行版镜像稍有不同的是，Arch Linux 镜像默认终端为 <code>zsh</code>，且相比于用户实装的 Arch Linux 内置有更多有利于系统安装和调试的工具。</p><p>正常启动后，屏幕显示的应该类似于：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">To install Arch Linux follow the installation guide:</span><br><span class="line">https://wiki.archlinux.org/title/Installation_guide</span><br><span class="line"></span><br><span class="line">For Wi-Fi, authenticate to the wireless network using the iwctl utility.</span><br><span class="line">For mobile broadband (WWAN) modems, connect with the mmcli utility.</span><br><span class="line">Ethernet, WLAN and WWAN interfaces using DHCP should work automatically.</span><br><span class="line"></span><br><span class="line">After connecting to the internet, the installation guide can be accessed</span><br><span class="line">via the convenience script Installation_guide.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Last login: Mon Apr 25 18:11:37 2022 from 10.42.0.1</span><br><span class="line">root@archiso ~ #</span><br></pre></td></tr></table></figure><p>并且文字有多种颜色（上方有一行全是空格，在屏幕上实则是不同颜色的色块（经常用于做终端颜色测试））。</p><p>而读者若发现屏幕上显示的类似于：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">:: Mounting &#x27;/dev/disk/by-label/ARCH_202204&#x27; to &#x27;/run/archiso/bootmnt&#x27;</span><br><span class="line">Waiting 30 seconds for device /dev/disk/by-label/ARCH_202204 ...</span><br><span class="line">ERROR: &#x27;/dev/disk/by-label/ARCH_202204&#x27; device did not show up after 30 seconds...</span><br><span class="line">   Falling back to interactive prompt</span><br><span class="line">   You can try to fix the problem manually, log out when you are finished</span><br><span class="line">sh: can&#x27;t access tty: job control turned off</span><br><span class="line">[rootfs ]#</span><br></pre></td></tr></table></figure><p>说明 Arch Linux 安装镜像未找到设备（也就是 U 盘）。出现这种情况，一种原因是如上所述的未修改 U 盘的卷标。而另一种可能的原因则出在硬件上。先在终端上执行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls /dev/disk/by-label</span><br></pre></td></tr></table></figure><p>出现的条目中，若有类似 U 盘卷标的，尝试挂载：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir /mnt</span><br><span class="line">mount /dev/disk/by-label/&lt;卷标&gt; /mnt</span><br></pre></td></tr></table></figure><p>若发现无法挂载，或挂载成功后发现其并非 U 盘的，则说明可能出现了上述硬件问题。此时尝试重新插拔 U 盘，再执行 <code>ls /dev/disk/by-label</code>。若发现形如“ARCH_YYYYDD”的条目出现，则执行 <code>exit</code> 开始安装系统。</p><p>另外，有必要检测 U 盘启动时的“启动模式”。执行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls /sys/firmware/efi/efivars</span><br></pre></td></tr></table></figure><p>若没有输出，则表示 U 盘在 BIOS 模式启动；反之，则为 UEFI 模式。若启动模式与预计不符，请考虑修改 BIOS 相关的设置。</p><h3 id="远程登入"><a href="#远程登入" class="headerlink" title="远程登入"></a>远程登入</h3><p>上文中笔者提到了“<em>远程操作</em>”。Arch Linux 安装镜像中内置 <code>ssh</code>，可以使用 ssh 远程登入进行安装。需要注意的是，笔者远程登入目标机器是为了方便截取终端上的文字，而考虑到 ssh 连接中断可能导致中断安装进程，<strong>不建议</strong>这么做。若确实需要，在终端中执行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure><p>在文本编辑器中找到：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># To disable tunneled clear text passwords, change to no here!</span><br><span class="line">#PasswordAuthentication yes</span><br><span class="line">#PermitEmptyPasswords no</span><br></pre></td></tr></table></figure><p>将其修改为：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># To disable tunneled clear text passwords, change to no here!</span><br><span class="line">PasswordAuthentication yes</span><br><span class="line">PermitEmptyPasswords yes</span><br></pre></td></tr></table></figure><p>按 <code>Ctrl+X</code>，再按 <code>y</code> 保存文件，执行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart sshd</span><br></pre></td></tr></table></figure><p>重启 ssh 服务后，尝试登入。</p><h3 id="其他配置"><a href="#其他配置" class="headerlink" title="其他配置"></a>其他配置</h3><p>本节对应<a href="https://wiki.archlinux.org/title/Installation_guide">官方文档</a>中“<a href="https://wiki.archlinux.org/title/Installation_guide#Boot_the_live_environment">Boot the live environment</a>”小节到“<a href="https://wiki.archlinux.org/title/Installation_guide#Reboot">Reboot</a>”小节。大多数情况下只需要根据目标机器的环境修改少数参数就可以直接执行上面的代码。</p><h4 id="网络服务"><a href="#网络服务" class="headerlink" title="网络服务"></a>网络服务</h4><p>正如官方文档中提到的那样，安装镜像中的系统与用户实际使用的系统并不完全相同，在前者环境中能够正常运作的机能可能在后者环境中便会失灵。“<a href="https://wiki.archlinux.org/title/Installation_guide#Install_essential_packages">Install essential packages</a>”小节中也提到了一些可选的在安装系统时即配置的软件包，不过其中最重要的是网络服务相关的包。若不能保证离开安装镜像环境后 Arch Linux 的网络通信正常，读者可以自行安装相关的包，必要时可提前配置。</p><p>另外，对命令行环境不熟悉或读写配置文件不顺畅的读者，可以安装 <code>nmtui</code>，用以在交互式环境下管理网络服务。笔者选择的包为：<code>net-tools</code>、<code>iproute2</code>、<code>dhcpcd</code>、<code>traceroute</code>、<code>networkmanager</code>（<code>nmtui</code> 被包含在该包中）。</p><h4 id="文本编辑器"><a href="#文本编辑器" class="headerlink" title="文本编辑器"></a>文本编辑器</h4><p>后续的安装操作需要读写配置文件，因此建议安装 <code>vim</code> 或 <code>nano</code> 等文本编辑相关的包。</p><h4 id="Boot-loader"><a href="#Boot-loader" class="headerlink" title="Boot loader"></a>Boot loader</h4><p>这需要读者仔细阅读官方文档（如 <a href="https://wiki.archlinux.org/title/GRUB">GRUB</a>）的<strong>全文</strong>。绝大多数可能的情况在文档中都有描述。对于笔者的设备，笔者使用 GRUB 做了如下操作，以保证 NTFS 分区下的 Windows 能被 GRUB 识别（假定已经 <code>arch-chroot</code> 进入系统）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pacman -S os-prober grub ntfs-3g</span><br><span class="line">grub-install --target=i386-pc /dev/sda</span><br><span class="line"><span class="comment"># 修改 `/etc/default/grub`，将 `#GRUB_DISABLE_OS_PROBER=false` 一行的注释去除</span></span><br><span class="line">grub-mkconfig -o /boot/grub/grub.cfg</span><br></pre></td></tr></table></figure><p>确认无误后，执行后续安装步骤。</p><h2 id="安装后"><a href="#安装后" class="headerlink" title="安装后"></a>安装后</h2><p>读者可以在<a href="https://wiki.archlinux.org/title/General_recommendations">官方文档</a>中阅读有关安装后推荐的行动。</p><h3 id="桌面环境"><a href="#桌面环境" class="headerlink" title="桌面环境"></a>桌面环境</h3><p>笔者选择的桌面环境是：</p><ul><li>显示服务器：<a href="https://wiki.archlinux.org/title/Xorg">Xorg</a>（优先安装）</li><li>显示管理器：<a href="https://wiki.archlinux.org/title/SDDM">SDDM</a></li><li>桌面环境：<a href="https://wiki.archlinux.org/title/KDE">KDE</a></li></ul><p>这些在 Arch Linux Wiki 上都有同名词条，且描述得十分详细。这里不作赘述。即便在安装桌面环境后未能正常显示桌面，也可以使用其他 TTY 在终端下操作。</p><p>对于其中涉及的安装包，笔者不建议安装元包（包名含“-meta”）。这是考虑到：</p><ul><li>一般安装桌面环境所需的包后，无彻底卸载的需求；</li><li>应用程序相关的组件中若有想卸载的，由于这些组件都是元包的依赖项，此时无法完成卸载。</li></ul><p>若不慎安装元包，也可以在 Live CD 环境中卸载元包后重新安装组包（包名不含“-meta”，安装时需要选择组别）。结束后执行 <code>pacman -Qsq &lt;包名&gt;</code> 验证。</p><h4 id="多用户登录界面"><a href="#多用户登录界面" class="headerlink" title="多用户登录界面"></a>多用户登录界面</h4><p>如果读者需要在开机时启动桌面环境，<a href="https://wiki.archlinux.org/title/Xinit#Autostart_X_at_login">官方文档</a>给出了一种方案。但直接按照文档配置，会发现启动计算机后仍然停留在 TTY1 的终端登录页面，输入用户名后跳过输入密码阶段直接进入桌面环境。这显然不是我们所期待的。修复这个问题很简单，只需要将所给的配置项</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$&#123;DISPLAY&#125;</span>&quot;</span> ] &amp;&amp; [ <span class="string">&quot;<span class="variable">$&#123;XDG_VTNR&#125;</span>&quot;</span> -eq 1 ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">exec</span> startx</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>放置在系统配置文件 <code>/etc/profile</code> 中即可。</p><h3 id="本地化"><a href="#本地化" class="headerlink" title="本地化"></a>本地化</h3><p>参见<a href="/techdev/arch/localization-simplified-chinese">《【Arch Linux】本地化：简体中文》</a>和<a href="/techdev/arch/localization-japanese">《【Arch Linux】本地化：日语》</a>。</p><h2 id="UEFI-和-GPT"><a href="#UEFI-和-GPT" class="headerlink" title="UEFI 和 GPT"></a>UEFI 和 GPT</h2><p>以下所列同样仅是笔者机器的情况。请读者根据遇到的情况自行判断。</p><h3 id="分区-1"><a href="#分区-1" class="headerlink" title="分区"></a>分区</h3><p>根据笔者机器情况，笔者设计的分区方案如下：</p><table><thead><tr><th align="center">分区</th><th align="center">文件类型</th><th align="center">启动项</th><th align="center">挂载点</th><th align="center"><strong>安装镜像环境</strong>中的挂载点</th></tr></thead><tbody><tr><td align="center"><code>/dev/sda1</code></td><td align="center">Linux</td><td align="center">是</td><td align="center"><code>/boot</code></td><td align="center"><code>/mnt/boot</code></td></tr><tr><td align="center"><code>/dev/sda5</code></td><td align="center">Linux</td><td align="center">否</td><td align="center"><code>/</code></td><td align="center"><code>/mnt</code></td></tr><tr><td align="center"><code>/dev/sdb4</code></td><td align="center">Linux</td><td align="center">否</td><td align="center"><code>/home</code></td><td align="center"><code>/mnt/home</code></td></tr><tr><td align="center"><code>/dev/sdb5</code></td><td align="center">Linux</td><td align="center">否</td><td align="center"><code>/usr</code></td><td align="center"><code>/mnt/usr</code></td></tr><tr><td align="center"><code>/dev/sdb6</code></td><td align="center">Linux swap / Solaris</td><td align="center">否</td><td align="center">[SWAP]</td><td align="center"></td></tr></tbody></table><p>注意到这里 <code>/usr</code> 和 <code>/</code>、<code>/boot</code> 分属不同的硬盘。此类情况将在后文加以说明。</p><h3 id="U-盘启动无法找到盘符的问题"><a href="#U-盘启动无法找到盘符的问题" class="headerlink" title="U 盘启动无法找到盘符的问题"></a>U 盘启动无法找到盘符的问题</h3><p>尝试在 UEFI+GPT 的机器上安装时，未出现此问题。</p><h3 id="Boot-loader-1"><a href="#Boot-loader-1" class="headerlink" title="Boot loader"></a>Boot loader</h3><p>笔者仍然使用 GRUB，但所执行的命令需要更改：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=GRUB</span><br></pre></td></tr></table></figure><p>这将在 <code>/boot/EFI</code> 文件夹中生成 <code>GRUB</code> 文件夹。一些旧教程中添加了诸如 <code>/dev/sda</code>、<code>/dev/sdb</code> 的参数，但现在实则是不需要的。</p><h3 id="usr-单独分区导致启动失败"><a href="#usr-单独分区导致启动失败" class="headerlink" title="/usr 单独分区导致启动失败"></a><code>/usr</code> 单独分区导致启动失败</h3><p>按照类似笔者的方案分区后，启动系统将失败，并显示类似如下的界面：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/dev/sda1: recovering journal</span><br><span class="line">Error:Root device mounted successfully, but /sbin/init does not exist.</span><br><span class="line">Bailing out, you are on your own.Good luck.</span><br><span class="line"></span><br><span class="line">sh: can&#x27;t access tty; job control turned off</span><br><span class="line">[rootfs ]#</span><br></pre></td></tr></table></figure><p>根据<a href="https://wiki.archlinux.org/title/Mkinitcpio#/usr_as_a_separate_partition">官方文档</a>的说明，读者需要重新进入 Live CD 环境，挂载所有分区后 <code>arch-chroot</code> 进入 chroot 环境。编辑其中的 <code>/etc/mkinitcpio.conf</code> 文件，修改类似如下的行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HOOKS=(base udev autodetect modconf block filesystems keyboard fsck)</span><br></pre></td></tr></table></figure><p>为</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HOOKS=(base udev autodetect modconf block filesystems keyboard fsck usr shutdown)</span><br></pre></td></tr></table></figure><p>随后重制镜像并重启：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkinitcpio -P</span><br><span class="line">reboot</span><br></pre></td></tr></table></figure><h2 id="Wayland"><a href="#Wayland" class="headerlink" title="Wayland"></a>Wayland</h2><p>Wayland 也是一种显示服务协议（display server protocol），致力于成为 Xorg 的优秀后继者。Wayland 亦有兼容 Xorg 和 KDE 的实现，且 SDDM 依然能使用，但在 KDE 环境中并无相对 Xorg 的明显优势。</p><p>参照<a href="https://wiki.archlinux.org/title/KDE#Installation">官方文档</a>在 Xorg 基础上安装 Wayland 相关的包，并在登录界面左上角选择桌面为“Plasma (Wayland)”。</p><p>注意使用 Wayland 作为显示服务协议时，一些教程中涉及到 <code>.xprofile</code> 等配置文件将会失效。读者需要根据实际情况正确配置。在此不作赘述。</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h2&gt;&lt;p&gt;作为&lt;a href=&quot;https://wiki.archlinux.org/title/Installation_guide&quot;&gt;官方文档&lt;/a&gt;的补充，大致提供一些安装 Arch Linux 到物理机上并安装桌面环境的思路和文档中未提及的细节。&lt;/p&gt;</summary>
    
    
    
    <category term="Essay" scheme="https://blog.tamako.work/categories/Essay/"/>
    
    <category term="Tutorial" scheme="https://blog.tamako.work/categories/Essay/Tutorial/"/>
    
    
    <category term="Arch Linux" scheme="https://blog.tamako.work/tags/Arch-Linux/"/>
    
    <category term="Operating System" scheme="https://blog.tamako.work/tags/Operating-System/"/>
    
    <category term="Boot Loader" scheme="https://blog.tamako.work/tags/Boot-Loader/"/>
    
    <category term="Desktop" scheme="https://blog.tamako.work/tags/Desktop/"/>
    
  </entry>
  
</feed>
